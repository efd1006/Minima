//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ./org/minima/database/MinimaDB.java
//

#include "IOSObjectArray.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "java/io/ByteArrayOutputStream.h"
#include "java/io/DataOutputStream.h"
#include "java/io/PrintStream.h"
#include "java/lang/Exception.h"
#include "java/lang/System.h"
#include "java/math/BigDecimal.h"
#include "java/math/BigInteger.h"
#include "java/math/MathContext.h"
#include "java/util/ArrayList.h"
#include "java/util/Collections.h"
#include "java/util/Enumeration.h"
#include "java/util/Hashtable.h"
#include "org/minima/GlobalParams.h"
#include "org/minima/database/MinimaDB.h"
#include "org/minima/database/coindb/CoinDB.h"
#include "org/minima/database/coindb/CoinDBRow.h"
#include "org/minima/database/coindb/java/JavaCoinDB.h"
#include "org/minima/database/mmr/MMRData.h"
#include "org/minima/database/mmr/MMREntry.h"
#include "org/minima/database/mmr/MMRProof.h"
#include "org/minima/database/mmr/MMRSet.h"
#include "org/minima/database/txpowdb/TxPOWDBRow.h"
#include "org/minima/database/txpowdb/TxPowDB.h"
#include "org/minima/database/txpowdb/java/JavaDB.h"
#include "org/minima/database/txpowtree/BlockTree.h"
#include "org/minima/database/txpowtree/BlockTreeNode.h"
#include "org/minima/database/txpowtree/MultiLevelCascadeTree.h"
#include "org/minima/database/userdb/UserDB.h"
#include "org/minima/database/userdb/java/JavaUserDB.h"
#include "org/minima/objects/Address.h"
#include "org/minima/objects/Coin.h"
#include "org/minima/objects/PubPrivKey.h"
#include "org/minima/objects/Transaction.h"
#include "org/minima/objects/TxPOW.h"
#include "org/minima/objects/Witness.h"
#include "org/minima/objects/base/MMRSumNumber.h"
#include "org/minima/objects/base/MiniByte.h"
#include "org/minima/objects/base/MiniData.h"
#include "org/minima/objects/base/MiniInteger.h"
#include "org/minima/objects/base/MiniNumber.h"
#include "org/minima/objects/proofs/TokenProof.h"
#include "org/minima/system/backup/BackupManager.h"
#include "org/minima/system/backup/SyncPackage.h"
#include "org/minima/system/backup/SyncPacket.h"
#include "org/minima/system/bootstrap/GenesisTxPOW.h"
#include "org/minima/system/brains/ConsensusHandler.h"
#include "org/minima/system/input/functions/gimme50.h"
#include "org/minima/system/txpow/TxPoWChecker.h"
#include "org/minima/system/txpow/TxPoWMiner.h"
#include "org/minima/utils/Crypto.h"
#include "org/minima/utils/MinimaLogger.h"
#include "org/minima/utils/json/JSONArray.h"
#include "org/minima/utils/messages/Message.h"

@interface OrgMinimaDatabaseMinimaDB () {
 @public
  id<OrgMinimaDatabaseTxpowdbTxPowDB> mTxPOWDB_;
  OrgMinimaDatabaseTxpowtreeBlockTree *mMainTree_;
  id<OrgMinimaDatabaseCoindbCoinDB> mCoinDB_;
  id<OrgMinimaDatabaseUserdbUserDB> mUserDB_;
}

- (void)addTreeChildrenWithOrgMinimaObjectsBaseMiniData:(OrgMinimaObjectsBaseMiniData *)zParentID;

- (void)sortBlockTreeNodeStatesWithOrgMinimaDatabaseTxpowtreeBlockTreeNode:(OrgMinimaDatabaseTxpowtreeBlockTreeNode *)zNode
                                                                   withInt:(jint)zParentState;

- (jboolean)checkFullTxPOWWithOrgMinimaObjectsTxPOW:(OrgMinimaObjectsTxPOW *)zBlock
                     withOrgMinimaDatabaseMmrMMRSet:(OrgMinimaDatabaseMmrMMRSet *)zMMRSet;

@end

J2OBJC_FIELD_SETTER(OrgMinimaDatabaseMinimaDB, mTxPOWDB_, id<OrgMinimaDatabaseTxpowdbTxPowDB>)
J2OBJC_FIELD_SETTER(OrgMinimaDatabaseMinimaDB, mMainTree_, OrgMinimaDatabaseTxpowtreeBlockTree *)
J2OBJC_FIELD_SETTER(OrgMinimaDatabaseMinimaDB, mCoinDB_, id<OrgMinimaDatabaseCoindbCoinDB>)
J2OBJC_FIELD_SETTER(OrgMinimaDatabaseMinimaDB, mUserDB_, id<OrgMinimaDatabaseUserdbUserDB>)

__attribute__((unused)) static void OrgMinimaDatabaseMinimaDB_addTreeChildrenWithOrgMinimaObjectsBaseMiniData_(OrgMinimaDatabaseMinimaDB *self, OrgMinimaObjectsBaseMiniData *zParentID);

__attribute__((unused)) static void OrgMinimaDatabaseMinimaDB_sortBlockTreeNodeStatesWithOrgMinimaDatabaseTxpowtreeBlockTreeNode_withInt_(OrgMinimaDatabaseMinimaDB *self, OrgMinimaDatabaseTxpowtreeBlockTreeNode *zNode, jint zParentState);

__attribute__((unused)) static jboolean OrgMinimaDatabaseMinimaDB_checkFullTxPOWWithOrgMinimaObjectsTxPOW_withOrgMinimaDatabaseMmrMMRSet_(OrgMinimaDatabaseMinimaDB *self, OrgMinimaObjectsTxPOW *zBlock, OrgMinimaDatabaseMmrMMRSet *zMMRSet);

@implementation OrgMinimaDatabaseMinimaDB

J2OBJC_IGNORE_DESIGNATED_BEGIN
- (instancetype)init {
  OrgMinimaDatabaseMinimaDB_init(self);
  return self;
}
J2OBJC_IGNORE_DESIGNATED_END

- (void)setBackupManagerWithOrgMinimaSystemBackupBackupManager:(OrgMinimaSystemBackupBackupManager *)zBackup {
  mBackup_ = zBackup;
}

- (OrgMinimaSystemBackupBackupManager *)getBackup {
  return mBackup_;
}

- (void)DoGenesis {
  OrgMinimaObjectsTxPOW *gen = new_OrgMinimaSystemBootstrapGenesisTxPOW_init();
  id<OrgMinimaDatabaseTxpowdbTxPOWDBRow> row = [((id<OrgMinimaDatabaseTxpowdbTxPowDB>) nil_chk(mTxPOWDB_)) addTxPOWDBRowWithOrgMinimaObjectsTxPOW:gen];
  [((id<OrgMinimaDatabaseTxpowdbTxPOWDBRow>) nil_chk(row)) setOnChainBlockWithBoolean:true];
  [row setInBlockNumberWithOrgMinimaObjectsBaseMiniNumber:JreLoadStatic(OrgMinimaObjectsBaseMiniNumber, ZERO)];
  [row setIsInBlockWithBoolean:true];
  [row setBlockStateWithInt:OrgMinimaDatabaseTxpowdbTxPOWDBRow_TXPOWDBROW_STATE_FULL];
  OrgMinimaDatabaseMmrMMRSet *base = new_OrgMinimaDatabaseMmrMMRSet_init();
  OrgMinimaObjectsCoin *gencoin = new_OrgMinimaObjectsCoin_initWithOrgMinimaObjectsBaseMiniData_withOrgMinimaObjectsBaseMiniData_withOrgMinimaObjectsBaseMiniNumber_withOrgMinimaObjectsBaseMiniData_(new_OrgMinimaObjectsBaseMiniData_initWithNSString_(@"0x00"), [((OrgMinimaObjectsAddress *) nil_chk(JreLoadStatic(OrgMinimaObjectsAddress, TRUE_ADDRESS))) getAddressData], JreLoadStatic(OrgMinimaObjectsBaseMiniNumber, ZERO), JreLoadStatic(OrgMinimaObjectsCoin, MINIMA_TOKENID));
  OrgMinimaDatabaseMmrMMRData *gendata = new_OrgMinimaDatabaseMmrMMRData_initWithOrgMinimaObjectsBaseMiniByte_withOrgMinimaObjectsCoin_withOrgMinimaObjectsBaseMiniNumber_withJavaUtilArrayList_(JreLoadStatic(OrgMinimaObjectsBaseMiniByte, FALSE), gencoin, JreLoadStatic(OrgMinimaObjectsBaseMiniNumber, ZERO), new_JavaUtilArrayList_init());
  (void) [base addUnspentCoinWithOrgMinimaDatabaseMmrMMRData:gendata];
  [gen setMMRRootWithOrgMinimaObjectsBaseMiniData:[((OrgMinimaDatabaseMmrMMRData *) nil_chk([base getMMRRoot])) getFinalHash]];
  [gen setMMRTotalWithOrgMinimaObjectsBaseMMRSumNumber:JreLoadStatic(OrgMinimaObjectsBaseMMRSumNumber, ZERO)];
  [gen calculateTXPOWID];
  OrgMinimaDatabaseTxpowtreeBlockTreeNode *root = new_OrgMinimaDatabaseTxpowtreeBlockTreeNode_initWithOrgMinimaObjectsTxPOW_(gen);
  [root setStateWithInt:OrgMinimaDatabaseTxpowtreeBlockTreeNode_BLOCKSTATE_VALID];
  [root setCascadeWithBoolean:false];
  [root setMMRsetWithOrgMinimaDatabaseMmrMMRSet:base];
  [((OrgMinimaDatabaseTxpowtreeBlockTree *) nil_chk(mMainTree_)) setTreeRootWithOrgMinimaDatabaseTxpowtreeBlockTreeNode:root];
  [((OrgMinimaSystemBackupBackupManager *) nil_chk([self getBackup])) backupTxpowWithOrgMinimaObjectsTxPOW:gen];
}

- (OrgMinimaObjectsTxPOW *)getTxPOWWithOrgMinimaObjectsBaseMiniData:(OrgMinimaObjectsBaseMiniData *)zTxPOWID {
  id<OrgMinimaDatabaseTxpowdbTxPOWDBRow> row = [((id<OrgMinimaDatabaseTxpowdbTxPowDB>) nil_chk(mTxPOWDB_)) findTxPOWDBRowWithOrgMinimaObjectsBaseMiniData:zTxPOWID];
  if (row == nil) {
    return nil;
  }
  return [row getTxPOW];
}

- (id<OrgMinimaDatabaseTxpowdbTxPOWDBRow>)getTxPOWRowWithOrgMinimaObjectsBaseMiniData:(OrgMinimaObjectsBaseMiniData *)zTxPOWID {
  return [((id<OrgMinimaDatabaseTxpowdbTxPowDB>) nil_chk(mTxPOWDB_)) findTxPOWDBRowWithOrgMinimaObjectsBaseMiniData:zTxPOWID];
}

- (OrgMinimaDatabaseTxpowtreeBlockTreeNode *)getBlockTreeNodeWithOrgMinimaObjectsBaseMiniData:(OrgMinimaObjectsBaseMiniData *)zTxPowID {
  return [((OrgMinimaDatabaseTxpowtreeBlockTree *) nil_chk(mMainTree_)) findNodeWithOrgMinimaObjectsBaseMiniData:zTxPowID];
}

- (void)processTxPOWWithOrgMinimaObjectsTxPOW:(OrgMinimaObjectsTxPOW *)zTxPow {
  jboolean treeadded = false;
  if ([((OrgMinimaObjectsTxPOW *) nil_chk(zTxPow)) isBlock]) {
    OrgMinimaDatabaseTxpowtreeBlockTreeNode *node = new_OrgMinimaDatabaseTxpowtreeBlockTreeNode_initWithOrgMinimaObjectsTxPOW_(zTxPow);
    treeadded = [((OrgMinimaDatabaseTxpowtreeBlockTree *) nil_chk(mMainTree_)) addNodeWithOrgMinimaDatabaseTxpowtreeBlockTreeNode:node];
    if (treeadded) {
      OrgMinimaDatabaseMinimaDB_addTreeChildrenWithOrgMinimaObjectsBaseMiniData_(self, [zTxPow getTxPowID]);
    }
  }
  JavaUtilArrayList *unfinishedblocks = [((id<OrgMinimaDatabaseTxpowdbTxPowDB>) nil_chk(mTxPOWDB_)) getAllBlocksMissingTransactions];
  jboolean newfullblock = false;
  for (id<OrgMinimaDatabaseTxpowdbTxPOWDBRow> __strong unblock in nil_chk(unfinishedblocks)) {
    jboolean allok = true;
    JavaUtilArrayList *txns = [((OrgMinimaObjectsTxPOW *) nil_chk([((id<OrgMinimaDatabaseTxpowdbTxPOWDBRow>) nil_chk(unblock)) getTxPOW])) getBlockTransactions];
    for (OrgMinimaObjectsBaseMiniData * __strong txnid in nil_chk(txns)) {
      if ([self getTxPOWWithOrgMinimaObjectsBaseMiniData:txnid] == nil) {
        allok = false;
        break;
      }
    }
    if (allok) {
      [unblock setBlockStateWithInt:OrgMinimaDatabaseTxpowdbTxPOWDBRow_TXPOWDBROW_STATE_FULL];
      newfullblock = true;
    }
  }
  if (treeadded || newfullblock) {
    OrgMinimaDatabaseTxpowtreeBlockTreeNode *tip = [((OrgMinimaDatabaseTxpowtreeBlockTree *) nil_chk(mMainTree_)) getChainTip];
    OrgMinimaDatabaseMinimaDB_sortBlockTreeNodeStatesWithOrgMinimaDatabaseTxpowtreeBlockTreeNode_withInt_(self, [((OrgMinimaDatabaseTxpowtreeBlockTree *) nil_chk(mMainTree_)) getChainRoot], OrgMinimaDatabaseTxpowtreeBlockTreeNode_BLOCKSTATE_VALID);
    [((OrgMinimaDatabaseTxpowtreeBlockTree *) nil_chk(mMainTree_)) resetWeights];
    OrgMinimaDatabaseTxpowtreeBlockTreeNode *newtip = [((OrgMinimaDatabaseTxpowtreeBlockTree *) nil_chk(mMainTree_)) getChainTip];
    if ([((OrgMinimaObjectsBaseMiniData *) nil_chk([((OrgMinimaDatabaseTxpowtreeBlockTreeNode *) nil_chk(newtip)) getTxPowID])) isEqualWithOrgMinimaObjectsBaseMiniData:[((OrgMinimaDatabaseTxpowtreeBlockTreeNode *) nil_chk(tip)) getTxPowID]]) {
      return;
    }
    JavaUtilArrayList *list = nil;
    if ([((OrgMinimaObjectsBaseMiniData *) nil_chk([((OrgMinimaDatabaseTxpowtreeBlockTreeNode *) nil_chk([newtip getParent])) getTxPowID])) isEqualWithOrgMinimaObjectsBaseMiniData:[tip getTxPowID]]) {
      list = new_JavaUtilArrayList_init();
      [list addWithId:newtip];
    }
    else {
      list = [((OrgMinimaDatabaseTxpowtreeBlockTree *) nil_chk(mMainTree_)) getAsList];
      [((id<OrgMinimaDatabaseTxpowdbTxPowDB>) nil_chk(mTxPOWDB_)) resetAllInBlocks];
      [((id<OrgMinimaDatabaseCoindbCoinDB>) nil_chk(mCoinDB_)) clearDB];
    }
    OrgMinimaObjectsBaseMiniNumber *oldcascade = [((OrgMinimaObjectsTxPOW *) nil_chk([((OrgMinimaDatabaseTxpowtreeBlockTreeNode *) nil_chk([((OrgMinimaDatabaseTxpowtreeBlockTree *) nil_chk([self getMainTree])) getCascadeNode])) getTxPow])) getBlockNumber];
    JavaUtilCollections_reverseWithJavaUtilList_(list);
    for (OrgMinimaDatabaseTxpowtreeBlockTreeNode * __strong treenode in nil_chk(list)) {
      OrgMinimaObjectsTxPOW *txpow = [((OrgMinimaDatabaseTxpowtreeBlockTreeNode *) nil_chk(treenode)) getTxPow];
      id<OrgMinimaDatabaseTxpowdbTxPOWDBRow> trow = [((id<OrgMinimaDatabaseTxpowdbTxPowDB>) nil_chk(mTxPOWDB_)) addTxPOWDBRowWithOrgMinimaObjectsTxPOW:txpow];
      OrgMinimaObjectsBaseMiniNumber *block = [((OrgMinimaObjectsTxPOW *) nil_chk(txpow)) getBlockNumber];
      [((id<OrgMinimaDatabaseTxpowdbTxPOWDBRow>) nil_chk(trow)) setOnChainBlockWithBoolean:true];
      [trow setIsInBlockWithBoolean:true];
      [trow setInBlockNumberWithOrgMinimaObjectsBaseMiniNumber:block];
      if ([((OrgMinimaObjectsBaseMiniNumber *) nil_chk([((OrgMinimaObjectsTxPOW *) nil_chk([treenode getTxPow])) getBlockNumber])) isMoreEqualWithOrgMinimaObjectsBaseMiniNumber:oldcascade]) {
        [self scanMMRSetForCoinsWithOrgMinimaDatabaseMmrMMRSet:[treenode getMMRSet]];
      }
      JavaUtilArrayList *txpowlist = [txpow getBlockTransactions];
      for (OrgMinimaObjectsBaseMiniData * __strong txid in nil_chk(txpowlist)) {
        trow = [((id<OrgMinimaDatabaseTxpowdbTxPowDB>) nil_chk(mTxPOWDB_)) findTxPOWDBRowWithOrgMinimaObjectsBaseMiniData:txid];
        if (trow != nil) {
          [trow setOnChainBlockWithBoolean:false];
          [trow setIsInBlockWithBoolean:true];
          [trow setInBlockNumberWithOrgMinimaObjectsBaseMiniNumber:block];
        }
      }
    }
    JavaMathBigInteger *weight = [((OrgMinimaDatabaseTxpowtreeBlockTreeNode *) nil_chk([((OrgMinimaDatabaseTxpowtreeBlockTree *) nil_chk(mMainTree_)) getChainRoot])) getTotalWeight];
    if ([((JavaMathBigInteger *) nil_chk(weight)) compareToWithId:JreLoadStatic(JavaMathBigInteger, ZERO)] == 0) {
      [((JavaIoPrintStream *) nil_chk(JreLoadStatic(JavaLangSystem, out))) printlnWithNSString:@"ZERO WEIGHT ERROR!"];
    }
    OrgMinimaDatabaseTxpowtreeMultiLevelCascadeTree *casc = new_OrgMinimaDatabaseTxpowtreeMultiLevelCascadeTree_initWithOrgMinimaDatabaseTxpowtreeBlockTree_(mMainTree_);
    JavaUtilArrayList *removals = [casc cascadedTree];
    JavaMathBigInteger *cascweight = [((OrgMinimaDatabaseTxpowtreeBlockTreeNode *) nil_chk([((OrgMinimaDatabaseTxpowtreeBlockTree *) nil_chk([casc getCascadeTree])) getChainRoot])) getTotalWeight];
    JavaMathBigDecimal *ratio = [new_JavaMathBigDecimal_initWithJavaMathBigInteger_(cascweight) divideWithJavaMathBigDecimal:new_JavaMathBigDecimal_initWithJavaMathBigInteger_(weight) withJavaMathMathContext:JreLoadStatic(JavaMathMathContext, DECIMAL128)];
    if ([((JavaMathBigDecimal *) nil_chk(ratio)) compareToWithId:new_JavaMathBigDecimal_initWithNSString_(OrgMinimaGlobalParams_MINIMA_CASCADE_RATIO)] < 0) {
      OrgMinimaUtilsMinimaLogger_logWithNSString_(JreStrcat("$$C@", @"Cascade Tree LOST more than ", OrgMinimaGlobalParams_MINIMA_CASCADE_RATIO, ' ', ratio));
    }
    mMainTree_ = [casc getCascadeTree];
    OrgMinimaDatabaseTxpowtreeBlockTreeNode *newcascade = [((OrgMinimaDatabaseTxpowtreeBlockTree *) nil_chk(mMainTree_)) getCascadeNode];
    if (newcascade != nil && [newcascade getMMRSet] != nil) {
      [casc recurseParentMMRWithOrgMinimaObjectsBaseMiniNumber:oldcascade withOrgMinimaDatabaseMmrMMRSet:[newcascade getMMRSet]];
    }
    for (OrgMinimaDatabaseTxpowtreeBlockTreeNode * __strong node in nil_chk(removals)) {
      id<OrgMinimaDatabaseTxpowdbTxPOWDBRow> row = [self getTxPOWRowWithOrgMinimaObjectsBaseMiniData:[((OrgMinimaDatabaseTxpowtreeBlockTreeNode *) nil_chk(node)) getTxPowID]];
      [((id<OrgMinimaDatabaseTxpowdbTxPOWDBRow>) nil_chk(row)) setOnChainBlockWithBoolean:false];
      [((OrgMinimaSystemBackupBackupManager *) nil_chk([self getBackup])) deleteTxpowWithOrgMinimaObjectsTxPOW:[node getTxPow]];
    }
    OrgMinimaObjectsBaseMiniNumber *cascade = [((OrgMinimaObjectsTxPOW *) nil_chk([((OrgMinimaDatabaseTxpowtreeBlockTreeNode *) nil_chk([((OrgMinimaDatabaseTxpowtreeBlockTree *) nil_chk(mMainTree_)) getCascadeNode])) getTxPow])) getBlockNumber];
    JavaUtilArrayList *remrows = [((id<OrgMinimaDatabaseTxpowdbTxPowDB>) nil_chk(mTxPOWDB_)) removeTxPOWInBlockLessThanWithOrgMinimaObjectsBaseMiniNumber:cascade];
    for (id<OrgMinimaDatabaseTxpowdbTxPOWDBRow> __strong remrow in nil_chk(remrows)) {
      [((OrgMinimaSystemBackupBackupManager *) nil_chk([self getBackup])) deleteTxpowWithOrgMinimaObjectsTxPOW:[((id<OrgMinimaDatabaseTxpowdbTxPOWDBRow>) nil_chk(remrow)) getTxPOW]];
    }
    [((id<OrgMinimaDatabaseCoindbCoinDB>) nil_chk(mCoinDB_)) removeOldSpentCoinsWithOrgMinimaObjectsBaseMiniNumber:cascade];
  }
}

- (void)scanMMRSetForCoinsWithOrgMinimaDatabaseMmrMMRSet:(OrgMinimaDatabaseMmrMMRSet *)zMMRSet {
  if (zMMRSet == nil) {
    return;
  }
  JavaUtilArrayList *entries = [zMMRSet getZeroRow];
  for (OrgMinimaDatabaseMmrMMREntry * __strong mmrcoin in nil_chk(entries)) {
    if (![((OrgMinimaDatabaseMmrMMRData *) nil_chk([((OrgMinimaDatabaseMmrMMREntry *) nil_chk(mmrcoin)) getData])) isHashOnly]) {
      OrgMinimaObjectsCoin *cc = [((OrgMinimaDatabaseMmrMMRData *) nil_chk([mmrcoin getData])) getCoin];
      jboolean spent = [((OrgMinimaDatabaseMmrMMRData *) nil_chk([mmrcoin getData])) isSpent];
      jboolean rel = [((id<OrgMinimaDatabaseUserdbUserDB>) nil_chk([self getUserDB])) isAddressRelevantWithOrgMinimaObjectsBaseMiniData:[((OrgMinimaObjectsCoin *) nil_chk(cc)) getAddress]];
      if (!rel) {
        rel = [((id<OrgMinimaDatabaseUserdbUserDB>) nil_chk([self getUserDB])) isStateListRelevantWithJavaUtilArrayList:[((OrgMinimaDatabaseMmrMMRData *) nil_chk([mmrcoin getData])) getPrevState]];
      }
      if (rel) {
        [zMMRSet addKeeperWithOrgMinimaObjectsBaseMiniInteger:[mmrcoin getEntry]];
      }
      id<OrgMinimaDatabaseCoindbCoinDBRow> inrow = [((id<OrgMinimaDatabaseCoindbCoinDB>) nil_chk([self getCoinDB])) addCoinRowWithOrgMinimaObjectsCoin:cc];
      [((id<OrgMinimaDatabaseCoindbCoinDBRow>) nil_chk(inrow)) setRelevantWithBoolean:rel];
      if (![inrow isInBlock] || [inrow isSpent] != spent) {
        [inrow setIsSpentWithBoolean:spent];
        [inrow setIsInBlockWithBoolean:true];
        [inrow setInBlockNumberWithOrgMinimaObjectsBaseMiniNumber:[zMMRSet getBlockTime]];
        [inrow setMMREntryWithOrgMinimaObjectsBaseMiniInteger:[mmrcoin getEntry]];
      }
    }
  }
}

- (void)addTreeChildrenWithOrgMinimaObjectsBaseMiniData:(OrgMinimaObjectsBaseMiniData *)zParentID {
  OrgMinimaDatabaseMinimaDB_addTreeChildrenWithOrgMinimaObjectsBaseMiniData_(self, zParentID);
}

- (void)sortBlockTreeNodeStatesWithOrgMinimaDatabaseTxpowtreeBlockTreeNode:(OrgMinimaDatabaseTxpowtreeBlockTreeNode *)zNode
                                                                   withInt:(jint)zParentState {
  OrgMinimaDatabaseMinimaDB_sortBlockTreeNodeStatesWithOrgMinimaDatabaseTxpowtreeBlockTreeNode_withInt_(self, zNode, zParentState);
}

- (jboolean)checkFullTxPOWWithOrgMinimaObjectsTxPOW:(OrgMinimaObjectsTxPOW *)zBlock
                     withOrgMinimaDatabaseMmrMMRSet:(OrgMinimaDatabaseMmrMMRSet *)zMMRSet {
  return OrgMinimaDatabaseMinimaDB_checkFullTxPOWWithOrgMinimaObjectsTxPOW_withOrgMinimaDatabaseMmrMMRSet_(self, zBlock, zMMRSet);
}

- (id<OrgMinimaDatabaseTxpowdbTxPOWDBRow>)addNewTxPowWithOrgMinimaObjectsTxPOW:(OrgMinimaObjectsTxPOW *)zTxPOW {
  return [((id<OrgMinimaDatabaseTxpowdbTxPowDB>) nil_chk(mTxPOWDB_)) addTxPOWDBRowWithOrgMinimaObjectsTxPOW:zTxPOW];
}

- (OrgMinimaDatabaseTxpowtreeBlockTreeNode *)hardAddTxPOWBlockWithOrgMinimaObjectsTxPOW:(OrgMinimaObjectsTxPOW *)zTxPoW
                                                         withOrgMinimaDatabaseMmrMMRSet:(OrgMinimaDatabaseMmrMMRSet *)zMMR
                                                                            withBoolean:(jboolean)zCascade {
  id<OrgMinimaDatabaseTxpowdbTxPOWDBRow> row = [((id<OrgMinimaDatabaseTxpowdbTxPowDB>) nil_chk(mTxPOWDB_)) addTxPOWDBRowWithOrgMinimaObjectsTxPOW:zTxPoW];
  [((id<OrgMinimaDatabaseTxpowdbTxPOWDBRow>) nil_chk(row)) setIsInBlockWithBoolean:true];
  [row setOnChainBlockWithBoolean:true];
  [row setInBlockNumberWithOrgMinimaObjectsBaseMiniNumber:[((OrgMinimaObjectsTxPOW *) nil_chk(zTxPoW)) getBlockNumber]];
  [row setBlockStateWithInt:OrgMinimaDatabaseTxpowdbTxPOWDBRow_TXPOWDBROW_STATE_FULL];
  OrgMinimaDatabaseTxpowtreeBlockTreeNode *node = new_OrgMinimaDatabaseTxpowtreeBlockTreeNode_initWithOrgMinimaObjectsTxPOW_(zTxPoW);
  [node setCascadeWithBoolean:zCascade];
  [node setStateWithInt:OrgMinimaDatabaseTxpowtreeBlockTreeNode_BLOCKSTATE_VALID];
  [node setMMRsetWithOrgMinimaDatabaseMmrMMRSet:zMMR];
  [((OrgMinimaDatabaseTxpowtreeBlockTree *) nil_chk(mMainTree_)) hardAddNodeWithOrgMinimaDatabaseTxpowtreeBlockTreeNode:node withBoolean:true];
  return node;
}

- (void)hardSetCascadeNodeWithOrgMinimaDatabaseTxpowtreeBlockTreeNode:(OrgMinimaDatabaseTxpowtreeBlockTreeNode *)zNode {
  [((OrgMinimaDatabaseTxpowtreeBlockTree *) nil_chk(mMainTree_)) hardSetCascadeNodeWithOrgMinimaDatabaseTxpowtreeBlockTreeNode:zNode];
}

- (void)hardResetChain {
  OrgMinimaDatabaseTxpowtreeMultiLevelCascadeTree *casc = new_OrgMinimaDatabaseTxpowtreeMultiLevelCascadeTree_initWithOrgMinimaDatabaseTxpowtreeBlockTree_(mMainTree_);
  (void) [casc cascadedTree];
  mMainTree_ = [casc getCascadeTree];
}

- (void)addMiningTransactionWithOrgMinimaObjectsTransaction:(OrgMinimaObjectsTransaction *)zTrans {
  OrgMinimaObjectsBaseMiniData *transhash = [((OrgMinimaUtilsCrypto *) nil_chk(OrgMinimaUtilsCrypto_getInstance())) hashObjectWithOrgMinimaUtilsStreamable:zTrans withInt:160];
  NSString *hash_ = [((OrgMinimaObjectsBaseMiniData *) nil_chk(transhash)) to0xString];
  OrgMinimaObjectsTransaction *prev = [((JavaUtilHashtable *) nil_chk(mMiningTransactions_)) getWithId:hash_];
  if (prev != nil) {
    return;
  }
  (void) [((JavaUtilHashtable *) nil_chk(mMiningTransactions_)) putWithId:hash_ withId:zTrans];
}

- (void)remeoveMiningTransactionWithOrgMinimaObjectsTransaction:(OrgMinimaObjectsTransaction *)zTrans {
  OrgMinimaObjectsBaseMiniData *transhash = [((OrgMinimaUtilsCrypto *) nil_chk(OrgMinimaUtilsCrypto_getInstance())) hashObjectWithOrgMinimaUtilsStreamable:zTrans withInt:160];
  NSString *hash_ = [((OrgMinimaObjectsBaseMiniData *) nil_chk(transhash)) to0xString];
  (void) [((JavaUtilHashtable *) nil_chk(mMiningTransactions_)) removeWithId:hash_];
}

- (jboolean)checkInputForMiningWithOrgMinimaObjectsBaseMiniData:(OrgMinimaObjectsBaseMiniData *)zCoinID {
  id<JavaUtilEnumeration> alltrans = [((JavaUtilHashtable *) nil_chk(mMiningTransactions_)) elements];
  while ([((id<JavaUtilEnumeration>) nil_chk(alltrans)) hasMoreElements]) {
    OrgMinimaObjectsTransaction *trans = [alltrans nextElement];
    JavaUtilArrayList *inputs = [((OrgMinimaObjectsTransaction *) nil_chk(trans)) getAllInputs];
    for (OrgMinimaObjectsCoin * __strong input in nil_chk(inputs)) {
      if ([((OrgMinimaObjectsBaseMiniData *) nil_chk(zCoinID)) isEqualWithOrgMinimaObjectsBaseMiniData:[((OrgMinimaObjectsCoin *) nil_chk(input)) getCoinID]]) {
        return true;
      }
    }
  }
  return false;
}

- (JavaUtilArrayList *)getTotalSimpleSpendableCoinsWithOrgMinimaObjectsBaseMiniData:(OrgMinimaObjectsBaseMiniData *)zTokenID {
  JavaUtilArrayList *confirmed = new_JavaUtilArrayList_init();
  OrgMinimaObjectsBaseMiniNumber *top = [self getTopBlock];
  JavaUtilArrayList *memcoins = [self getMempoolCoins];
  JavaUtilArrayList *relevant = [((id<OrgMinimaDatabaseCoindbCoinDB>) nil_chk([self getCoinDB])) getCompleteRelevant];
  for (id<OrgMinimaDatabaseCoindbCoinDBRow> __strong row in nil_chk(relevant)) {
    if ([((id<OrgMinimaDatabaseCoindbCoinDBRow>) nil_chk(row)) isInBlock] && ![row isSpent] && [((OrgMinimaObjectsBaseMiniData *) nil_chk([((OrgMinimaObjectsCoin *) nil_chk([row getCoin])) getTokenID])) isEqualWithOrgMinimaObjectsBaseMiniData:zTokenID]) {
      OrgMinimaObjectsBaseMiniNumber *depth = [((OrgMinimaObjectsBaseMiniNumber *) nil_chk(top)) subWithOrgMinimaObjectsBaseMiniNumber:[row getInBlockNumber]];
      if ([((OrgMinimaObjectsBaseMiniNumber *) nil_chk(depth)) isMoreEqualWithOrgMinimaObjectsBaseMiniNumber:JreLoadStatic(OrgMinimaGlobalParams, MINIMA_CONFIRM_DEPTH)]) {
        if ([((id<OrgMinimaDatabaseUserdbUserDB>) nil_chk([self getUserDB])) isSimpleAddressWithOrgMinimaObjectsBaseMiniData:[((OrgMinimaObjectsCoin *) nil_chk([row getCoin])) getAddress]]) {
          jboolean found = false;
          OrgMinimaObjectsBaseMiniData *coinid = [((OrgMinimaObjectsCoin *) nil_chk([row getCoin])) getCoinID];
          for (OrgMinimaObjectsCoin * __strong memcoin in nil_chk(memcoins)) {
            if ([((OrgMinimaObjectsBaseMiniData *) nil_chk([((OrgMinimaObjectsCoin *) nil_chk(memcoin)) getCoinID])) isEqualWithOrgMinimaObjectsBaseMiniData:coinid]) {
              found = true;
              break;
            }
          }
          if (!found) {
            found = [self checkInputForMiningWithOrgMinimaObjectsBaseMiniData:coinid];
          }
          if (!found) {
            [confirmed addWithId:[row getCoin]];
          }
        }
      }
    }
  }
  return confirmed;
}

- (jboolean)checkTransactionForMempoolCoinsWithOrgMinimaObjectsTransaction:(OrgMinimaObjectsTransaction *)zTransaction {
  JavaUtilArrayList *memcoins = [self getMempoolCoins];
  JavaUtilArrayList *inputs = [((OrgMinimaObjectsTransaction *) nil_chk(zTransaction)) getAllInputs];
  for (OrgMinimaObjectsCoin * __strong in in nil_chk(inputs)) {
    for (OrgMinimaObjectsCoin * __strong mem in nil_chk(memcoins)) {
      if ([((OrgMinimaObjectsBaseMiniData *) nil_chk([((OrgMinimaObjectsCoin *) nil_chk(in)) getCoinID])) isEqualWithOrgMinimaObjectsBaseMiniData:[((OrgMinimaObjectsCoin *) nil_chk(mem)) getCoinID]]) {
        return true;
      }
    }
  }
  return false;
}

- (JavaUtilArrayList *)getMempoolCoins {
  JavaUtilArrayList *coins = new_JavaUtilArrayList_init();
  JavaUtilArrayList *rows = [((id<OrgMinimaDatabaseTxpowdbTxPowDB>) nil_chk([self getTxPowDB])) getAllUnusedTxPOW];
  for (id<OrgMinimaDatabaseTxpowdbTxPOWDBRow> __strong row in nil_chk(rows)) {
    OrgMinimaObjectsTxPOW *txpow = [((id<OrgMinimaDatabaseTxpowdbTxPOWDBRow>) nil_chk(row)) getTxPOW];
    if ([((OrgMinimaObjectsTxPOW *) nil_chk(txpow)) isTransaction]) {
      JavaUtilArrayList *inputs = [((OrgMinimaObjectsTransaction *) nil_chk([txpow getTransaction])) getAllInputs];
      for (OrgMinimaObjectsCoin * __strong cc in nil_chk(inputs)) {
        if (![((OrgMinimaObjectsBaseMiniData *) nil_chk([((OrgMinimaObjectsCoin *) nil_chk(cc)) getCoinID])) isEqualWithOrgMinimaObjectsBaseMiniData:JreLoadStatic(OrgMinimaSystemInputFunctionsgimme50, COINID_INPUT)]) {
          [coins addWithId:cc];
        }
      }
    }
  }
  return coins;
}

- (JavaUtilHashtable *)getTotalUnusedAmount {
  JavaUtilHashtable *amounts = new_JavaUtilHashtable_init();
  JavaUtilArrayList *rows = [((id<OrgMinimaDatabaseTxpowdbTxPowDB>) nil_chk([self getTxPowDB])) getAllUnusedTxPOW];
  for (id<OrgMinimaDatabaseTxpowdbTxPOWDBRow> __strong row in nil_chk(rows)) {
    OrgMinimaObjectsTxPOW *txpow = [((id<OrgMinimaDatabaseTxpowdbTxPOWDBRow>) nil_chk(row)) getTxPOW];
    if ([((OrgMinimaObjectsTxPOW *) nil_chk(txpow)) isTransaction]) {
      JavaUtilArrayList *inputs = [((OrgMinimaObjectsTransaction *) nil_chk([txpow getTransaction])) getAllInputs];
      for (OrgMinimaObjectsCoin * __strong cc in nil_chk(inputs)) {
        if ([((id<OrgMinimaDatabaseUserdbUserDB>) nil_chk([self getUserDB])) isAddressRelevantWithOrgMinimaObjectsBaseMiniData:[((OrgMinimaObjectsCoin *) nil_chk(cc)) getAddress]]) {
          NSString *token = [((OrgMinimaObjectsBaseMiniData *) nil_chk([cc getTokenID])) to0xString];
          OrgMinimaObjectsBaseMiniNumber *amt = [amounts getWithId:token];
          if (amt == nil) {
            amt = JreLoadStatic(OrgMinimaObjectsBaseMiniNumber, ZERO);
          }
          (void) [amounts putWithId:token withId:[((OrgMinimaObjectsBaseMiniNumber *) nil_chk(amt)) subWithOrgMinimaObjectsBaseMiniNumber:[cc getAmount]]];
        }
      }
      JavaUtilArrayList *outputs = [((OrgMinimaObjectsTransaction *) nil_chk([txpow getTransaction])) getAllOutputs];
      for (OrgMinimaObjectsCoin * __strong cc in nil_chk(outputs)) {
        if ([((id<OrgMinimaDatabaseUserdbUserDB>) nil_chk([self getUserDB])) isAddressRelevantWithOrgMinimaObjectsBaseMiniData:[((OrgMinimaObjectsCoin *) nil_chk(cc)) getAddress]]) {
          NSString *token = [((OrgMinimaObjectsBaseMiniData *) nil_chk([cc getTokenID])) to0xString];
          OrgMinimaObjectsBaseMiniNumber *amt = [amounts getWithId:token];
          if (amt == nil) {
            amt = JreLoadStatic(OrgMinimaObjectsBaseMiniNumber, ZERO);
          }
          (void) [amounts putWithId:token withId:[((OrgMinimaObjectsBaseMiniNumber *) nil_chk(amt)) addWithOrgMinimaObjectsBaseMiniNumber:[cc getAmount]]];
        }
      }
    }
  }
  return amounts;
}

- (JavaUtilHashtable *)getTransactionTokenAmountsWithOrgMinimaObjectsTxPOW:(OrgMinimaObjectsTxPOW *)zTxPOW {
  JavaUtilHashtable *amounts = new_JavaUtilHashtable_init();
  if ([((OrgMinimaObjectsTxPOW *) nil_chk(zTxPOW)) isTransaction]) {
    JavaUtilArrayList *inputs = [((OrgMinimaObjectsTransaction *) nil_chk([zTxPOW getTransaction])) getAllInputs];
    for (OrgMinimaObjectsCoin * __strong cc in nil_chk(inputs)) {
      if ([((id<OrgMinimaDatabaseUserdbUserDB>) nil_chk([self getUserDB])) isAddressRelevantWithOrgMinimaObjectsBaseMiniData:[((OrgMinimaObjectsCoin *) nil_chk(cc)) getAddress]]) {
        NSString *token = [((OrgMinimaObjectsBaseMiniData *) nil_chk([cc getTokenID])) to0xString];
        OrgMinimaObjectsBaseMiniNumber *amt = [amounts getWithId:token];
        if (amt == nil) {
          amt = JreLoadStatic(OrgMinimaObjectsBaseMiniNumber, ZERO);
        }
        (void) [amounts putWithId:token withId:[((OrgMinimaObjectsBaseMiniNumber *) nil_chk(amt)) subWithOrgMinimaObjectsBaseMiniNumber:[cc getAmount]]];
      }
    }
    JavaUtilArrayList *outputs = [((OrgMinimaObjectsTransaction *) nil_chk([zTxPOW getTransaction])) getAllOutputs];
    for (OrgMinimaObjectsCoin * __strong cc in nil_chk(outputs)) {
      if ([((id<OrgMinimaDatabaseUserdbUserDB>) nil_chk([self getUserDB])) isAddressRelevantWithOrgMinimaObjectsBaseMiniData:[((OrgMinimaObjectsCoin *) nil_chk(cc)) getAddress]]) {
        NSString *token = [((OrgMinimaObjectsBaseMiniData *) nil_chk([cc getTokenID])) to0xString];
        OrgMinimaObjectsBaseMiniNumber *amt = [amounts getWithId:token];
        if (amt == nil) {
          amt = JreLoadStatic(OrgMinimaObjectsBaseMiniNumber, ZERO);
        }
        (void) [amounts putWithId:token withId:[((OrgMinimaObjectsBaseMiniNumber *) nil_chk(amt)) addWithOrgMinimaObjectsBaseMiniNumber:[cc getAmount]]];
      }
    }
  }
  return amounts;
}

- (OrgMinimaObjectsWitness *)createValidMMRPRoofsWithOrgMinimaObjectsTransaction:(OrgMinimaObjectsTransaction *)zTransaction
                                                     withOrgMinimaObjectsWitness:(OrgMinimaObjectsWitness *)zWitness {
  OrgMinimaDatabaseMmrMMRSet *basemmr = [((OrgMinimaDatabaseTxpowtreeBlockTreeNode *) nil_chk([((OrgMinimaDatabaseTxpowtreeBlockTree *) nil_chk([self getMainTree])) getChainTip])) getMMRSet];
  OrgMinimaObjectsBaseMiniNumber *currentblock = [((OrgMinimaDatabaseMmrMMRSet *) nil_chk(basemmr)) getBlockTime];
  [((OrgMinimaObjectsWitness *) nil_chk(zWitness)) clearMMRProofs];
  JavaUtilArrayList *ins = [((OrgMinimaObjectsTransaction *) nil_chk(zTransaction)) getAllInputs];
  OrgMinimaObjectsBaseMiniNumber *recent = nil;
  for (OrgMinimaObjectsCoin * __strong cc in nil_chk(ins)) {
    OrgMinimaObjectsBaseMiniNumber *inblock = nil;
    id<OrgMinimaDatabaseCoindbCoinDBRow> crow = [((id<OrgMinimaDatabaseCoindbCoinDB>) nil_chk([self getCoinDB])) getCoinRowWithOrgMinimaObjectsBaseMiniData:[((OrgMinimaObjectsCoin *) nil_chk(cc)) getCoinID]];
    if (crow != nil) {
      inblock = [crow getInBlockNumber];
    }
    else {
      OrgMinimaDatabaseMmrMMREntry *entry_ = [basemmr findEntryWithOrgMinimaObjectsBaseMiniData:[cc getCoinID]];
      inblock = [((OrgMinimaDatabaseMmrMMRData *) nil_chk([((OrgMinimaDatabaseMmrMMREntry *) nil_chk(entry_)) getData])) getInBlock];
    }
    if (recent == nil) {
      recent = inblock;
    }
    else {
      if ([((OrgMinimaObjectsBaseMiniNumber *) nil_chk(inblock)) isMoreWithOrgMinimaObjectsBaseMiniNumber:recent]) {
        recent = inblock;
      }
    }
  }
  OrgMinimaObjectsBaseMiniNumber *howdeep = [((OrgMinimaObjectsBaseMiniNumber *) nil_chk(currentblock)) subWithOrgMinimaObjectsBaseMiniNumber:recent];
  if ([((OrgMinimaObjectsBaseMiniNumber *) nil_chk(howdeep)) isMoreWithOrgMinimaObjectsBaseMiniNumber:JreLoadStatic(OrgMinimaObjectsBaseMiniNumber, SIXTYFOUR)]) {
    howdeep = JreLoadStatic(OrgMinimaObjectsBaseMiniNumber, SIXTYFOUR);
  }
  OrgMinimaDatabaseMmrMMRSet *proofmmr = [basemmr getParentAtTimeWithOrgMinimaObjectsBaseMiniNumber:[currentblock subWithOrgMinimaObjectsBaseMiniNumber:howdeep]];
  for (OrgMinimaObjectsCoin * __strong cc in ins) {
    OrgMinimaObjectsBaseMiniInteger *entrynum = nil;
    id<OrgMinimaDatabaseCoindbCoinDBRow> crow = [((id<OrgMinimaDatabaseCoindbCoinDB>) nil_chk([self getCoinDB])) getCoinRowWithOrgMinimaObjectsBaseMiniData:[((OrgMinimaObjectsCoin *) nil_chk(cc)) getCoinID]];
    if (crow != nil) {
      entrynum = [crow getMMREntry];
    }
    else {
      entrynum = [((OrgMinimaDatabaseMmrMMREntry *) nil_chk([((OrgMinimaDatabaseMmrMMRSet *) nil_chk(proofmmr)) findEntryWithOrgMinimaObjectsBaseMiniData:[cc getCoinID]])) getEntry];
    }
    OrgMinimaDatabaseMmrMMRProof *proof = [((OrgMinimaDatabaseMmrMMRSet *) nil_chk(proofmmr)) getProofWithOrgMinimaObjectsBaseMiniInteger:entrynum];
    if (proof == nil) {
      return nil;
    }
    [zWitness addMMRProofWithOrgMinimaDatabaseMmrMMRProof:proof];
  }
  return zWitness;
}

- (OrgMinimaUtilsMessagesMessage *)createTransactionWithOrgMinimaObjectsBaseMiniNumber:(OrgMinimaObjectsBaseMiniNumber *)zAmount
                                                           withOrgMinimaObjectsAddress:(OrgMinimaObjectsAddress *)zToAddress
                                                           withOrgMinimaObjectsAddress:(OrgMinimaObjectsAddress *)zChangeAddress
                                                                 withJavaUtilArrayList:(JavaUtilArrayList *)zConfirmed
                                                      withOrgMinimaObjectsBaseMiniData:(OrgMinimaObjectsBaseMiniData *)zTokenID
                                                      withOrgMinimaObjectsBaseMiniData:(OrgMinimaObjectsBaseMiniData *)zChangeTokenID
                                                  withOrgMinimaObjectsProofsTokenProof:(OrgMinimaObjectsProofsTokenProof *)zTokenGen {
  return [self createTransactionWithOrgMinimaObjectsBaseMiniNumber:zAmount withOrgMinimaObjectsAddress:zToAddress withOrgMinimaObjectsAddress:zChangeAddress withJavaUtilArrayList:zConfirmed withOrgMinimaObjectsBaseMiniData:zTokenID withOrgMinimaObjectsBaseMiniData:zChangeTokenID withOrgMinimaObjectsProofsTokenProof:zTokenGen withOrgMinimaObjectsTransaction:new_OrgMinimaObjectsTransaction_init()];
}

- (OrgMinimaUtilsMessagesMessage *)createTransactionWithOrgMinimaObjectsBaseMiniNumber:(OrgMinimaObjectsBaseMiniNumber *)zAmount
                                                           withOrgMinimaObjectsAddress:(OrgMinimaObjectsAddress *)zToAddress
                                                           withOrgMinimaObjectsAddress:(OrgMinimaObjectsAddress *)zChangeAddress
                                                                 withJavaUtilArrayList:(JavaUtilArrayList *)zConfirmed
                                                      withOrgMinimaObjectsBaseMiniData:(OrgMinimaObjectsBaseMiniData *)zTokenID
                                                      withOrgMinimaObjectsBaseMiniData:(OrgMinimaObjectsBaseMiniData *)zChangeTokenID
                                                  withOrgMinimaObjectsProofsTokenProof:(OrgMinimaObjectsProofsTokenProof *)zTokenGen
                                                       withOrgMinimaObjectsTransaction:(OrgMinimaObjectsTransaction *)zUseThisTransaction {
  OrgMinimaObjectsTransaction *trx = zUseThisTransaction;
  OrgMinimaObjectsWitness *wit = new_OrgMinimaObjectsWitness_init();
  JavaUtilArrayList *sigpubk = new_JavaUtilArrayList_init();
  OrgMinimaObjectsBaseMiniNumber *currentin = new_OrgMinimaObjectsBaseMiniNumber_init();
  for (OrgMinimaObjectsCoin * __strong cc in nil_chk(zConfirmed)) {
    if ([((OrgMinimaObjectsBaseMiniNumber *) nil_chk(currentin)) isLessWithOrgMinimaObjectsBaseMiniNumber:zAmount]) {
      NSString *script = [((id<OrgMinimaDatabaseUserdbUserDB>) nil_chk([self getUserDB])) getScriptWithOrgMinimaObjectsBaseMiniData:[((OrgMinimaObjectsCoin *) nil_chk(cc)) getAddress]];
      if ([((NSString *) nil_chk(script)) isEqual:@""]) {
        [((JavaIoPrintStream *) nil_chk(JreLoadStatic(JavaLangSystem, out))) printlnWithNSString:JreStrcat("$@$", @"ERROR UNKNOWN ADDRESS ", [cc getAddress], @" not in database..")];
        return nil;
      }
      [((OrgMinimaObjectsTransaction *) nil_chk(trx)) addInputWithOrgMinimaObjectsCoin:cc];
      @try {
        [wit addScriptWithNSString:script withInt:[((OrgMinimaObjectsBaseMiniData *) nil_chk([cc getAddress])) getLength] * 8];
      }
      @catch (JavaLangException *e) {
        OrgMinimaUtilsMinimaLogger_logWithNSString_(JreStrcat("$$", @"Invalid Script.. ", script));
        return nil;
      }
      OrgMinimaObjectsBaseMiniData *pubk = [((id<OrgMinimaDatabaseUserdbUserDB>) nil_chk([self getUserDB])) getPublicKeyForSimpleAddressWithOrgMinimaObjectsBaseMiniData:[cc getAddress]];
      [sigpubk addWithId:pubk];
      currentin = [currentin addWithOrgMinimaObjectsBaseMiniNumber:[cc getAmount]];
    }
    else {
      break;
    }
  }
  if ([currentin isLessWithOrgMinimaObjectsBaseMiniNumber:zAmount]) {
    OrgMinimaUtilsMinimaLogger_logWithNSString_(JreStrcat("$@", @"ERROR Insufficient funds!! ", currentin));
    return nil;
  }
  OrgMinimaObjectsCoin *out = new_OrgMinimaObjectsCoin_initWithOrgMinimaObjectsBaseMiniData_withOrgMinimaObjectsBaseMiniData_withOrgMinimaObjectsBaseMiniNumber_withOrgMinimaObjectsBaseMiniData_(JreLoadStatic(OrgMinimaObjectsCoin, COINID_OUTPUT), [((OrgMinimaObjectsAddress *) nil_chk(zToAddress)) getAddressData], zAmount, zTokenID);
  [((OrgMinimaObjectsTransaction *) nil_chk(trx)) addOutputWithOrgMinimaObjectsCoin:out];
  OrgMinimaObjectsBaseMiniNumber *change = [currentin subWithOrgMinimaObjectsBaseMiniNumber:zAmount];
  if (![((OrgMinimaObjectsBaseMiniNumber *) nil_chk(change)) isEqualWithOrgMinimaObjectsBaseMiniNumber:JreLoadStatic(OrgMinimaObjectsBaseMiniNumber, ZERO)]) {
    OrgMinimaObjectsCoin *chg = new_OrgMinimaObjectsCoin_initWithOrgMinimaObjectsBaseMiniData_withOrgMinimaObjectsBaseMiniData_withOrgMinimaObjectsBaseMiniNumber_withOrgMinimaObjectsBaseMiniData_(JreLoadStatic(OrgMinimaObjectsCoin, COINID_OUTPUT), [((OrgMinimaObjectsAddress *) nil_chk(zChangeAddress)) getAddressData], change, zChangeTokenID);
    [trx addOutputWithOrgMinimaObjectsCoin:chg];
  }
  if (zTokenGen != nil) {
    [trx setTokenGenerationDetailsWithOrgMinimaObjectsProofsTokenProof:zTokenGen];
  }
  if (![trx checkValidInOutPerToken]) {
    OrgMinimaUtilsMinimaLogger_logWithNSString_(JreStrcat("$@", @"ERROR Inputs and Outpus do not add up! ", trx));
    return nil;
  }
  OrgMinimaObjectsWitness *witcheck = [self createValidMMRPRoofsWithOrgMinimaObjectsTransaction:trx withOrgMinimaObjectsWitness:wit];
  if (witcheck == nil) {
    OrgMinimaUtilsMinimaLogger_logWithNSString_(JreStrcat("$@", @"ERROR MMR Proofs could not be found for transaction ", trx));
    return nil;
  }
  OrgMinimaObjectsBaseMiniData *transhash = [((OrgMinimaUtilsCrypto *) nil_chk(OrgMinimaUtilsCrypto_getInstance())) hashObjectWithOrgMinimaUtilsStreamable:trx];
  for (OrgMinimaObjectsBaseMiniData * __strong pubk in sigpubk) {
    OrgMinimaObjectsPubPrivKey *signer = [((id<OrgMinimaDatabaseUserdbUserDB>) nil_chk([self getUserDB])) getPubPrivKeyWithOrgMinimaObjectsBaseMiniData:pubk];
    OrgMinimaObjectsBaseMiniData *signature = [((OrgMinimaObjectsPubPrivKey *) nil_chk(signer)) signWithOrgMinimaObjectsBaseMiniData:transhash];
    [wit addSignatureWithOrgMinimaObjectsBaseMiniData:pubk withOrgMinimaObjectsBaseMiniData:signature];
  }
  OrgMinimaUtilsMessagesMessage *ret = new_OrgMinimaUtilsMessagesMessage_initWithNSString_(OrgMinimaSystemBrainsConsensusHandler_CONSENSUS_SENDTRANS);
  (void) [ret addObjectWithNSString:@"transaction" withId:trx];
  (void) [ret addObjectWithNSString:@"witness" withId:wit];
  return ret;
}

- (OrgMinimaObjectsTxPOW *)getCurrentTxPowWithOrgMinimaObjectsTransaction:(OrgMinimaObjectsTransaction *)zTrans
                                              withOrgMinimaObjectsWitness:(OrgMinimaObjectsWitness *)zWitness
                                          withOrgMinimaUtilsJsonJSONArray:(OrgMinimaUtilsJsonJSONArray *)zContractLogs {
  OrgMinimaDatabaseTxpowtreeBlockTreeNode *tip = [((OrgMinimaDatabaseTxpowtreeBlockTree *) nil_chk(mMainTree_)) getChainTip];
  OrgMinimaObjectsTxPOW *txpow = new_OrgMinimaObjectsTxPOW_init();
  [txpow setTimeSecsWithOrgMinimaObjectsBaseMiniNumber:new_OrgMinimaObjectsBaseMiniNumber_initWithNSString_(JreStrcat("J", (JavaLangSystem_currentTimeMillis() / 1000)))];
  [txpow setTransactionWithOrgMinimaObjectsTransaction:zTrans];
  [txpow setWitnessWithOrgMinimaObjectsWitness:zWitness];
  [txpow setTxDifficultyWithOrgMinimaObjectsBaseMiniData:JreLoadStatic(OrgMinimaSystemTxpowTxPoWMiner, BASE_TXN)];
  [txpow setBlockDifficultyWithOrgMinimaObjectsBaseMiniData:JreLoadStatic(OrgMinimaSystemTxpowTxPoWMiner, BASE_BLOCK)];
  [txpow setBlockNumberWithOrgMinimaObjectsBaseMiniNumber:[((OrgMinimaObjectsBaseMiniNumber *) nil_chk([((OrgMinimaObjectsTxPOW *) nil_chk([((OrgMinimaDatabaseTxpowtreeBlockTreeNode *) nil_chk(tip)) getTxPow])) getBlockNumber])) increment]];
  [txpow setParentWithOrgMinimaObjectsBaseMiniData:[tip getTxPowID]];
  {
    jint len = [((JavaUtilArrayList *) nil_chk([((OrgMinimaDatabaseTxpowtreeBlockTree *) nil_chk(mMainTree_)) getAsList])) size];
    if (len > OrgMinimaGlobalParams_MINIMA_CASCADE_START_DEPTH) {
      OrgMinimaObjectsBaseMiniNumber *actualspeed = [((OrgMinimaDatabaseTxpowtreeBlockTree *) nil_chk(mMainTree_)) getChainSpeed];
      OrgMinimaObjectsBaseMiniNumber *speedratio = [((OrgMinimaObjectsBaseMiniNumber *) nil_chk(JreLoadStatic(OrgMinimaGlobalParams, MINIMA_BLOCK_SPEED))) divWithOrgMinimaObjectsBaseMiniNumber:actualspeed];
      JavaMathBigInteger *avgdiff = [((OrgMinimaDatabaseTxpowtreeBlockTree *) nil_chk(mMainTree_)) getAvgChainDifficulty];
      JavaMathBigDecimal *avgdiffdec = new_JavaMathBigDecimal_initWithJavaMathBigInteger_(avgdiff);
      JavaMathBigDecimal *newdiffdec = [avgdiffdec multiplyWithJavaMathBigDecimal:[((OrgMinimaObjectsBaseMiniNumber *) nil_chk(speedratio)) getAsBigDecimal]];
      JavaMathBigInteger *newdiff = [((JavaMathBigDecimal *) nil_chk(newdiffdec)) toBigInteger];
      if ([((JavaMathBigInteger *) nil_chk(newdiff)) compareToWithId:JreLoadStatic(OrgMinimaUtilsCrypto, MAX_VAL)] > 0) {
        newdiff = JreLoadStatic(OrgMinimaUtilsCrypto, MAX_VAL);
      }
      OrgMinimaObjectsBaseMiniData *diffhash = new_OrgMinimaObjectsBaseMiniData_initWithNSString_(JreStrcat("$$", @"0x", [((JavaMathBigInteger *) nil_chk(newdiff)) toStringWithInt:16]));
      [txpow setBlockDifficultyWithOrgMinimaObjectsBaseMiniData:diffhash];
    }
  }
  for (jint i = 0; i < OrgMinimaGlobalParams_MINIMA_CASCADE_LEVELS; i++) {
    (void) IOSObjectArray_Set(nil_chk(txpow->mSuperParents_), i, IOSObjectArray_Get(nil_chk(((OrgMinimaObjectsTxPOW *) nil_chk([tip getTxPow]))->mSuperParents_), i));
  }
  jint sbl = [tip getSuperBlockLevel];
  OrgMinimaObjectsBaseMiniData *tiptxid = [tip getTxPowID];
  for (jint i = sbl; i >= 0; i--) {
    (void) IOSObjectArray_Set(nil_chk(txpow->mSuperParents_), i, tiptxid);
  }
  OrgMinimaDatabaseMmrMMRSet *newset = new_OrgMinimaDatabaseMmrMMRSet_initWithOrgMinimaDatabaseMmrMMRSet_([tip getMMRSet]);
  if (![((OrgMinimaObjectsTransaction *) nil_chk(zTrans)) isEmpty]) {
    jboolean valid = OrgMinimaSystemTxpowTxPoWChecker_checkTransactionMMRWithOrgMinimaObjectsTransaction_withOrgMinimaObjectsWitness_withOrgMinimaDatabaseMinimaDB_withOrgMinimaObjectsBaseMiniNumber_withOrgMinimaDatabaseMmrMMRSet_withBoolean_withOrgMinimaUtilsJsonJSONArray_(zTrans, zWitness, self, [txpow getBlockNumber], newset, true, zContractLogs);
    if (!valid) {
      OrgMinimaUtilsMinimaLogger_logWithNSString_(@"ERROR: Your own transaction is invalid !?");
      return nil;
    }
  }
  __unused JavaUtilArrayList *unused = [((id<OrgMinimaDatabaseTxpowdbTxPowDB>) nil_chk(mTxPOWDB_)) getAllUnusedTxPOW];
  for (id<OrgMinimaDatabaseTxpowdbTxPOWDBRow> __strong row in nil_chk(unused)) {
    OrgMinimaObjectsTxPOW *txp = [((id<OrgMinimaDatabaseTxpowdbTxPOWDBRow>) nil_chk(row)) getTxPOW];
    if ([((OrgMinimaObjectsTxPOW *) nil_chk(txp)) isTransaction]) {
      jboolean valid = OrgMinimaSystemTxpowTxPoWChecker_checkTransactionMMRWithOrgMinimaObjectsTxPOW_withOrgMinimaDatabaseMinimaDB_withOrgMinimaObjectsBaseMiniNumber_withOrgMinimaDatabaseMmrMMRSet_withBoolean_(txp, self, [txpow getBlockNumber], newset, true);
      if (valid) {
        [txpow addBlockTxPOWWithOrgMinimaObjectsTxPOW:txp];
      }
      else {
        [((id<OrgMinimaDatabaseTxpowdbTxPowDB>) nil_chk(mTxPOWDB_)) removeTxPOWWithOrgMinimaObjectsBaseMiniData:[txp getTxPowID]];
        [((OrgMinimaSystemBackupBackupManager *) nil_chk([self getBackup])) deleteTxpowWithOrgMinimaObjectsTxPOW:txp];
        OrgMinimaUtilsMinimaLogger_logWithNSString_(JreStrcat("$@", @"Removing invalid TXPOW.. ", txp));
      }
    }
  }
  OrgMinimaDatabaseMmrMMRData *root = [newset getMMRRoot];
  [txpow setMMRRootWithOrgMinimaObjectsBaseMiniData:[((OrgMinimaDatabaseMmrMMRData *) nil_chk(root)) getFinalHash]];
  [txpow setMMRTotalWithOrgMinimaObjectsBaseMMRSumNumber:[root getValueSum]];
  return txpow;
}

- (OrgMinimaObjectsBaseMiniNumber *)getTopBlock {
  return [((OrgMinimaObjectsTxPOW *) nil_chk([((OrgMinimaDatabaseTxpowtreeBlockTreeNode *) nil_chk([((OrgMinimaDatabaseTxpowtreeBlockTree *) nil_chk([self getMainTree])) getChainTip])) getTxPow])) getBlockNumber];
}

- (OrgMinimaSystemBackupSyncPackage *)getSyncPackage {
  OrgMinimaSystemBackupSyncPackage *sp = new_OrgMinimaSystemBackupSyncPackage_init();
  if ([((OrgMinimaDatabaseTxpowtreeBlockTree *) nil_chk([self getMainTree])) getChainRoot] == nil) {
    return sp;
  }
  OrgMinimaObjectsBaseMiniNumber *casc = [((OrgMinimaObjectsTxPOW *) nil_chk([((OrgMinimaDatabaseTxpowtreeBlockTreeNode *) nil_chk([((OrgMinimaDatabaseTxpowtreeBlockTree *) nil_chk([self getMainTree])) getCascadeNode])) getTxPow])) getBlockNumber];
  [sp setCascadeNodeWithOrgMinimaObjectsBaseMiniNumber:casc];
  JavaUtilArrayList *nodes = [((OrgMinimaDatabaseTxpowtreeBlockTree *) nil_chk([self getMainTree])) getAsList];
  for (OrgMinimaDatabaseTxpowtreeBlockTreeNode * __strong node in nil_chk(nodes)) {
    OrgMinimaObjectsBaseMiniNumber *block = [((OrgMinimaObjectsTxPOW *) nil_chk([((OrgMinimaDatabaseTxpowtreeBlockTreeNode *) nil_chk(node)) getTxPow])) getBlockNumber];
    [((JavaUtilArrayList *) nil_chk([sp getAllNodes])) addWithInt:0 withId:new_OrgMinimaSystemBackupSyncPacket_initWithOrgMinimaDatabaseTxpowtreeBlockTreeNode_withBoolean_(node, [((OrgMinimaObjectsBaseMiniNumber *) nil_chk(block)) isLessEqualWithOrgMinimaObjectsBaseMiniNumber:casc])];
  }
  return sp;
}

- (jint)getIntroSyncSize {
  OrgMinimaSystemBackupSyncPackage *sp = [self getSyncPackage];
  @try {
    JavaIoByteArrayOutputStream *baos = new_JavaIoByteArrayOutputStream_init();
    JavaIoDataOutputStream *dos = new_JavaIoDataOutputStream_initWithJavaIoOutputStream_(baos);
    [((OrgMinimaSystemBackupSyncPackage *) nil_chk(sp)) writeDataStreamWithJavaIoDataOutputStream:dos];
    [dos flush];
    [dos close];
    return ((IOSByteArray *) nil_chk([baos toByteArray]))->size_;
  }
  @catch (JavaLangException *exc) {
    [exc printStackTrace];
  }
  return 0;
}

- (OrgMinimaDatabaseTxpowtreeBlockTree *)getMainTree {
  return mMainTree_;
}

- (id<OrgMinimaDatabaseTxpowdbTxPowDB>)getTxPowDB {
  return mTxPOWDB_;
}

- (id<OrgMinimaDatabaseCoindbCoinDB>)getCoinDB {
  return mCoinDB_;
}

- (id<OrgMinimaDatabaseUserdbUserDB>)getUserDB {
  return mUserDB_;
}

- (void)setUserDBWithOrgMinimaDatabaseUserdbJavaJavaUserDB:(OrgMinimaDatabaseUserdbJavaJavaUserDB *)zJDB {
  mUserDB_ = zJDB;
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x1, 0, 1, -1, -1, -1, -1 },
    { NULL, "LOrgMinimaSystemBackupBackupManager;", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "LOrgMinimaObjectsTxPOW;", 0x1, 2, 3, -1, -1, -1, -1 },
    { NULL, "LOrgMinimaDatabaseTxpowdbTxPOWDBRow;", 0x1, 4, 3, -1, -1, -1, -1 },
    { NULL, "LOrgMinimaDatabaseTxpowtreeBlockTreeNode;", 0x1, 5, 3, -1, -1, -1, -1 },
    { NULL, "V", 0x1, 6, 7, -1, -1, -1, -1 },
    { NULL, "V", 0x1, 8, 9, -1, -1, -1, -1 },
    { NULL, "V", 0x2, 10, 3, -1, -1, -1, -1 },
    { NULL, "V", 0x2, 11, 12, -1, -1, -1, -1 },
    { NULL, "Z", 0x2, 13, 14, -1, -1, -1, -1 },
    { NULL, "LOrgMinimaDatabaseTxpowdbTxPOWDBRow;", 0x1, 15, 7, -1, -1, -1, -1 },
    { NULL, "LOrgMinimaDatabaseTxpowtreeBlockTreeNode;", 0x1, 16, 17, -1, -1, -1, -1 },
    { NULL, "V", 0x1, 18, 19, -1, -1, -1, -1 },
    { NULL, "V", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x1, 20, 21, -1, -1, -1, -1 },
    { NULL, "V", 0x1, 22, 21, -1, -1, -1, -1 },
    { NULL, "Z", 0x1, 23, 3, -1, -1, -1, -1 },
    { NULL, "LJavaUtilArrayList;", 0x1, 24, 3, -1, 25, -1, -1 },
    { NULL, "Z", 0x1, 26, 21, -1, -1, -1, -1 },
    { NULL, "LJavaUtilArrayList;", 0x1, -1, -1, -1, 27, -1, -1 },
    { NULL, "LJavaUtilHashtable;", 0x1, -1, -1, -1, 28, -1, -1 },
    { NULL, "LJavaUtilHashtable;", 0x1, 29, 7, -1, 30, -1, -1 },
    { NULL, "LOrgMinimaObjectsWitness;", 0x1, 31, 32, -1, -1, -1, -1 },
    { NULL, "LOrgMinimaUtilsMessagesMessage;", 0x1, 33, 34, -1, 35, -1, -1 },
    { NULL, "LOrgMinimaUtilsMessagesMessage;", 0x1, 33, 36, -1, 37, -1, -1 },
    { NULL, "LOrgMinimaObjectsTxPOW;", 0x1, 38, 39, -1, -1, -1, -1 },
    { NULL, "LOrgMinimaObjectsBaseMiniNumber;", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "LOrgMinimaSystemBackupSyncPackage;", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "I", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "LOrgMinimaDatabaseTxpowtreeBlockTree;", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "LOrgMinimaDatabaseTxpowdbTxPowDB;", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "LOrgMinimaDatabaseCoindbCoinDB;", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "LOrgMinimaDatabaseUserdbUserDB;", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x1, 40, 41, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  #pragma clang diagnostic ignored "-Wundeclared-selector"
  methods[0].selector = @selector(init);
  methods[1].selector = @selector(setBackupManagerWithOrgMinimaSystemBackupBackupManager:);
  methods[2].selector = @selector(getBackup);
  methods[3].selector = @selector(DoGenesis);
  methods[4].selector = @selector(getTxPOWWithOrgMinimaObjectsBaseMiniData:);
  methods[5].selector = @selector(getTxPOWRowWithOrgMinimaObjectsBaseMiniData:);
  methods[6].selector = @selector(getBlockTreeNodeWithOrgMinimaObjectsBaseMiniData:);
  methods[7].selector = @selector(processTxPOWWithOrgMinimaObjectsTxPOW:);
  methods[8].selector = @selector(scanMMRSetForCoinsWithOrgMinimaDatabaseMmrMMRSet:);
  methods[9].selector = @selector(addTreeChildrenWithOrgMinimaObjectsBaseMiniData:);
  methods[10].selector = @selector(sortBlockTreeNodeStatesWithOrgMinimaDatabaseTxpowtreeBlockTreeNode:withInt:);
  methods[11].selector = @selector(checkFullTxPOWWithOrgMinimaObjectsTxPOW:withOrgMinimaDatabaseMmrMMRSet:);
  methods[12].selector = @selector(addNewTxPowWithOrgMinimaObjectsTxPOW:);
  methods[13].selector = @selector(hardAddTxPOWBlockWithOrgMinimaObjectsTxPOW:withOrgMinimaDatabaseMmrMMRSet:withBoolean:);
  methods[14].selector = @selector(hardSetCascadeNodeWithOrgMinimaDatabaseTxpowtreeBlockTreeNode:);
  methods[15].selector = @selector(hardResetChain);
  methods[16].selector = @selector(addMiningTransactionWithOrgMinimaObjectsTransaction:);
  methods[17].selector = @selector(remeoveMiningTransactionWithOrgMinimaObjectsTransaction:);
  methods[18].selector = @selector(checkInputForMiningWithOrgMinimaObjectsBaseMiniData:);
  methods[19].selector = @selector(getTotalSimpleSpendableCoinsWithOrgMinimaObjectsBaseMiniData:);
  methods[20].selector = @selector(checkTransactionForMempoolCoinsWithOrgMinimaObjectsTransaction:);
  methods[21].selector = @selector(getMempoolCoins);
  methods[22].selector = @selector(getTotalUnusedAmount);
  methods[23].selector = @selector(getTransactionTokenAmountsWithOrgMinimaObjectsTxPOW:);
  methods[24].selector = @selector(createValidMMRPRoofsWithOrgMinimaObjectsTransaction:withOrgMinimaObjectsWitness:);
  methods[25].selector = @selector(createTransactionWithOrgMinimaObjectsBaseMiniNumber:withOrgMinimaObjectsAddress:withOrgMinimaObjectsAddress:withJavaUtilArrayList:withOrgMinimaObjectsBaseMiniData:withOrgMinimaObjectsBaseMiniData:withOrgMinimaObjectsProofsTokenProof:);
  methods[26].selector = @selector(createTransactionWithOrgMinimaObjectsBaseMiniNumber:withOrgMinimaObjectsAddress:withOrgMinimaObjectsAddress:withJavaUtilArrayList:withOrgMinimaObjectsBaseMiniData:withOrgMinimaObjectsBaseMiniData:withOrgMinimaObjectsProofsTokenProof:withOrgMinimaObjectsTransaction:);
  methods[27].selector = @selector(getCurrentTxPowWithOrgMinimaObjectsTransaction:withOrgMinimaObjectsWitness:withOrgMinimaUtilsJsonJSONArray:);
  methods[28].selector = @selector(getTopBlock);
  methods[29].selector = @selector(getSyncPackage);
  methods[30].selector = @selector(getIntroSyncSize);
  methods[31].selector = @selector(getMainTree);
  methods[32].selector = @selector(getTxPowDB);
  methods[33].selector = @selector(getCoinDB);
  methods[34].selector = @selector(getUserDB);
  methods[35].selector = @selector(setUserDBWithOrgMinimaDatabaseUserdbJavaJavaUserDB:);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "mTxPOWDB_", "LOrgMinimaDatabaseTxpowdbTxPowDB;", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "mMainTree_", "LOrgMinimaDatabaseTxpowtreeBlockTree;", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "mCoinDB_", "LOrgMinimaDatabaseCoindbCoinDB;", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "mUserDB_", "LOrgMinimaDatabaseUserdbUserDB;", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "mBackup_", "LOrgMinimaSystemBackupBackupManager;", .constantValue.asLong = 0, 0x0, -1, -1, -1, -1 },
    { "mMiningTransactions_", "LJavaUtilHashtable;", .constantValue.asLong = 0, 0x0, -1, -1, 42, -1 },
  };
  static const void *ptrTable[] = { "setBackupManager", "LOrgMinimaSystemBackupBackupManager;", "getTxPOW", "LOrgMinimaObjectsBaseMiniData;", "getTxPOWRow", "getBlockTreeNode", "processTxPOW", "LOrgMinimaObjectsTxPOW;", "scanMMRSetForCoins", "LOrgMinimaDatabaseMmrMMRSet;", "addTreeChildren", "sortBlockTreeNodeStates", "LOrgMinimaDatabaseTxpowtreeBlockTreeNode;I", "checkFullTxPOW", "LOrgMinimaObjectsTxPOW;LOrgMinimaDatabaseMmrMMRSet;", "addNewTxPow", "hardAddTxPOWBlock", "LOrgMinimaObjectsTxPOW;LOrgMinimaDatabaseMmrMMRSet;Z", "hardSetCascadeNode", "LOrgMinimaDatabaseTxpowtreeBlockTreeNode;", "addMiningTransaction", "LOrgMinimaObjectsTransaction;", "remeoveMiningTransaction", "checkInputForMining", "getTotalSimpleSpendableCoins", "(Lorg/minima/objects/base/MiniData;)Ljava/util/ArrayList<Lorg/minima/objects/Coin;>;", "checkTransactionForMempoolCoins", "()Ljava/util/ArrayList<Lorg/minima/objects/Coin;>;", "()Ljava/util/Hashtable<Ljava/lang/String;Lorg/minima/objects/base/MiniNumber;>;", "getTransactionTokenAmounts", "(Lorg/minima/objects/TxPOW;)Ljava/util/Hashtable<Ljava/lang/String;Lorg/minima/objects/base/MiniNumber;>;", "createValidMMRPRoofs", "LOrgMinimaObjectsTransaction;LOrgMinimaObjectsWitness;", "createTransaction", "LOrgMinimaObjectsBaseMiniNumber;LOrgMinimaObjectsAddress;LOrgMinimaObjectsAddress;LJavaUtilArrayList;LOrgMinimaObjectsBaseMiniData;LOrgMinimaObjectsBaseMiniData;LOrgMinimaObjectsProofsTokenProof;", "(Lorg/minima/objects/base/MiniNumber;Lorg/minima/objects/Address;Lorg/minima/objects/Address;Ljava/util/ArrayList<Lorg/minima/objects/Coin;>;Lorg/minima/objects/base/MiniData;Lorg/minima/objects/base/MiniData;Lorg/minima/objects/proofs/TokenProof;)Lorg/minima/utils/messages/Message;", "LOrgMinimaObjectsBaseMiniNumber;LOrgMinimaObjectsAddress;LOrgMinimaObjectsAddress;LJavaUtilArrayList;LOrgMinimaObjectsBaseMiniData;LOrgMinimaObjectsBaseMiniData;LOrgMinimaObjectsProofsTokenProof;LOrgMinimaObjectsTransaction;", "(Lorg/minima/objects/base/MiniNumber;Lorg/minima/objects/Address;Lorg/minima/objects/Address;Ljava/util/ArrayList<Lorg/minima/objects/Coin;>;Lorg/minima/objects/base/MiniData;Lorg/minima/objects/base/MiniData;Lorg/minima/objects/proofs/TokenProof;Lorg/minima/objects/Transaction;)Lorg/minima/utils/messages/Message;", "getCurrentTxPow", "LOrgMinimaObjectsTransaction;LOrgMinimaObjectsWitness;LOrgMinimaUtilsJsonJSONArray;", "setUserDB", "LOrgMinimaDatabaseUserdbJavaJavaUserDB;", "Ljava/util/Hashtable<Ljava/lang/String;Lorg/minima/objects/Transaction;>;" };
  static const J2ObjcClassInfo _OrgMinimaDatabaseMinimaDB = { "MinimaDB", "org.minima.database", ptrTable, methods, fields, 7, 0x1, 36, 6, -1, -1, -1, -1, -1 };
  return &_OrgMinimaDatabaseMinimaDB;
}

@end

void OrgMinimaDatabaseMinimaDB_init(OrgMinimaDatabaseMinimaDB *self) {
  NSObject_init(self);
  self->mBackup_ = nil;
  self->mMiningTransactions_ = new_JavaUtilHashtable_init();
  self->mTxPOWDB_ = new_OrgMinimaDatabaseTxpowdbJavaJavaDB_init();
  self->mMainTree_ = new_OrgMinimaDatabaseTxpowtreeBlockTree_init();
  self->mCoinDB_ = new_OrgMinimaDatabaseCoindbJavaJavaCoinDB_init();
  self->mUserDB_ = new_OrgMinimaDatabaseUserdbJavaJavaUserDB_init();
}

OrgMinimaDatabaseMinimaDB *new_OrgMinimaDatabaseMinimaDB_init() {
  J2OBJC_NEW_IMPL(OrgMinimaDatabaseMinimaDB, init)
}

OrgMinimaDatabaseMinimaDB *create_OrgMinimaDatabaseMinimaDB_init() {
  J2OBJC_CREATE_IMPL(OrgMinimaDatabaseMinimaDB, init)
}

void OrgMinimaDatabaseMinimaDB_addTreeChildrenWithOrgMinimaObjectsBaseMiniData_(OrgMinimaDatabaseMinimaDB *self, OrgMinimaObjectsBaseMiniData *zParentID) {
  __unused JavaUtilArrayList *unused_children = [((id<OrgMinimaDatabaseTxpowdbTxPowDB>) nil_chk(self->mTxPOWDB_)) getChildBlocksTxPOWWithOrgMinimaObjectsBaseMiniData:zParentID];
  for (id<OrgMinimaDatabaseTxpowdbTxPOWDBRow> __strong txp in nil_chk(unused_children)) {
    [((OrgMinimaDatabaseTxpowtreeBlockTree *) nil_chk(self->mMainTree_)) addNodeWithOrgMinimaDatabaseTxpowtreeBlockTreeNode:new_OrgMinimaDatabaseTxpowtreeBlockTreeNode_initWithOrgMinimaObjectsTxPOW_([((id<OrgMinimaDatabaseTxpowdbTxPOWDBRow>) nil_chk(txp)) getTxPOW])];
    OrgMinimaDatabaseMinimaDB_addTreeChildrenWithOrgMinimaObjectsBaseMiniData_(self, [((OrgMinimaObjectsTxPOW *) nil_chk([txp getTxPOW])) getTxPowID]);
  }
}

void OrgMinimaDatabaseMinimaDB_sortBlockTreeNodeStatesWithOrgMinimaDatabaseTxpowtreeBlockTreeNode_withInt_(OrgMinimaDatabaseMinimaDB *self, OrgMinimaDatabaseTxpowtreeBlockTreeNode *zNode, jint zParentState) {
  id<OrgMinimaDatabaseTxpowdbTxPOWDBRow> row = [self getTxPOWRowWithOrgMinimaObjectsBaseMiniData:[((OrgMinimaDatabaseTxpowtreeBlockTreeNode *) nil_chk(zNode)) getTxPowID]];
  if (zParentState == OrgMinimaDatabaseTxpowtreeBlockTreeNode_BLOCKSTATE_INVALID) {
    [zNode setStateWithInt:OrgMinimaDatabaseTxpowtreeBlockTreeNode_BLOCKSTATE_INVALID];
  }
  else if (zParentState == OrgMinimaDatabaseTxpowtreeBlockTreeNode_BLOCKSTATE_VALID) {
    if ([zNode getState] == OrgMinimaDatabaseTxpowtreeBlockTreeNode_BLOCKSTATE_BASIC && [((id<OrgMinimaDatabaseTxpowdbTxPOWDBRow>) nil_chk(row)) getBlockState] == OrgMinimaDatabaseTxpowdbTxPOWDBRow_TXPOWDBROW_STATE_FULL) {
      jboolean allok = true;
      OrgMinimaDatabaseMmrMMRSet *mmrset = new_OrgMinimaDatabaseMmrMMRSet_initWithOrgMinimaDatabaseMmrMMRSet_([((OrgMinimaDatabaseTxpowtreeBlockTreeNode *) nil_chk([zNode getParent])) getMMRSet]);
      [zNode setMMRsetWithOrgMinimaDatabaseMmrMMRSet:mmrset];
      allok = OrgMinimaDatabaseMinimaDB_checkFullTxPOWWithOrgMinimaObjectsTxPOW_withOrgMinimaDatabaseMmrMMRSet_(self, [zNode getTxPow], mmrset);
      if (allok) {
        OrgMinimaObjectsBaseMiniData *root = [((OrgMinimaDatabaseMmrMMRData *) nil_chk([mmrset getMMRRoot])) getFinalHash];
        if (![((OrgMinimaObjectsBaseMiniData *) nil_chk([((OrgMinimaObjectsTxPOW *) nil_chk([((id<OrgMinimaDatabaseTxpowdbTxPOWDBRow>) nil_chk(row)) getTxPOW])) getMMRRoot])) isEqualWithOrgMinimaObjectsBaseMiniData:root]) {
          allok = false;
        }
      }
      if (allok) {
        [zNode setStateWithInt:OrgMinimaDatabaseTxpowtreeBlockTreeNode_BLOCKSTATE_VALID];
      }
      else {
        [zNode setStateWithInt:OrgMinimaDatabaseTxpowtreeBlockTreeNode_BLOCKSTATE_INVALID];
      }
    }
  }
  JavaUtilArrayList *children = [zNode getChildren];
  for (OrgMinimaDatabaseTxpowtreeBlockTreeNode * __strong child in nil_chk(children)) {
    OrgMinimaDatabaseMinimaDB_sortBlockTreeNodeStatesWithOrgMinimaDatabaseTxpowtreeBlockTreeNode_withInt_(self, child, [zNode getState]);
  }
}

jboolean OrgMinimaDatabaseMinimaDB_checkFullTxPOWWithOrgMinimaObjectsTxPOW_withOrgMinimaDatabaseMmrMMRSet_(OrgMinimaDatabaseMinimaDB *self, OrgMinimaObjectsTxPOW *zBlock, OrgMinimaDatabaseMmrMMRSet *zMMRSet) {
  if ([((OrgMinimaObjectsTxPOW *) nil_chk(zBlock)) isTransaction]) {
    jboolean inputvalid = OrgMinimaSystemTxpowTxPoWChecker_checkTransactionMMRWithOrgMinimaObjectsTxPOW_withOrgMinimaDatabaseMinimaDB_withOrgMinimaObjectsBaseMiniNumber_withOrgMinimaDatabaseMmrMMRSet_withBoolean_(zBlock, self, [zBlock getBlockNumber], zMMRSet, true);
    if (!inputvalid) {
      return false;
    }
  }
  JavaUtilArrayList *txns = [zBlock getBlockTransactions];
  for (OrgMinimaObjectsBaseMiniData * __strong txn in nil_chk(txns)) {
    id<OrgMinimaDatabaseTxpowdbTxPOWDBRow> row = [self getTxPOWRowWithOrgMinimaObjectsBaseMiniData:txn];
    OrgMinimaObjectsTxPOW *txpow = [((id<OrgMinimaDatabaseTxpowdbTxPOWDBRow>) nil_chk(row)) getTxPOW];
    jboolean inputvalid = OrgMinimaSystemTxpowTxPoWChecker_checkTransactionMMRWithOrgMinimaObjectsTxPOW_withOrgMinimaDatabaseMinimaDB_withOrgMinimaObjectsBaseMiniNumber_withOrgMinimaDatabaseMmrMMRSet_withBoolean_(txpow, self, [zBlock getBlockNumber], zMMRSet, true);
    if (!inputvalid) {
      return false;
    }
  }
  return true;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgMinimaDatabaseMinimaDB)
