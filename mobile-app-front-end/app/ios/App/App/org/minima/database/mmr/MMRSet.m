//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ./org/minima/database/mmr/MMRSet.java
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "J2ObjC_source.h"
#include "java/io/DataInputStream.h"
#include "java/io/DataOutputStream.h"
#include "java/io/PrintStream.h"
#include "java/lang/Integer.h"
#include "java/lang/System.h"
#include "java/math/BigInteger.h"
#include "java/util/ArrayList.h"
#include "org/minima/database/mmr/MMRData.h"
#include "org/minima/database/mmr/MMREntry.h"
#include "org/minima/database/mmr/MMRProof.h"
#include "org/minima/database/mmr/MMRSet.h"
#include "org/minima/objects/Coin.h"
#include "org/minima/objects/base/MMRSumNumber.h"
#include "org/minima/objects/base/MiniByte.h"
#include "org/minima/objects/base/MiniData.h"
#include "org/minima/objects/base/MiniInteger.h"
#include "org/minima/objects/base/MiniNumber.h"
#include "org/minima/objects/proofs/Proof.h"
#include "org/minima/utils/Crypto.h"
#include "org/minima/utils/MinimaLogger.h"
#include "org/minima/utils/json/JSONArray.h"
#include "org/minima/utils/json/JSONObject.h"

@interface OrgMinimaDatabaseMmrMMRSet ()

- (void)setBlockTimeWithOrgMinimaObjectsBaseMiniNumber:(OrgMinimaObjectsBaseMiniNumber *)zTime;

- (void)incrementEntryNumber;

- (OrgMinimaDatabaseMmrMMREntry *)setEntryWithInt:(jint)zRow
              withOrgMinimaObjectsBaseMiniInteger:(OrgMinimaObjectsBaseMiniInteger *)zEntry
                  withOrgMinimaDatabaseMmrMMRData:(OrgMinimaDatabaseMmrMMRData *)zData;

- (OrgMinimaDatabaseMmrMMREntry *)getEntryWithInt:(jint)zRow
              withOrgMinimaObjectsBaseMiniInteger:(OrgMinimaObjectsBaseMiniInteger *)zEntry;

- (OrgMinimaDatabaseMmrMMRProof *)getPeakToRootWithOrgMinimaObjectsBaseMiniData:(OrgMinimaObjectsBaseMiniData *)zPeak;

@end

__attribute__((unused)) static void OrgMinimaDatabaseMmrMMRSet_setBlockTimeWithOrgMinimaObjectsBaseMiniNumber_(OrgMinimaDatabaseMmrMMRSet *self, OrgMinimaObjectsBaseMiniNumber *zTime);

__attribute__((unused)) static void OrgMinimaDatabaseMmrMMRSet_incrementEntryNumber(OrgMinimaDatabaseMmrMMRSet *self);

__attribute__((unused)) static OrgMinimaDatabaseMmrMMREntry *OrgMinimaDatabaseMmrMMRSet_setEntryWithInt_withOrgMinimaObjectsBaseMiniInteger_withOrgMinimaDatabaseMmrMMRData_(OrgMinimaDatabaseMmrMMRSet *self, jint zRow, OrgMinimaObjectsBaseMiniInteger *zEntry, OrgMinimaDatabaseMmrMMRData *zData);

__attribute__((unused)) static OrgMinimaDatabaseMmrMMREntry *OrgMinimaDatabaseMmrMMRSet_getEntryWithInt_withOrgMinimaObjectsBaseMiniInteger_(OrgMinimaDatabaseMmrMMRSet *self, jint zRow, OrgMinimaObjectsBaseMiniInteger *zEntry);

__attribute__((unused)) static OrgMinimaDatabaseMmrMMRProof *OrgMinimaDatabaseMmrMMRSet_getPeakToRootWithOrgMinimaObjectsBaseMiniData_(OrgMinimaDatabaseMmrMMRSet *self, OrgMinimaObjectsBaseMiniData *zPeak);

@implementation OrgMinimaDatabaseMmrMMRSet

J2OBJC_IGNORE_DESIGNATED_BEGIN
- (instancetype)init {
  OrgMinimaDatabaseMmrMMRSet_init(self);
  return self;
}
J2OBJC_IGNORE_DESIGNATED_END

- (instancetype)initWithInt:(jint)zBitLength {
  OrgMinimaDatabaseMmrMMRSet_initWithInt_(self, zBitLength);
  return self;
}

- (instancetype)initWithOrgMinimaDatabaseMmrMMRSet:(OrgMinimaDatabaseMmrMMRSet *)zParent {
  OrgMinimaDatabaseMmrMMRSet_initWithOrgMinimaDatabaseMmrMMRSet_(self, zParent);
  return self;
}

- (OrgMinimaUtilsJsonJSONObject *)toJSON {
  OrgMinimaUtilsJsonJSONObject *ret = new_OrgMinimaUtilsJsonJSONObject_init();
  (void) [ret putWithId:@"block" withId:mBlockTime_];
  (void) [ret putWithId:@"entrynumber" withId:mEntryNumber_];
  OrgMinimaUtilsJsonJSONArray *jentry = new_OrgMinimaUtilsJsonJSONArray_init();
  for (OrgMinimaDatabaseMmrMMREntry * __strong entry_ in nil_chk(mEntries_)) {
    [jentry addWithId:[((OrgMinimaDatabaseMmrMMREntry *) nil_chk(entry_)) toJSON]];
  }
  (void) [ret putWithId:@"entries" withId:jentry];
  (void) [ret putWithId:@"maxrow" withId:JavaLangInteger_valueOfWithInt_(mMaxRow_)];
  OrgMinimaUtilsJsonJSONArray *maxentry = new_OrgMinimaUtilsJsonJSONArray_init();
  {
    IOSObjectArray *a__ = mMaxEntries_;
    OrgMinimaDatabaseMmrMMREntry * const *b__ = ((IOSObjectArray *) nil_chk(a__))->buffer_;
    OrgMinimaDatabaseMmrMMREntry * const *e__ = b__ + a__->size_;
    while (b__ < e__) {
      OrgMinimaDatabaseMmrMMREntry *entry_ = *b__++;
      if (entry_ != nil) {
        [maxentry addWithId:[((OrgMinimaObjectsBaseMiniInteger *) nil_chk([entry_ getEntry])) description]];
      }
    }
  }
  (void) [ret putWithId:@"maxentries" withId:maxentry];
  OrgMinimaUtilsJsonJSONArray *keepers = new_OrgMinimaUtilsJsonJSONArray_init();
  for (OrgMinimaObjectsBaseMiniInteger * __strong keeper in nil_chk(mKeepers_)) {
    [keepers addWithId:[((OrgMinimaObjectsBaseMiniInteger *) nil_chk(keeper)) description]];
  }
  (void) [ret putWithId:@"keepers" withId:keepers];
  return ret;
}

- (instancetype)initWithOrgMinimaDatabaseMmrMMRSet:(OrgMinimaDatabaseMmrMMRSet *)zParent
                                           withInt:(jint)zBitLength {
  OrgMinimaDatabaseMmrMMRSet_initWithOrgMinimaDatabaseMmrMMRSet_withInt_(self, zParent, zBitLength);
  return self;
}

- (void)setParentWithOrgMinimaDatabaseMmrMMRSet:(OrgMinimaDatabaseMmrMMRSet *)zParent {
  mParent_ = zParent;
}

- (void)finalizeSet {
  mFinalized_ = false;
  mFinalizedPeaks_ = [self getMMRPeaks];
  mFinalizedRoot_ = [self getMMRRoot];
  mFinalizedZeroRow_ = [self getRowWithInt:0];
  mFinalized_ = true;
}

- (jboolean)isFinalized {
  return mFinalized_;
}

- (void)setBlockTimeWithOrgMinimaObjectsBaseMiniNumber:(OrgMinimaObjectsBaseMiniNumber *)zTime {
  OrgMinimaDatabaseMmrMMRSet_setBlockTimeWithOrgMinimaObjectsBaseMiniNumber_(self, zTime);
}

- (OrgMinimaObjectsBaseMiniNumber *)getBlockTime {
  return mBlockTime_;
}

- (OrgMinimaDatabaseMmrMMRSet *)getParent {
  return mParent_;
}

- (void)incrementEntryNumber {
  OrgMinimaDatabaseMmrMMRSet_incrementEntryNumber(self);
}

- (jint)getMaxRow {
  return [self getMaxRowWithBoolean:false];
}

- (jint)getMaxRowWithBoolean:(jboolean)zCheckParent {
  jint max = mMaxRow_;
  if (zCheckParent && mParent_ != nil) {
    jint pmax = [mParent_ getMaxRowWithBoolean:zCheckParent];
    if (pmax > max) {
      max = pmax;
    }
  }
  return max;
}

- (JavaUtilArrayList *)getRowWithInt:(jint)zRow {
  JavaUtilArrayList *row = new_JavaUtilArrayList_init();
  for (OrgMinimaDatabaseMmrMMREntry * __strong entry_ in nil_chk(mEntries_)) {
    if ([((OrgMinimaDatabaseMmrMMREntry *) nil_chk(entry_)) getRow] == zRow) {
      [row addWithId:entry_];
    }
  }
  return row;
}

- (JavaUtilArrayList *)getZeroRow {
  if (mFinalized_) {
    return mFinalizedZeroRow_;
  }
  else {
    return [self getRowWithInt:0];
  }
}

- (OrgMinimaDatabaseMmrMMREntry *)searchAddressWithOrgMinimaObjectsBaseMiniData:(OrgMinimaObjectsBaseMiniData *)zAddress
                                             withOrgMinimaObjectsBaseMiniNumber:(OrgMinimaObjectsBaseMiniNumber *)zAmount
                                               withOrgMinimaObjectsBaseMiniData:(OrgMinimaObjectsBaseMiniData *)zTokenID {
  JavaUtilArrayList *zero = [self getZeroRow];
  for (OrgMinimaDatabaseMmrMMREntry * __strong entry_ in nil_chk(zero)) {
    if (![((OrgMinimaDatabaseMmrMMRData *) nil_chk([((OrgMinimaDatabaseMmrMMREntry *) nil_chk(entry_)) getData])) isHashOnly]) {
      OrgMinimaObjectsCoin *cc = [((OrgMinimaDatabaseMmrMMRData *) nil_chk([entry_ getData])) getCoin];
      jboolean notspent = ![((OrgMinimaDatabaseMmrMMRData *) nil_chk([entry_ getData])) isSpent];
      jboolean addr = [((OrgMinimaObjectsBaseMiniData *) nil_chk([((OrgMinimaObjectsCoin *) nil_chk(cc)) getAddress])) isEqualWithOrgMinimaObjectsBaseMiniData:zAddress];
      jboolean amount = [((OrgMinimaObjectsBaseMiniNumber *) nil_chk([cc getAmount])) isMoreEqualWithOrgMinimaObjectsBaseMiniNumber:zAmount];
      jboolean tok = [((OrgMinimaObjectsBaseMiniData *) nil_chk([cc getTokenID])) isEqualWithOrgMinimaObjectsBaseMiniData:zTokenID];
      if (addr && amount && tok && notspent) {
        return entry_;
      }
    }
  }
  if (mParent_ != nil) {
    return [mParent_ searchAddressWithOrgMinimaObjectsBaseMiniData:zAddress withOrgMinimaObjectsBaseMiniNumber:zAmount withOrgMinimaObjectsBaseMiniData:zTokenID];
  }
  return nil;
}

- (OrgMinimaDatabaseMmrMMREntry *)findEntryWithOrgMinimaObjectsBaseMiniData:(OrgMinimaObjectsBaseMiniData *)zCoinID {
  JavaUtilArrayList *zero = [self getZeroRow];
  for (OrgMinimaDatabaseMmrMMREntry * __strong entry_ in nil_chk(zero)) {
    if (![((OrgMinimaDatabaseMmrMMRData *) nil_chk([((OrgMinimaDatabaseMmrMMREntry *) nil_chk(entry_)) getData])) isHashOnly]) {
      if ([((OrgMinimaObjectsBaseMiniData *) nil_chk([((OrgMinimaObjectsCoin *) nil_chk([((OrgMinimaDatabaseMmrMMRData *) nil_chk([entry_ getData])) getCoin])) getCoinID])) isEqualWithOrgMinimaObjectsBaseMiniData:zCoinID]) {
        return entry_;
      }
    }
  }
  if (mParent_ != nil) {
    return [mParent_ findEntryWithOrgMinimaObjectsBaseMiniData:zCoinID];
  }
  return nil;
}

- (OrgMinimaDatabaseMmrMMREntry *)setEntryWithInt:(jint)zRow
              withOrgMinimaObjectsBaseMiniInteger:(OrgMinimaObjectsBaseMiniInteger *)zEntry
                  withOrgMinimaDatabaseMmrMMRData:(OrgMinimaDatabaseMmrMMRData *)zData {
  return OrgMinimaDatabaseMmrMMRSet_setEntryWithInt_withOrgMinimaObjectsBaseMiniInteger_withOrgMinimaDatabaseMmrMMRData_(self, zRow, zEntry, zData);
}

- (OrgMinimaDatabaseMmrMMREntry *)getEntryWithInt:(jint)zRow
              withOrgMinimaObjectsBaseMiniInteger:(OrgMinimaObjectsBaseMiniInteger *)zEntry {
  return OrgMinimaDatabaseMmrMMRSet_getEntryWithInt_withOrgMinimaObjectsBaseMiniInteger_(self, zRow, zEntry);
}

- (OrgMinimaDatabaseMmrMMREntry *)addUnspentCoinWithOrgMinimaDatabaseMmrMMRData:(OrgMinimaDatabaseMmrMMRData *)zData {
  OrgMinimaDatabaseMmrMMREntry *entry_ = OrgMinimaDatabaseMmrMMRSet_setEntryWithInt_withOrgMinimaObjectsBaseMiniInteger_withOrgMinimaDatabaseMmrMMRData_(self, 0, mEntryNumber_, zData);
  OrgMinimaDatabaseMmrMMREntry *ret = entry_;
  OrgMinimaDatabaseMmrMMRSet_incrementEntryNumber(self);
  while ([((OrgMinimaDatabaseMmrMMREntry *) nil_chk(entry_)) isRight]) {
    OrgMinimaDatabaseMmrMMREntry *sibling = OrgMinimaDatabaseMmrMMRSet_getEntryWithInt_withOrgMinimaObjectsBaseMiniInteger_(self, [entry_ getRow], [entry_ getLeftSibling]);
    OrgMinimaObjectsBaseMiniData *combined = [((OrgMinimaUtilsCrypto *) nil_chk(OrgMinimaUtilsCrypto_getInstance())) hashObjectsWithOrgMinimaUtilsStreamable:[((OrgMinimaDatabaseMmrMMREntry *) nil_chk(sibling)) getHashValue] withOrgMinimaUtilsStreamable:[entry_ getHashValue] withInt:MMR_HASH_BITS_];
    OrgMinimaObjectsBaseMMRSumNumber *sumvalue = [((OrgMinimaObjectsBaseMMRSumNumber *) nil_chk([((OrgMinimaDatabaseMmrMMRData *) nil_chk([entry_ getData])) getValueSum])) addWithOrgMinimaObjectsBaseMMRSumNumber:[((OrgMinimaDatabaseMmrMMRData *) nil_chk([sibling getData])) getValueSum]];
    OrgMinimaDatabaseMmrMMRData *data = new_OrgMinimaDatabaseMmrMMRData_initWithOrgMinimaObjectsBaseMiniData_withOrgMinimaObjectsBaseMMRSumNumber_(combined, sumvalue);
    entry_ = OrgMinimaDatabaseMmrMMRSet_setEntryWithInt_withOrgMinimaObjectsBaseMiniInteger_withOrgMinimaDatabaseMmrMMRData_(self, [entry_ getParentRow], [entry_ getParentEntry], data);
  }
  return ret;
}

- (OrgMinimaDatabaseMmrMMREntry *)addExternalUnspentCoinWithOrgMinimaDatabaseMmrMMRProof:(OrgMinimaDatabaseMmrMMRProof *)zProof {
  OrgMinimaObjectsBaseMiniInteger *entrynum = [((OrgMinimaDatabaseMmrMMRProof *) nil_chk(zProof)) getEntryNumber];
  OrgMinimaDatabaseMmrMMRData *proofdata = [zProof getMMRData];
  OrgMinimaDatabaseMmrMMREntry *entry_ = OrgMinimaDatabaseMmrMMRSet_getEntryWithInt_withOrgMinimaObjectsBaseMiniInteger_(self, 0, entrynum);
  if (![((OrgMinimaDatabaseMmrMMREntry *) nil_chk(entry_)) isEmpty] && ![((OrgMinimaDatabaseMmrMMRData *) nil_chk([entry_ getData])) isHashOnly]) {
    [self addKeeperWithOrgMinimaObjectsBaseMiniInteger:entrynum];
    return entry_;
  }
  entry_ = OrgMinimaDatabaseMmrMMRSet_setEntryWithInt_withOrgMinimaObjectsBaseMiniInteger_withOrgMinimaDatabaseMmrMMRData_(self, 0, entrynum, proofdata);
  OrgMinimaDatabaseMmrMMREntry *ret = entry_;
  jint prooflen = [zProof getProofLen];
  jint proofnum = 0;
  while (proofnum < prooflen) {
    OrgMinimaDatabaseMmrMMREntry *sibling = OrgMinimaDatabaseMmrMMRSet_getEntryWithInt_withOrgMinimaObjectsBaseMiniInteger_(self, [((OrgMinimaDatabaseMmrMMREntry *) nil_chk(entry_)) getRow], [entry_ getSibling]);
    OrgMinimaObjectsProofsProof_ProofChunk *chunk = [zProof getProofChunkWithInt:proofnum++];
    OrgMinimaDatabaseMmrMMRData *pdata = new_OrgMinimaDatabaseMmrMMRData_initWithOrgMinimaObjectsBaseMiniData_withOrgMinimaObjectsBaseMMRSumNumber_([((OrgMinimaObjectsProofsProof_ProofChunk *) nil_chk(chunk)) getHash], [chunk getValue]);
    if ([((OrgMinimaDatabaseMmrMMREntry *) nil_chk(sibling)) isEmpty]) {
      sibling = OrgMinimaDatabaseMmrMMRSet_setEntryWithInt_withOrgMinimaObjectsBaseMiniInteger_withOrgMinimaDatabaseMmrMMRData_(self, [sibling getRow], [sibling getEntry], pdata);
    }
    else {
      if (![((OrgMinimaObjectsBaseMiniData *) nil_chk([((OrgMinimaDatabaseMmrMMRData *) nil_chk([sibling getData])) getFinalHash])) isEqualWithOrgMinimaObjectsBaseMiniData:[pdata getFinalHash]]) {
        [((JavaIoPrintStream *) nil_chk(JreLoadStatic(JavaLangSystem, out))) printlnWithNSString:JreStrcat("$@$", @"Sibling Inconsistency!! in MMR @ ", entrynum, @" when hard adding proof")];
        return nil;
      }
      else {
        break;
      }
    }
    OrgMinimaObjectsBaseMiniData *combined = nil;
    if ([entry_ isLeft]) {
      combined = [((OrgMinimaUtilsCrypto *) nil_chk(OrgMinimaUtilsCrypto_getInstance())) hashObjectsWithOrgMinimaUtilsStreamable:[entry_ getHashValue] withOrgMinimaUtilsStreamable:[((OrgMinimaDatabaseMmrMMREntry *) nil_chk(sibling)) getHashValue] withInt:MMR_HASH_BITS_];
    }
    else {
      combined = [((OrgMinimaUtilsCrypto *) nil_chk(OrgMinimaUtilsCrypto_getInstance())) hashObjectsWithOrgMinimaUtilsStreamable:[((OrgMinimaDatabaseMmrMMREntry *) nil_chk(sibling)) getHashValue] withOrgMinimaUtilsStreamable:[entry_ getHashValue] withInt:MMR_HASH_BITS_];
    }
    OrgMinimaObjectsBaseMMRSumNumber *sumvalue = [((OrgMinimaObjectsBaseMMRSumNumber *) nil_chk([((OrgMinimaDatabaseMmrMMRData *) nil_chk([entry_ getData])) getValueSum])) addWithOrgMinimaObjectsBaseMMRSumNumber:[((OrgMinimaDatabaseMmrMMRData *) nil_chk([sibling getData])) getValueSum]];
    OrgMinimaDatabaseMmrMMRData *data = new_OrgMinimaDatabaseMmrMMRData_initWithOrgMinimaObjectsBaseMiniData_withOrgMinimaObjectsBaseMMRSumNumber_(combined, sumvalue);
    OrgMinimaDatabaseMmrMMREntry *parent = OrgMinimaDatabaseMmrMMRSet_getEntryWithInt_withOrgMinimaObjectsBaseMiniInteger_(self, [entry_ getParentRow], [entry_ getParentEntry]);
    if (![((OrgMinimaDatabaseMmrMMREntry *) nil_chk(parent)) isEmpty]) {
      if (![((OrgMinimaObjectsBaseMiniData *) nil_chk([((OrgMinimaDatabaseMmrMMRData *) nil_chk([parent getData])) getFinalHash])) isEqualWithOrgMinimaObjectsBaseMiniData:combined]) {
        [((JavaIoPrintStream *) nil_chk(JreLoadStatic(JavaLangSystem, out))) printlnWithNSString:JreStrcat("$@$", @"Parent Inconsistency!! in MMR @ ", entrynum, @" when hard adding proof")];
        return nil;
      }
      else {
        break;
      }
    }
    entry_ = OrgMinimaDatabaseMmrMMRSet_setEntryWithInt_withOrgMinimaObjectsBaseMiniInteger_withOrgMinimaDatabaseMmrMMRData_(self, [entry_ getParentRow], [entry_ getParentEntry], data);
  }
  [self addKeeperWithOrgMinimaObjectsBaseMiniInteger:entrynum];
  return ret;
}

- (OrgMinimaDatabaseMmrMMREntry *)updateSpentCoinWithOrgMinimaDatabaseMmrMMRProof:(OrgMinimaDatabaseMmrMMRProof *)zProof {
  OrgMinimaDatabaseMmrMMRData *original = [((OrgMinimaDatabaseMmrMMRProof *) nil_chk(zProof)) getMMRData];
  OrgMinimaDatabaseMmrMMRData *spentmmr = new_OrgMinimaDatabaseMmrMMRData_initWithOrgMinimaObjectsBaseMiniByte_withOrgMinimaObjectsCoin_withOrgMinimaObjectsBaseMiniNumber_withJavaUtilArrayList_(JreLoadStatic(OrgMinimaObjectsBaseMiniByte, TRUE), [((OrgMinimaDatabaseMmrMMRData *) nil_chk(original)) getCoin], [original getInBlock], [original getPrevState]);
  JavaUtilArrayList *peaks = [self getMMRPeaks];
  OrgMinimaDatabaseMmrMMREntry *entry_ = OrgMinimaDatabaseMmrMMRSet_setEntryWithInt_withOrgMinimaObjectsBaseMiniInteger_withOrgMinimaDatabaseMmrMMRData_(self, 0, [zProof getEntryNumber], spentmmr);
  OrgMinimaDatabaseMmrMMREntry *ret = entry_;
  OrgMinimaDatabaseMmrMMREntry *sibling = OrgMinimaDatabaseMmrMMRSet_getEntryWithInt_withOrgMinimaObjectsBaseMiniInteger_(self, 0, [((OrgMinimaDatabaseMmrMMREntry *) nil_chk(entry_)) getSibling]);
  jint prooflen = [zProof getProofLen];
  if ([((OrgMinimaDatabaseMmrMMREntry *) nil_chk(sibling)) isEmpty] && prooflen == 0) {
    return ret;
  }
  OrgMinimaObjectsProofsProof_ProofChunk *chunk = nil;
  OrgMinimaObjectsBaseMiniData *phash = nil;
  OrgMinimaObjectsBaseMMRSumNumber *pval = nil;
  jint pcount = 0;
  if (prooflen > 0) {
    chunk = [zProof getProofChunkWithInt:pcount++];
    phash = [((OrgMinimaObjectsProofsProof_ProofChunk *) nil_chk(chunk)) getHash];
    pval = [chunk getValue];
    if ([sibling isEmpty]) {
      sibling = OrgMinimaDatabaseMmrMMRSet_setEntryWithInt_withOrgMinimaObjectsBaseMiniInteger_withOrgMinimaDatabaseMmrMMRData_(self, [sibling getRow], [sibling getEntry], new_OrgMinimaDatabaseMmrMMRData_initWithOrgMinimaObjectsBaseMiniData_withOrgMinimaObjectsBaseMMRSumNumber_(phash, pval));
    }
    else if ([((OrgMinimaObjectsBaseMiniNumber *) nil_chk([sibling getBlockTime])) isLessEqualWithOrgMinimaObjectsBaseMiniNumber:[zProof getBlockTime]]) {
      OrgMinimaObjectsBaseMiniData *orighash = [((OrgMinimaDatabaseMmrMMRData *) nil_chk([sibling getData])) getFinalHash];
      if (![((OrgMinimaObjectsBaseMiniData *) nil_chk(orighash)) isEqualWithOrgMinimaObjectsBaseMiniData:phash]) {
        [((JavaIoPrintStream *) nil_chk(JreLoadStatic(JavaLangSystem, out))) printlnWithNSString:@"SIBLING DIFFERENT HASH"];
        sibling = OrgMinimaDatabaseMmrMMRSet_setEntryWithInt_withOrgMinimaObjectsBaseMiniInteger_withOrgMinimaDatabaseMmrMMRData_(self, [sibling getRow], [sibling getEntry], new_OrgMinimaDatabaseMmrMMRData_initWithOrgMinimaObjectsBaseMiniData_withOrgMinimaObjectsBaseMMRSumNumber_(phash, pval));
      }
    }
    (void) OrgMinimaDatabaseMmrMMRSet_setEntryWithInt_withOrgMinimaObjectsBaseMiniInteger_withOrgMinimaDatabaseMmrMMRData_(self, [((OrgMinimaDatabaseMmrMMREntry *) nil_chk(sibling)) getRow], [sibling getEntry], [sibling getData]);
  }
  while (![((OrgMinimaDatabaseMmrMMREntry *) nil_chk(sibling)) isEmpty]) {
    OrgMinimaObjectsBaseMiniData *combined = nil;
    if ([entry_ isLeft]) {
      combined = [((OrgMinimaUtilsCrypto *) nil_chk(OrgMinimaUtilsCrypto_getInstance())) hashObjectsWithOrgMinimaUtilsStreamable:[entry_ getHashValue] withOrgMinimaUtilsStreamable:[sibling getHashValue] withInt:MMR_HASH_BITS_];
    }
    else {
      combined = [((OrgMinimaUtilsCrypto *) nil_chk(OrgMinimaUtilsCrypto_getInstance())) hashObjectsWithOrgMinimaUtilsStreamable:[sibling getHashValue] withOrgMinimaUtilsStreamable:[entry_ getHashValue] withInt:MMR_HASH_BITS_];
    }
    OrgMinimaObjectsBaseMMRSumNumber *sumvalue = [((OrgMinimaObjectsBaseMMRSumNumber *) nil_chk([((OrgMinimaDatabaseMmrMMRData *) nil_chk([entry_ getData])) getValueSum])) addWithOrgMinimaObjectsBaseMMRSumNumber:[((OrgMinimaDatabaseMmrMMRData *) nil_chk([sibling getData])) getValueSum]];
    OrgMinimaDatabaseMmrMMRData *data = new_OrgMinimaDatabaseMmrMMRData_initWithOrgMinimaObjectsBaseMiniData_withOrgMinimaObjectsBaseMMRSumNumber_(combined, sumvalue);
    (void) OrgMinimaDatabaseMmrMMRSet_setEntryWithInt_withOrgMinimaObjectsBaseMiniInteger_withOrgMinimaDatabaseMmrMMRData_(self, [sibling getRow], [sibling getEntry], [sibling getData]);
    entry_ = OrgMinimaDatabaseMmrMMRSet_setEntryWithInt_withOrgMinimaObjectsBaseMiniInteger_withOrgMinimaDatabaseMmrMMRData_(self, [entry_ getParentRow], [entry_ getParentEntry], data);
    for (OrgMinimaDatabaseMmrMMREntry * __strong peak in nil_chk(peaks)) {
      if ([((OrgMinimaDatabaseMmrMMREntry *) nil_chk(entry_)) checkPositionWithOrgMinimaDatabaseMmrMMREntry:peak]) {
        return ret;
      }
    }
    sibling = OrgMinimaDatabaseMmrMMRSet_getEntryWithInt_withOrgMinimaObjectsBaseMiniInteger_(self, [((OrgMinimaDatabaseMmrMMREntry *) nil_chk(entry_)) getRow], [entry_ getSibling]);
    if (pcount < prooflen) {
      chunk = [zProof getProofChunkWithInt:pcount++];
      phash = [((OrgMinimaObjectsProofsProof_ProofChunk *) nil_chk(chunk)) getHash];
      pval = [chunk getValue];
      if ([((OrgMinimaDatabaseMmrMMREntry *) nil_chk(sibling)) isEmpty]) {
        sibling = OrgMinimaDatabaseMmrMMRSet_setEntryWithInt_withOrgMinimaObjectsBaseMiniInteger_withOrgMinimaDatabaseMmrMMRData_(self, [sibling getRow], [sibling getEntry], new_OrgMinimaDatabaseMmrMMRData_initWithOrgMinimaObjectsBaseMiniData_withOrgMinimaObjectsBaseMMRSumNumber_(phash, pval));
      }
      else if ([((OrgMinimaObjectsBaseMiniNumber *) nil_chk([sibling getBlockTime])) isLessEqualWithOrgMinimaObjectsBaseMiniNumber:[zProof getBlockTime]]) {
        OrgMinimaObjectsBaseMiniData *orighash = [((OrgMinimaDatabaseMmrMMRData *) nil_chk([sibling getData])) getFinalHash];
        if (![((OrgMinimaObjectsBaseMiniData *) nil_chk(orighash)) isEqualWithOrgMinimaObjectsBaseMiniData:phash]) {
          [((JavaIoPrintStream *) nil_chk(JreLoadStatic(JavaLangSystem, out))) printlnWithNSString:@"SIBLING DIFFERENT HASH 2"];
          sibling = OrgMinimaDatabaseMmrMMRSet_setEntryWithInt_withOrgMinimaObjectsBaseMiniInteger_withOrgMinimaDatabaseMmrMMRData_(self, [sibling getRow], [sibling getEntry], new_OrgMinimaDatabaseMmrMMRData_initWithOrgMinimaObjectsBaseMiniData_withOrgMinimaObjectsBaseMMRSumNumber_(phash, pval));
        }
      }
    }
  }
  return ret;
}

- (OrgMinimaDatabaseMmrMMRProof *)getProofWithOrgMinimaObjectsBaseMiniInteger:(OrgMinimaObjectsBaseMiniInteger *)zEntryNumber {
  OrgMinimaDatabaseMmrMMREntry *entry_ = OrgMinimaDatabaseMmrMMRSet_getEntryWithInt_withOrgMinimaObjectsBaseMiniInteger_(self, 0, zEntryNumber);
  OrgMinimaDatabaseMmrMMRProof *proof = new_OrgMinimaDatabaseMmrMMRProof_initWithOrgMinimaObjectsBaseMiniInteger_withOrgMinimaDatabaseMmrMMRData_withOrgMinimaObjectsBaseMiniNumber_(zEntryNumber, [((OrgMinimaDatabaseMmrMMREntry *) nil_chk(entry_)) getData], mBlockTime_);
  [proof setHashBitLengthWithInt:MMR_HASH_BITS_];
  OrgMinimaDatabaseMmrMMREntry *sibling = OrgMinimaDatabaseMmrMMRSet_getEntryWithInt_withOrgMinimaObjectsBaseMiniInteger_(self, [entry_ getRow], [entry_ getSibling]);
  while (![((OrgMinimaDatabaseMmrMMREntry *) nil_chk(sibling)) isEmpty]) {
    [proof addProofChunkWithOrgMinimaObjectsBaseMiniByte:new_OrgMinimaObjectsBaseMiniByte_initWithBoolean_([sibling isLeft]) withOrgMinimaObjectsBaseMiniData:[sibling getHashValue] withOrgMinimaObjectsBaseMMRSumNumber:[((OrgMinimaDatabaseMmrMMRData *) nil_chk([sibling getData])) getValueSum]];
    OrgMinimaDatabaseMmrMMREntry *parent = new_OrgMinimaDatabaseMmrMMREntry_initWithInt_withOrgMinimaObjectsBaseMiniInteger_([sibling getParentRow], [sibling getParentEntry]);
    sibling = OrgMinimaDatabaseMmrMMRSet_getEntryWithInt_withOrgMinimaObjectsBaseMiniInteger_(self, [parent getRow], [parent getSibling]);
  }
  return proof;
}

- (OrgMinimaDatabaseMmrMMRProof *)getPeakToRootWithOrgMinimaObjectsBaseMiniData:(OrgMinimaObjectsBaseMiniData *)zPeak {
  return OrgMinimaDatabaseMmrMMRSet_getPeakToRootWithOrgMinimaObjectsBaseMiniData_(self, zPeak);
}

- (OrgMinimaDatabaseMmrMMRProof *)getFullProofToRootWithOrgMinimaObjectsBaseMiniInteger:(OrgMinimaObjectsBaseMiniInteger *)zEntry {
  OrgMinimaDatabaseMmrMMRProof *proof = [self getProofWithOrgMinimaObjectsBaseMiniInteger:zEntry];
  OrgMinimaObjectsBaseMiniData *peak = [((OrgMinimaDatabaseMmrMMRProof *) nil_chk(proof)) getFinalHash];
  OrgMinimaDatabaseMmrMMRProof *rootproof = OrgMinimaDatabaseMmrMMRSet_getPeakToRootWithOrgMinimaObjectsBaseMiniData_(self, peak);
  jint len = [((OrgMinimaDatabaseMmrMMRProof *) nil_chk(rootproof)) getProofLen];
  for (jint i = 0; i < len; i++) {
    OrgMinimaObjectsProofsProof_ProofChunk *chunk = [rootproof getProofChunkWithInt:i];
    [proof addProofChunkWithOrgMinimaObjectsBaseMiniByte:[((OrgMinimaObjectsProofsProof_ProofChunk *) nil_chk(chunk)) getLeft] withOrgMinimaObjectsBaseMiniData:[chunk getHash] withOrgMinimaObjectsBaseMMRSumNumber:[chunk getValue]];
  }
  return proof;
}

- (jboolean)checkProofWithOrgMinimaDatabaseMmrMMRProof:(OrgMinimaDatabaseMmrMMRProof *)zProof {
  if ([((OrgMinimaDatabaseMmrMMRData *) nil_chk([((OrgMinimaDatabaseMmrMMRProof *) nil_chk(zProof)) getMMRData])) isHashOnly]) {
    [((JavaIoPrintStream *) nil_chk(JreLoadStatic(JavaLangSystem, out))) printlnWithNSString:JreStrcat("$@", @"Invalid PROOF check HASHONLY! : ", zProof)];
    return false;
  }
  if ([((OrgMinimaDatabaseMmrMMRData *) nil_chk([zProof getMMRData])) isSpent]) {
    [((JavaIoPrintStream *) nil_chk(JreLoadStatic(JavaLangSystem, out))) printlnWithNSString:JreStrcat("$@", @"Invalid PROOF is SPENT! : ", zProof)];
    return false;
  }
  OrgMinimaDatabaseMmrMMRSet *proofset = [self getParentAtTimeWithOrgMinimaObjectsBaseMiniNumber:[zProof getBlockTime]];
  if (proofset == nil) {
    [((JavaIoPrintStream *) nil_chk(JreLoadStatic(JavaLangSystem, out))) printlnWithNSString:JreStrcat("$@", @"ERROR Proof too Old ", zProof)];
    return false;
  }
  JavaUtilArrayList *peaks = [proofset getMMRPeaks];
  OrgMinimaObjectsBaseMiniData *proofpeak = [zProof getFinalHash];
  jboolean found = false;
  OrgMinimaObjectsBaseMMRSumNumber *peakvalue = nil;
  for (OrgMinimaDatabaseMmrMMREntry * __strong peak in nil_chk(peaks)) {
    if ([((OrgMinimaObjectsBaseMiniData *) nil_chk(proofpeak)) isEqualWithOrgMinimaObjectsBaseMiniData:[((OrgMinimaDatabaseMmrMMREntry *) nil_chk(peak)) getHashValue]]) {
      found = true;
      peakvalue = [((OrgMinimaDatabaseMmrMMRData *) nil_chk([peak getData])) getValueSum];
      break;
    }
  }
  if (!found) {
    [((JavaIoPrintStream *) nil_chk(JreLoadStatic(JavaLangSystem, out))) printlnWithNSString:JreStrcat("$@", @"ERROR Proof No Peak Found ", zProof)];
    return false;
  }
  OrgMinimaDatabaseMmrMMREntry *entry_ = OrgMinimaDatabaseMmrMMRSet_getEntryWithInt_withOrgMinimaObjectsBaseMiniInteger_(self, 0, [zProof getEntryNumber]);
  if (![((OrgMinimaDatabaseMmrMMREntry *) nil_chk(entry_)) isEmpty] && ![((OrgMinimaDatabaseMmrMMRData *) nil_chk([entry_ getData])) isHashOnly]) {
    if ([((OrgMinimaDatabaseMmrMMRData *) nil_chk([entry_ getData])) isSpent]) {
      [((JavaIoPrintStream *) nil_chk(JreLoadStatic(JavaLangSystem, out))) printlnWithNSString:JreStrcat("$@", @"ERROR Proof Spent! ", zProof)];
      return false;
    }
  }
  jint proofnum = 0;
  jint prooflen = [zProof getProofLen];
  OrgMinimaObjectsBaseMMRSumNumber *totval = [((OrgMinimaDatabaseMmrMMRData *) nil_chk([zProof getMMRData])) getValueSum];
  if (![entry_ isEmpty]) {
    if (![((OrgMinimaObjectsBaseMMRSumNumber *) nil_chk(totval)) isEqualWithOrgMinimaObjectsBaseMMRSumNumber:[((OrgMinimaDatabaseMmrMMRData *) nil_chk([entry_ getData])) getValueSum]]) {
      [((JavaIoPrintStream *) nil_chk(JreLoadStatic(JavaLangSystem, out))) printlnWithNSString:JreStrcat("$@C@", @"ERROR MMR Sum Tree different ", totval, ' ', [((OrgMinimaDatabaseMmrMMRData *) nil_chk([entry_ getData])) getValueSum])];
      return false;
    }
  }
  while (proofnum < prooflen) {
    OrgMinimaDatabaseMmrMMREntry *sibling = OrgMinimaDatabaseMmrMMRSet_getEntryWithInt_withOrgMinimaObjectsBaseMiniInteger_(proofset, [((OrgMinimaDatabaseMmrMMREntry *) nil_chk(entry_)) getRow], [entry_ getSibling]);
    OrgMinimaObjectsProofsProof_ProofChunk *chunk = [zProof getProofChunkWithInt:proofnum++];
    OrgMinimaObjectsBaseMMRSumNumber *value = [((OrgMinimaObjectsProofsProof_ProofChunk *) nil_chk(chunk)) getValue];
    if (![((OrgMinimaDatabaseMmrMMREntry *) nil_chk(sibling)) isEmpty]) {
      if (![((OrgMinimaObjectsBaseMMRSumNumber *) nil_chk(value)) isEqualWithOrgMinimaObjectsBaseMMRSumNumber:[((OrgMinimaDatabaseMmrMMRData *) nil_chk([sibling getData])) getValueSum]]) {
        [((JavaIoPrintStream *) nil_chk(JreLoadStatic(JavaLangSystem, out))) printlnWithNSString:JreStrcat("$@C@", @"ERROR 2 MMR Sum Tree different ", value, ' ', [((OrgMinimaDatabaseMmrMMRData *) nil_chk([sibling getData])) getValueSum])];
        return false;
      }
    }
    totval = [((OrgMinimaObjectsBaseMMRSumNumber *) nil_chk(totval)) addWithOrgMinimaObjectsBaseMMRSumNumber:value];
    entry_ = OrgMinimaDatabaseMmrMMRSet_getEntryWithInt_withOrgMinimaObjectsBaseMiniInteger_(proofset, [entry_ getParentRow], [entry_ getParentEntry]);
  }
  if (![((OrgMinimaObjectsBaseMMRSumNumber *) nil_chk(totval)) isEqualWithOrgMinimaObjectsBaseMMRSumNumber:peakvalue]) {
    [((JavaIoPrintStream *) nil_chk(JreLoadStatic(JavaLangSystem, out))) printlnWithNSString:JreStrcat("$@C@", @"ERROR 3 MMR Sum Tree different ", totval, ' ', peakvalue)];
    return false;
  }
  return true;
}

- (JavaUtilArrayList *)getMMRPeaks {
  if (mFinalized_) {
    return mFinalizedPeaks_;
  }
  JavaUtilArrayList *peaks = new_JavaUtilArrayList_init();
  for (jint i = mMaxRow_; i >= 0; i--) {
    OrgMinimaDatabaseMmrMMREntry *max = IOSObjectArray_Get(nil_chk(mMaxEntries_), i);
    if (max != nil) {
      if ([max isLeft]) {
        [peaks addWithId:max];
      }
    }
  }
  return peaks;
}

- (OrgMinimaDatabaseMmrMMRData *)getMMRRoot {
  if (mFinalized_) {
    return mFinalizedRoot_;
  }
  JavaUtilArrayList *peaks = [self getMMRPeaks];
  while ([((JavaUtilArrayList *) nil_chk(peaks)) size] > 1) {
    OrgMinimaDatabaseMmrMMRSet *newmmr = new_OrgMinimaDatabaseMmrMMRSet_initWithInt_(MMR_HASH_BITS_);
    for (OrgMinimaDatabaseMmrMMREntry * __strong peak in peaks) {
      (void) [newmmr addUnspentCoinWithOrgMinimaDatabaseMmrMMRData:new_OrgMinimaDatabaseMmrMMRData_initWithOrgMinimaObjectsBaseMiniData_withOrgMinimaObjectsBaseMMRSumNumber_([((OrgMinimaDatabaseMmrMMREntry *) nil_chk(peak)) getHashValue], [((OrgMinimaDatabaseMmrMMRData *) nil_chk([peak getData])) getValueSum])];
    }
    peaks = [newmmr getMMRPeaks];
  }
  return [((OrgMinimaDatabaseMmrMMREntry *) nil_chk([peaks getWithInt:0])) getData];
}

- (jboolean)addKeeperWithOrgMinimaObjectsBaseMiniInteger:(OrgMinimaObjectsBaseMiniInteger *)zEntry {
  if (![self isKeptAllreadyWithOrgMinimaObjectsBaseMiniInteger:zEntry]) {
    [((JavaUtilArrayList *) nil_chk(mKeepers_)) addWithId:zEntry];
    return true;
  }
  return false;
}

- (JavaUtilArrayList *)getKeepers {
  return mKeepers_;
}

- (jboolean)isKeptAllreadyWithOrgMinimaObjectsBaseMiniInteger:(OrgMinimaObjectsBaseMiniInteger *)zNumber {
  for (OrgMinimaObjectsBaseMiniInteger * __strong keep in nil_chk(mKeepers_)) {
    if ([((OrgMinimaObjectsBaseMiniInteger *) nil_chk(keep)) isEqualWithOrgMinimaObjectsBaseMiniInteger:zNumber]) {
      return true;
    }
  }
  return false;
}

- (void)copyParentKeepers {
  JavaUtilArrayList *parentkeepers = new_JavaUtilArrayList_init();
  if (mParent_ != nil) {
    parentkeepers = [mParent_ getKeepers];
  }
  JavaUtilArrayList *newkeepers = new_JavaUtilArrayList_init();
  for (OrgMinimaObjectsBaseMiniInteger * __strong keep in nil_chk(mKeepers_)) {
    OrgMinimaDatabaseMmrMMREntry *entry_ = OrgMinimaDatabaseMmrMMRSet_getEntryWithInt_withOrgMinimaObjectsBaseMiniInteger_(self, 0, keep);
    if (![((OrgMinimaDatabaseMmrMMRData *) nil_chk([((OrgMinimaDatabaseMmrMMREntry *) nil_chk(entry_)) getData])) isSpent]) {
      [newkeepers addWithId:keep];
    }
  }
  mKeepers_ = newkeepers;
  for (OrgMinimaObjectsBaseMiniInteger * __strong keep in nil_chk(parentkeepers)) {
    OrgMinimaDatabaseMmrMMREntry *entry_ = OrgMinimaDatabaseMmrMMRSet_getEntryWithInt_withOrgMinimaObjectsBaseMiniInteger_(self, 0, keep);
    if ([((OrgMinimaDatabaseMmrMMREntry *) nil_chk(entry_)) isEmpty] || [((OrgMinimaDatabaseMmrMMRData *) nil_chk([entry_ getData])) isHashOnly]) {
      [((JavaIoPrintStream *) nil_chk(JreLoadStatic(JavaLangSystem, out))) printlnWithNSString:JreStrcat("$@", @"copyKeepers on NULL Keeper Entry! ", keep)];
      continue;
    }
    if ([((OrgMinimaDatabaseMmrMMRData *) nil_chk([entry_ getData])) isSpent]) {
      continue;
    }
    jboolean added = [self addKeeperWithOrgMinimaObjectsBaseMiniInteger:keep];
    entry_ = OrgMinimaDatabaseMmrMMRSet_setEntryWithInt_withOrgMinimaObjectsBaseMiniInteger_withOrgMinimaDatabaseMmrMMRData_(self, 0, keep, [entry_ getData]);
    OrgMinimaDatabaseMmrMMREntry *sibling = OrgMinimaDatabaseMmrMMRSet_getEntryWithInt_withOrgMinimaObjectsBaseMiniInteger_(self, [((OrgMinimaDatabaseMmrMMREntry *) nil_chk(entry_)) getRow], [entry_ getSibling]);
    while (![((OrgMinimaDatabaseMmrMMREntry *) nil_chk(sibling)) isEmpty]) {
      (void) OrgMinimaDatabaseMmrMMRSet_setEntryWithInt_withOrgMinimaObjectsBaseMiniInteger_withOrgMinimaDatabaseMmrMMRData_(self, [sibling getRow], [sibling getEntry], [sibling getData]);
      OrgMinimaDatabaseMmrMMREntry *parent = new_OrgMinimaDatabaseMmrMMREntry_initWithInt_withOrgMinimaObjectsBaseMiniInteger_([sibling getParentRow], [sibling getParentEntry]);
      sibling = OrgMinimaDatabaseMmrMMRSet_getEntryWithInt_withOrgMinimaObjectsBaseMiniInteger_(self, [parent getRow], [parent getSibling]);
    }
  }
  mParent_ = nil;
  [self finalizeSet];
}

- (OrgMinimaDatabaseMmrMMRSet *)getRootParent {
  if (mParent_ == nil) {
    return self;
  }
  return [mParent_ getRootParent];
}

- (OrgMinimaDatabaseMmrMMRSet *)getParentAtTimeWithOrgMinimaObjectsBaseMiniNumber:(OrgMinimaObjectsBaseMiniNumber *)zTime {
  if ([((OrgMinimaObjectsBaseMiniNumber *) nil_chk(mBlockTime_)) isEqualWithOrgMinimaObjectsBaseMiniNumber:zTime]) {
    return self;
  }
  if (mParent_ != nil) {
    return [mParent_ getParentAtTimeWithOrgMinimaObjectsBaseMiniNumber:zTime];
  }
  return nil;
}

- (OrgMinimaDatabaseMmrMMRSet *)getPenultimateParent {
  if (mParent_ != nil) {
    if ([mParent_ getParent] == nil) {
      return self;
    }
    return [((OrgMinimaDatabaseMmrMMRSet *) nil_chk(mParent_)) getPenultimateParent];
  }
  return nil;
}

- (jint)getParentLength {
  if (mParent_ != nil) {
    return 1 + [mParent_ getParentLength];
  }
  return 1;
}

- (void)writeDataStreamWithJavaIoDataOutputStream:(JavaIoDataOutputStream *)zOut {
  [((OrgMinimaObjectsBaseMiniNumber *) nil_chk(mBlockTime_)) writeDataStreamWithJavaIoDataOutputStream:zOut];
  [((OrgMinimaObjectsBaseMiniInteger *) nil_chk(mEntryNumber_)) writeDataStreamWithJavaIoDataOutputStream:zOut];
  jint len = [((JavaUtilArrayList *) nil_chk(mEntries_)) size];
  [((JavaIoDataOutputStream *) nil_chk(zOut)) writeIntWithInt:len];
  for (OrgMinimaDatabaseMmrMMREntry * __strong entry_ in nil_chk(mEntries_)) {
    [((OrgMinimaDatabaseMmrMMREntry *) nil_chk(entry_)) writeDataStreamWithJavaIoDataOutputStream:zOut];
  }
}

- (void)readDataStreamWithJavaIoDataInputStream:(JavaIoDataInputStream *)zIn {
  mBlockTime_ = OrgMinimaObjectsBaseMiniNumber_ReadFromStreamWithJavaIoDataInputStream_(zIn);
  mEntryNumber_ = OrgMinimaObjectsBaseMiniInteger_ReadFromStreamWithJavaIoDataInputStream_(zIn);
  mEntries_ = new_JavaUtilArrayList_init();
  mMaxEntries_ = [IOSObjectArray newArrayWithLength:256 type:OrgMinimaDatabaseMmrMMREntry_class_()];
  mMaxRow_ = 0;
  jint len = [((JavaIoDataInputStream *) nil_chk(zIn)) readInt];
  for (jint i = 0; i < len; i++) {
    OrgMinimaDatabaseMmrMMREntry *entry_ = new_OrgMinimaDatabaseMmrMMREntry_initWithInt_withOrgMinimaObjectsBaseMiniInteger_(0, nil);
    [entry_ readDataStreamWithJavaIoDataInputStream:zIn];
    [entry_ setBlockTimeWithOrgMinimaObjectsBaseMiniNumber:mBlockTime_];
    if (![entry_ isEmpty]) {
      jint row = [entry_ getRow];
      if (row > mMaxRow_) {
        mMaxRow_ = row;
      }
      if (IOSObjectArray_Get(nil_chk(mMaxEntries_), row) == nil) {
        (void) IOSObjectArray_Set(mMaxEntries_, row, entry_);
      }
      else if ([((OrgMinimaObjectsBaseMiniInteger *) nil_chk([((OrgMinimaDatabaseMmrMMREntry *) nil_chk(IOSObjectArray_Get(mMaxEntries_, row))) getEntry])) isLessWithOrgMinimaObjectsBaseMiniInteger:[entry_ getEntry]]) {
        (void) IOSObjectArray_Set(nil_chk(mMaxEntries_), row, entry_);
      }
      [((JavaUtilArrayList *) nil_chk(mEntries_)) addWithId:entry_];
    }
  }
  [self finalizeSet];
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, NULL, 0x1, -1, 0, -1, -1, -1, -1 },
    { NULL, NULL, 0x1, -1, 1, -1, -1, -1, -1 },
    { NULL, "LOrgMinimaUtilsJsonJSONObject;", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, NULL, 0x1, -1, 2, -1, -1, -1, -1 },
    { NULL, "V", 0x1, 3, 1, -1, -1, -1, -1 },
    { NULL, "V", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "Z", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x2, 4, 5, -1, -1, -1, -1 },
    { NULL, "LOrgMinimaObjectsBaseMiniNumber;", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "LOrgMinimaDatabaseMmrMMRSet;", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x2, -1, -1, -1, -1, -1, -1 },
    { NULL, "I", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "I", 0x1, 6, 7, -1, -1, -1, -1 },
    { NULL, "LJavaUtilArrayList;", 0x1, 8, 0, -1, 9, -1, -1 },
    { NULL, "LJavaUtilArrayList;", 0x1, -1, -1, -1, 10, -1, -1 },
    { NULL, "LOrgMinimaDatabaseMmrMMREntry;", 0x1, 11, 12, -1, -1, -1, -1 },
    { NULL, "LOrgMinimaDatabaseMmrMMREntry;", 0x1, 13, 14, -1, -1, -1, -1 },
    { NULL, "LOrgMinimaDatabaseMmrMMREntry;", 0x2, 15, 16, -1, -1, -1, -1 },
    { NULL, "LOrgMinimaDatabaseMmrMMREntry;", 0x2, 17, 18, -1, -1, -1, -1 },
    { NULL, "LOrgMinimaDatabaseMmrMMREntry;", 0x1, 19, 20, -1, -1, -1, -1 },
    { NULL, "LOrgMinimaDatabaseMmrMMREntry;", 0x1, 21, 22, -1, -1, -1, -1 },
    { NULL, "LOrgMinimaDatabaseMmrMMREntry;", 0x1, 23, 22, -1, -1, -1, -1 },
    { NULL, "LOrgMinimaDatabaseMmrMMRProof;", 0x1, 24, 25, -1, -1, -1, -1 },
    { NULL, "LOrgMinimaDatabaseMmrMMRProof;", 0x2, 26, 14, -1, -1, -1, -1 },
    { NULL, "LOrgMinimaDatabaseMmrMMRProof;", 0x1, 27, 25, -1, -1, -1, -1 },
    { NULL, "Z", 0x1, 28, 22, -1, -1, -1, -1 },
    { NULL, "LJavaUtilArrayList;", 0x1, -1, -1, -1, 10, -1, -1 },
    { NULL, "LOrgMinimaDatabaseMmrMMRData;", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "Z", 0x1, 29, 25, -1, -1, -1, -1 },
    { NULL, "LJavaUtilArrayList;", 0x1, -1, -1, -1, 30, -1, -1 },
    { NULL, "Z", 0x1, 31, 25, -1, -1, -1, -1 },
    { NULL, "V", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "LOrgMinimaDatabaseMmrMMRSet;", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "LOrgMinimaDatabaseMmrMMRSet;", 0x1, 32, 5, -1, -1, -1, -1 },
    { NULL, "LOrgMinimaDatabaseMmrMMRSet;", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "I", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x1, 33, 34, 35, -1, -1, -1 },
    { NULL, "V", 0x1, 36, 37, 35, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  #pragma clang diagnostic ignored "-Wundeclared-selector"
  methods[0].selector = @selector(init);
  methods[1].selector = @selector(initWithInt:);
  methods[2].selector = @selector(initWithOrgMinimaDatabaseMmrMMRSet:);
  methods[3].selector = @selector(toJSON);
  methods[4].selector = @selector(initWithOrgMinimaDatabaseMmrMMRSet:withInt:);
  methods[5].selector = @selector(setParentWithOrgMinimaDatabaseMmrMMRSet:);
  methods[6].selector = @selector(finalizeSet);
  methods[7].selector = @selector(isFinalized);
  methods[8].selector = @selector(setBlockTimeWithOrgMinimaObjectsBaseMiniNumber:);
  methods[9].selector = @selector(getBlockTime);
  methods[10].selector = @selector(getParent);
  methods[11].selector = @selector(incrementEntryNumber);
  methods[12].selector = @selector(getMaxRow);
  methods[13].selector = @selector(getMaxRowWithBoolean:);
  methods[14].selector = @selector(getRowWithInt:);
  methods[15].selector = @selector(getZeroRow);
  methods[16].selector = @selector(searchAddressWithOrgMinimaObjectsBaseMiniData:withOrgMinimaObjectsBaseMiniNumber:withOrgMinimaObjectsBaseMiniData:);
  methods[17].selector = @selector(findEntryWithOrgMinimaObjectsBaseMiniData:);
  methods[18].selector = @selector(setEntryWithInt:withOrgMinimaObjectsBaseMiniInteger:withOrgMinimaDatabaseMmrMMRData:);
  methods[19].selector = @selector(getEntryWithInt:withOrgMinimaObjectsBaseMiniInteger:);
  methods[20].selector = @selector(addUnspentCoinWithOrgMinimaDatabaseMmrMMRData:);
  methods[21].selector = @selector(addExternalUnspentCoinWithOrgMinimaDatabaseMmrMMRProof:);
  methods[22].selector = @selector(updateSpentCoinWithOrgMinimaDatabaseMmrMMRProof:);
  methods[23].selector = @selector(getProofWithOrgMinimaObjectsBaseMiniInteger:);
  methods[24].selector = @selector(getPeakToRootWithOrgMinimaObjectsBaseMiniData:);
  methods[25].selector = @selector(getFullProofToRootWithOrgMinimaObjectsBaseMiniInteger:);
  methods[26].selector = @selector(checkProofWithOrgMinimaDatabaseMmrMMRProof:);
  methods[27].selector = @selector(getMMRPeaks);
  methods[28].selector = @selector(getMMRRoot);
  methods[29].selector = @selector(addKeeperWithOrgMinimaObjectsBaseMiniInteger:);
  methods[30].selector = @selector(getKeepers);
  methods[31].selector = @selector(isKeptAllreadyWithOrgMinimaObjectsBaseMiniInteger:);
  methods[32].selector = @selector(copyParentKeepers);
  methods[33].selector = @selector(getRootParent);
  methods[34].selector = @selector(getParentAtTimeWithOrgMinimaObjectsBaseMiniNumber:);
  methods[35].selector = @selector(getPenultimateParent);
  methods[36].selector = @selector(getParentLength);
  methods[37].selector = @selector(writeDataStreamWithJavaIoDataOutputStream:);
  methods[38].selector = @selector(readDataStreamWithJavaIoDataInputStream:);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "mBlockTime_", "LOrgMinimaObjectsBaseMiniNumber;", .constantValue.asLong = 0, 0x0, -1, -1, -1, -1 },
    { "mParent_", "LOrgMinimaDatabaseMmrMMRSet;", .constantValue.asLong = 0, 0x0, -1, -1, -1, -1 },
    { "mEntryNumber_", "LOrgMinimaObjectsBaseMiniInteger;", .constantValue.asLong = 0, 0x1, -1, -1, -1, -1 },
    { "mEntries_", "LJavaUtilArrayList;", .constantValue.asLong = 0, 0x0, -1, -1, 38, -1 },
    { "mMaxRow_", "I", .constantValue.asLong = 0, 0x0, -1, -1, -1, -1 },
    { "mMaxEntries_", "[LOrgMinimaDatabaseMmrMMREntry;", .constantValue.asLong = 0, 0x0, -1, -1, -1, -1 },
    { "mKeepers_", "LJavaUtilArrayList;", .constantValue.asLong = 0, 0x0, -1, -1, 39, -1 },
    { "mFinalized_", "Z", .constantValue.asLong = 0, 0x0, -1, -1, -1, -1 },
    { "mFinalizedRoot_", "LOrgMinimaDatabaseMmrMMRData;", .constantValue.asLong = 0, 0x0, -1, -1, -1, -1 },
    { "mFinalizedPeaks_", "LJavaUtilArrayList;", .constantValue.asLong = 0, 0x0, -1, -1, 38, -1 },
    { "mFinalizedZeroRow_", "LJavaUtilArrayList;", .constantValue.asLong = 0, 0x0, -1, -1, 38, -1 },
    { "MMR_HASH_BITS_", "I", .constantValue.asLong = 0, 0x0, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "I", "LOrgMinimaDatabaseMmrMMRSet;", "LOrgMinimaDatabaseMmrMMRSet;I", "setParent", "setBlockTime", "LOrgMinimaObjectsBaseMiniNumber;", "getMaxRow", "Z", "getRow", "(I)Ljava/util/ArrayList<Lorg/minima/database/mmr/MMREntry;>;", "()Ljava/util/ArrayList<Lorg/minima/database/mmr/MMREntry;>;", "searchAddress", "LOrgMinimaObjectsBaseMiniData;LOrgMinimaObjectsBaseMiniNumber;LOrgMinimaObjectsBaseMiniData;", "findEntry", "LOrgMinimaObjectsBaseMiniData;", "setEntry", "ILOrgMinimaObjectsBaseMiniInteger;LOrgMinimaDatabaseMmrMMRData;", "getEntry", "ILOrgMinimaObjectsBaseMiniInteger;", "addUnspentCoin", "LOrgMinimaDatabaseMmrMMRData;", "addExternalUnspentCoin", "LOrgMinimaDatabaseMmrMMRProof;", "updateSpentCoin", "getProof", "LOrgMinimaObjectsBaseMiniInteger;", "getPeakToRoot", "getFullProofToRoot", "checkProof", "addKeeper", "()Ljava/util/ArrayList<Lorg/minima/objects/base/MiniInteger;>;", "isKeptAllready", "getParentAtTime", "writeDataStream", "LJavaIoDataOutputStream;", "LJavaIoIOException;", "readDataStream", "LJavaIoDataInputStream;", "Ljava/util/ArrayList<Lorg/minima/database/mmr/MMREntry;>;", "Ljava/util/ArrayList<Lorg/minima/objects/base/MiniInteger;>;" };
  static const J2ObjcClassInfo _OrgMinimaDatabaseMmrMMRSet = { "MMRSet", "org.minima.database.mmr", ptrTable, methods, fields, 7, 0x1, 39, 12, -1, -1, -1, -1, -1 };
  return &_OrgMinimaDatabaseMmrMMRSet;
}

@end

void OrgMinimaDatabaseMmrMMRSet_init(OrgMinimaDatabaseMmrMMRSet *self) {
  OrgMinimaDatabaseMmrMMRSet_initWithOrgMinimaDatabaseMmrMMRSet_withInt_(self, nil, 512);
}

OrgMinimaDatabaseMmrMMRSet *new_OrgMinimaDatabaseMmrMMRSet_init() {
  J2OBJC_NEW_IMPL(OrgMinimaDatabaseMmrMMRSet, init)
}

OrgMinimaDatabaseMmrMMRSet *create_OrgMinimaDatabaseMmrMMRSet_init() {
  J2OBJC_CREATE_IMPL(OrgMinimaDatabaseMmrMMRSet, init)
}

void OrgMinimaDatabaseMmrMMRSet_initWithInt_(OrgMinimaDatabaseMmrMMRSet *self, jint zBitLength) {
  OrgMinimaDatabaseMmrMMRSet_initWithOrgMinimaDatabaseMmrMMRSet_withInt_(self, nil, zBitLength);
}

OrgMinimaDatabaseMmrMMRSet *new_OrgMinimaDatabaseMmrMMRSet_initWithInt_(jint zBitLength) {
  J2OBJC_NEW_IMPL(OrgMinimaDatabaseMmrMMRSet, initWithInt_, zBitLength)
}

OrgMinimaDatabaseMmrMMRSet *create_OrgMinimaDatabaseMmrMMRSet_initWithInt_(jint zBitLength) {
  J2OBJC_CREATE_IMPL(OrgMinimaDatabaseMmrMMRSet, initWithInt_, zBitLength)
}

void OrgMinimaDatabaseMmrMMRSet_initWithOrgMinimaDatabaseMmrMMRSet_(OrgMinimaDatabaseMmrMMRSet *self, OrgMinimaDatabaseMmrMMRSet *zParent) {
  OrgMinimaDatabaseMmrMMRSet_initWithOrgMinimaDatabaseMmrMMRSet_withInt_(self, zParent, 512);
}

OrgMinimaDatabaseMmrMMRSet *new_OrgMinimaDatabaseMmrMMRSet_initWithOrgMinimaDatabaseMmrMMRSet_(OrgMinimaDatabaseMmrMMRSet *zParent) {
  J2OBJC_NEW_IMPL(OrgMinimaDatabaseMmrMMRSet, initWithOrgMinimaDatabaseMmrMMRSet_, zParent)
}

OrgMinimaDatabaseMmrMMRSet *create_OrgMinimaDatabaseMmrMMRSet_initWithOrgMinimaDatabaseMmrMMRSet_(OrgMinimaDatabaseMmrMMRSet *zParent) {
  J2OBJC_CREATE_IMPL(OrgMinimaDatabaseMmrMMRSet, initWithOrgMinimaDatabaseMmrMMRSet_, zParent)
}

void OrgMinimaDatabaseMmrMMRSet_initWithOrgMinimaDatabaseMmrMMRSet_withInt_(OrgMinimaDatabaseMmrMMRSet *self, OrgMinimaDatabaseMmrMMRSet *zParent, jint zBitLength) {
  NSObject_init(self);
  self->mBlockTime_ = new_OrgMinimaObjectsBaseMiniNumber_initWithInt_(0);
  self->mParent_ = nil;
  self->mEntryNumber_ = new_OrgMinimaObjectsBaseMiniInteger_initWithInt_(0);
  self->mMaxRow_ = 0;
  self->MMR_HASH_BITS_ = 512;
  self->mEntries_ = new_JavaUtilArrayList_init();
  self->mMaxEntries_ = [IOSObjectArray newArrayWithLength:256 type:OrgMinimaDatabaseMmrMMREntry_class_()];
  self->mMaxRow_ = 0;
  self->mParent_ = zParent;
  self->mKeepers_ = new_JavaUtilArrayList_init();
  self->mFinalized_ = false;
  self->MMR_HASH_BITS_ = zBitLength;
  if (self->mParent_ != nil) {
    if (![self->mParent_ isFinalized]) {
      [((OrgMinimaDatabaseMmrMMRSet *) nil_chk(self->mParent_)) finalizeSet];
    }
    OrgMinimaDatabaseMmrMMRSet_setBlockTimeWithOrgMinimaObjectsBaseMiniNumber_(self, [((OrgMinimaObjectsBaseMiniNumber *) nil_chk([((OrgMinimaDatabaseMmrMMRSet *) nil_chk(self->mParent_)) getBlockTime])) addWithOrgMinimaObjectsBaseMiniNumber:JreLoadStatic(OrgMinimaObjectsBaseMiniNumber, ONE)]);
    JavaMathBigInteger *tot = JreLoadStatic(JavaMathBigInteger, ZERO);
    JavaMathBigInteger *two = new_JavaMathBigInteger_initWithNSString_(@"2");
    JavaUtilArrayList *peaks = [((OrgMinimaDatabaseMmrMMRSet *) nil_chk(self->mParent_)) getMMRPeaks];
    for (OrgMinimaDatabaseMmrMMREntry * __strong peak in nil_chk(peaks)) {
      (void) OrgMinimaDatabaseMmrMMRSet_setEntryWithInt_withOrgMinimaObjectsBaseMiniInteger_withOrgMinimaDatabaseMmrMMRData_(self, [((OrgMinimaDatabaseMmrMMREntry *) nil_chk(peak)) getRow], [peak getEntry], [peak getData]);
      tot = [((JavaMathBigInteger *) nil_chk(tot)) addWithJavaMathBigInteger:[two powWithInt:[peak getRow]]];
    }
    self->mEntryNumber_ = new_OrgMinimaObjectsBaseMiniInteger_initWithJavaMathBigInteger_(tot);
    if (![self->mEntryNumber_ isEqualWithOrgMinimaObjectsBaseMiniInteger:((OrgMinimaDatabaseMmrMMRSet *) nil_chk(self->mParent_))->mEntryNumber_]) {
      OrgMinimaUtilsMinimaLogger_logWithNSString_(JreStrcat("$@C@", @"SERIOUS ERROR - Entry Number Mismatch! ", self->mEntryNumber_, '/', ((OrgMinimaDatabaseMmrMMRSet *) nil_chk(self->mParent_))->mEntryNumber_));
    }
  }
}

OrgMinimaDatabaseMmrMMRSet *new_OrgMinimaDatabaseMmrMMRSet_initWithOrgMinimaDatabaseMmrMMRSet_withInt_(OrgMinimaDatabaseMmrMMRSet *zParent, jint zBitLength) {
  J2OBJC_NEW_IMPL(OrgMinimaDatabaseMmrMMRSet, initWithOrgMinimaDatabaseMmrMMRSet_withInt_, zParent, zBitLength)
}

OrgMinimaDatabaseMmrMMRSet *create_OrgMinimaDatabaseMmrMMRSet_initWithOrgMinimaDatabaseMmrMMRSet_withInt_(OrgMinimaDatabaseMmrMMRSet *zParent, jint zBitLength) {
  J2OBJC_CREATE_IMPL(OrgMinimaDatabaseMmrMMRSet, initWithOrgMinimaDatabaseMmrMMRSet_withInt_, zParent, zBitLength)
}

void OrgMinimaDatabaseMmrMMRSet_setBlockTimeWithOrgMinimaObjectsBaseMiniNumber_(OrgMinimaDatabaseMmrMMRSet *self, OrgMinimaObjectsBaseMiniNumber *zTime) {
  self->mBlockTime_ = zTime;
}

void OrgMinimaDatabaseMmrMMRSet_incrementEntryNumber(OrgMinimaDatabaseMmrMMRSet *self) {
  self->mEntryNumber_ = [((OrgMinimaObjectsBaseMiniInteger *) nil_chk(self->mEntryNumber_)) increment];
}

OrgMinimaDatabaseMmrMMREntry *OrgMinimaDatabaseMmrMMRSet_setEntryWithInt_withOrgMinimaObjectsBaseMiniInteger_withOrgMinimaDatabaseMmrMMRData_(OrgMinimaDatabaseMmrMMRSet *self, jint zRow, OrgMinimaObjectsBaseMiniInteger *zEntry, OrgMinimaDatabaseMmrMMRData *zData) {
  if (zRow > self->mMaxRow_) {
    self->mMaxRow_ = zRow;
  }
  OrgMinimaDatabaseMmrMMREntry *entry_ = nil;
  for (OrgMinimaDatabaseMmrMMREntry * __strong ent in nil_chk(self->mEntries_)) {
    if ([((OrgMinimaDatabaseMmrMMREntry *) nil_chk(ent)) checkPositionWithInt:zRow withOrgMinimaObjectsBaseMiniInteger:zEntry]) {
      entry_ = ent;
      break;
    }
  }
  if (entry_ == nil) {
    entry_ = new_OrgMinimaDatabaseMmrMMREntry_initWithInt_withOrgMinimaObjectsBaseMiniInteger_(zRow, zEntry);
    [entry_ setBlockTimeWithOrgMinimaObjectsBaseMiniNumber:[self getBlockTime]];
    [((JavaUtilArrayList *) nil_chk(self->mEntries_)) addWithId:entry_];
  }
  [entry_ setDataWithOrgMinimaDatabaseMmrMMRData:zData];
  if (IOSObjectArray_Get(nil_chk(self->mMaxEntries_), zRow) == nil) {
    (void) IOSObjectArray_Set(self->mMaxEntries_, zRow, entry_);
  }
  else if ([((OrgMinimaObjectsBaseMiniInteger *) nil_chk([((OrgMinimaDatabaseMmrMMREntry *) nil_chk(IOSObjectArray_Get(self->mMaxEntries_, zRow))) getEntry])) isLessWithOrgMinimaObjectsBaseMiniInteger:zEntry]) {
    (void) IOSObjectArray_Set(nil_chk(self->mMaxEntries_), zRow, entry_);
  }
  return entry_;
}

OrgMinimaDatabaseMmrMMREntry *OrgMinimaDatabaseMmrMMRSet_getEntryWithInt_withOrgMinimaObjectsBaseMiniInteger_(OrgMinimaDatabaseMmrMMRSet *self, jint zRow, OrgMinimaObjectsBaseMiniInteger *zEntry) {
  for (OrgMinimaDatabaseMmrMMREntry * __strong ent in nil_chk(self->mEntries_)) {
    if ([((OrgMinimaDatabaseMmrMMREntry *) nil_chk(ent)) checkPositionWithInt:zRow withOrgMinimaObjectsBaseMiniInteger:zEntry]) {
      return ent;
    }
  }
  if (self->mParent_ != nil) {
    OrgMinimaDatabaseMmrMMREntry *entry_ = OrgMinimaDatabaseMmrMMRSet_getEntryWithInt_withOrgMinimaObjectsBaseMiniInteger_(self->mParent_, zRow, zEntry);
    if (![((OrgMinimaDatabaseMmrMMREntry *) nil_chk(entry_)) isEmpty]) {
      return entry_;
    }
  }
  OrgMinimaDatabaseMmrMMREntry *entry_ = new_OrgMinimaDatabaseMmrMMREntry_initWithInt_withOrgMinimaObjectsBaseMiniInteger_(zRow, zEntry);
  [entry_ setBlockTimeWithOrgMinimaObjectsBaseMiniNumber:[self getBlockTime]];
  return entry_;
}

OrgMinimaDatabaseMmrMMRProof *OrgMinimaDatabaseMmrMMRSet_getPeakToRootWithOrgMinimaObjectsBaseMiniData_(OrgMinimaDatabaseMmrMMRSet *self, OrgMinimaObjectsBaseMiniData *zPeak) {
  OrgMinimaDatabaseMmrMMRProof *totalproof = new_OrgMinimaDatabaseMmrMMRProof_init();
  [totalproof setHashBitLengthWithInt:self->MMR_HASH_BITS_];
  JavaUtilArrayList *peaks = [self getMMRPeaks];
  OrgMinimaDatabaseMmrMMREntry *keeper = nil;
  OrgMinimaObjectsBaseMiniData *keepvalue = zPeak;
  while ([((JavaUtilArrayList *) nil_chk(peaks)) size] > 1) {
    OrgMinimaDatabaseMmrMMRSet *newmmr = new_OrgMinimaDatabaseMmrMMRSet_initWithInt_(self->MMR_HASH_BITS_);
    for (OrgMinimaDatabaseMmrMMREntry * __strong peak in peaks) {
      OrgMinimaDatabaseMmrMMRData *data = new_OrgMinimaDatabaseMmrMMRData_initWithOrgMinimaObjectsBaseMiniData_withOrgMinimaObjectsBaseMMRSumNumber_([((OrgMinimaDatabaseMmrMMREntry *) nil_chk(peak)) getHashValue], [((OrgMinimaDatabaseMmrMMRData *) nil_chk([peak getData])) getValueSum]);
      if ([((OrgMinimaObjectsBaseMiniData *) nil_chk([peak getHashValue])) isEqualWithOrgMinimaObjectsBaseMiniData:keepvalue]) {
        keeper = [newmmr addUnspentCoinWithOrgMinimaDatabaseMmrMMRData:data];
      }
      else {
        (void) [newmmr addUnspentCoinWithOrgMinimaDatabaseMmrMMRData:data];
      }
    }
    OrgMinimaDatabaseMmrMMRProof *proof = [newmmr getProofWithOrgMinimaObjectsBaseMiniInteger:[((OrgMinimaDatabaseMmrMMREntry *) nil_chk(keeper)) getEntry]];
    jint len = [((OrgMinimaDatabaseMmrMMRProof *) nil_chk(proof)) getProofLen];
    for (jint i = 0; i < len; i++) {
      OrgMinimaObjectsProofsProof_ProofChunk *chunk = [proof getProofChunkWithInt:i];
      [totalproof addProofChunkWithOrgMinimaObjectsBaseMiniByte:[((OrgMinimaObjectsProofsProof_ProofChunk *) nil_chk(chunk)) getLeft] withOrgMinimaObjectsBaseMiniData:[chunk getHash] withOrgMinimaObjectsBaseMMRSumNumber:[chunk getValue]];
    }
    peaks = [newmmr getMMRPeaks];
  }
  return totalproof;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgMinimaDatabaseMmrMMRSet)
