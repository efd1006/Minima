//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ./org/minima/system/txpow/TxPoWChecker.java
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "java/lang/Boolean.h"
#include "java/lang/Integer.h"
#include "java/util/ArrayList.h"
#include "java/util/Hashtable.h"
#include "org/minima/database/MinimaDB.h"
#include "org/minima/database/mmr/MMRData.h"
#include "org/minima/database/mmr/MMREntry.h"
#include "org/minima/database/mmr/MMRProof.h"
#include "org/minima/database/mmr/MMRSet.h"
#include "org/minima/database/txpowtree/BlockTree.h"
#include "org/minima/database/txpowtree/BlockTreeNode.h"
#include "org/minima/database/userdb/UserDB.h"
#include "org/minima/kissvm/Contract.h"
#include "org/minima/kissvm/values/BooleanValue.h"
#include "org/minima/kissvm/values/HEXValue.h"
#include "org/minima/kissvm/values/NumberValue.h"
#include "org/minima/kissvm/values/ScriptValue.h"
#include "org/minima/objects/Address.h"
#include "org/minima/objects/Coin.h"
#include "org/minima/objects/PubPrivKey.h"
#include "org/minima/objects/StateVariable.h"
#include "org/minima/objects/Transaction.h"
#include "org/minima/objects/TxPOW.h"
#include "org/minima/objects/Witness.h"
#include "org/minima/objects/base/MiniByte.h"
#include "org/minima/objects/base/MiniData.h"
#include "org/minima/objects/base/MiniInteger.h"
#include "org/minima/objects/base/MiniNumber.h"
#include "org/minima/objects/base/MiniScript.h"
#include "org/minima/objects/proofs/ScriptProof.h"
#include "org/minima/objects/proofs/SignatureProof.h"
#include "org/minima/objects/proofs/TokenProof.h"
#include "org/minima/system/input/functions/gimme50.h"
#include "org/minima/system/txpow/TxPoWChecker.h"
#include "org/minima/utils/Crypto.h"
#include "org/minima/utils/json/JSONArray.h"
#include "org/minima/utils/json/JSONObject.h"

@implementation OrgMinimaSystemTxpowTxPoWChecker

J2OBJC_IGNORE_DESIGNATED_BEGIN
- (instancetype)init {
  OrgMinimaSystemTxpowTxPoWChecker_init(self);
  return self;
}
J2OBJC_IGNORE_DESIGNATED_END

+ (jboolean)checkSigsWithOrgMinimaObjectsTxPOW:(OrgMinimaObjectsTxPOW *)zTxPOW {
  return OrgMinimaSystemTxpowTxPoWChecker_checkSigsWithOrgMinimaObjectsTxPOW_(zTxPOW);
}

+ (jboolean)checkTransactionMMRWithOrgMinimaObjectsTxPOW:(OrgMinimaObjectsTxPOW *)zTxPOW
                           withOrgMinimaDatabaseMinimaDB:(OrgMinimaDatabaseMinimaDB *)zDB {
  return OrgMinimaSystemTxpowTxPoWChecker_checkTransactionMMRWithOrgMinimaObjectsTxPOW_withOrgMinimaDatabaseMinimaDB_(zTxPOW, zDB);
}

+ (jboolean)checkTransactionMMRWithOrgMinimaObjectsTxPOW:(OrgMinimaObjectsTxPOW *)zTxPOW
                           withOrgMinimaDatabaseMinimaDB:(OrgMinimaDatabaseMinimaDB *)zDB
                      withOrgMinimaObjectsBaseMiniNumber:(OrgMinimaObjectsBaseMiniNumber *)zBlockNumber
                          withOrgMinimaDatabaseMmrMMRSet:(OrgMinimaDatabaseMmrMMRSet *)zMMRSet
                                             withBoolean:(jboolean)zTouchMMR {
  return OrgMinimaSystemTxpowTxPoWChecker_checkTransactionMMRWithOrgMinimaObjectsTxPOW_withOrgMinimaDatabaseMinimaDB_withOrgMinimaObjectsBaseMiniNumber_withOrgMinimaDatabaseMmrMMRSet_withBoolean_(zTxPOW, zDB, zBlockNumber, zMMRSet, zTouchMMR);
}

+ (jboolean)checkTransactionMMRWithOrgMinimaObjectsTransaction:(OrgMinimaObjectsTransaction *)zTrans
                                   withOrgMinimaObjectsWitness:(OrgMinimaObjectsWitness *)zWit
                                 withOrgMinimaDatabaseMinimaDB:(OrgMinimaDatabaseMinimaDB *)zDB
                            withOrgMinimaObjectsBaseMiniNumber:(OrgMinimaObjectsBaseMiniNumber *)zBlockNumber
                                withOrgMinimaDatabaseMmrMMRSet:(OrgMinimaDatabaseMmrMMRSet *)zMMRSet
                                                   withBoolean:(jboolean)zTouchMMR {
  return OrgMinimaSystemTxpowTxPoWChecker_checkTransactionMMRWithOrgMinimaObjectsTransaction_withOrgMinimaObjectsWitness_withOrgMinimaDatabaseMinimaDB_withOrgMinimaObjectsBaseMiniNumber_withOrgMinimaDatabaseMmrMMRSet_withBoolean_(zTrans, zWit, zDB, zBlockNumber, zMMRSet, zTouchMMR);
}

+ (jboolean)checkTransactionMMRWithOrgMinimaObjectsTransaction:(OrgMinimaObjectsTransaction *)zTrans
                                   withOrgMinimaObjectsWitness:(OrgMinimaObjectsWitness *)zWit
                                 withOrgMinimaDatabaseMinimaDB:(OrgMinimaDatabaseMinimaDB *)zDB
                            withOrgMinimaObjectsBaseMiniNumber:(OrgMinimaObjectsBaseMiniNumber *)zBlockNumber
                                withOrgMinimaDatabaseMmrMMRSet:(OrgMinimaDatabaseMmrMMRSet *)zMMRSet
                                                   withBoolean:(jboolean)zTouchMMR
                               withOrgMinimaUtilsJsonJSONArray:(OrgMinimaUtilsJsonJSONArray *)zContractLog {
  return OrgMinimaSystemTxpowTxPoWChecker_checkTransactionMMRWithOrgMinimaObjectsTransaction_withOrgMinimaObjectsWitness_withOrgMinimaDatabaseMinimaDB_withOrgMinimaObjectsBaseMiniNumber_withOrgMinimaDatabaseMmrMMRSet_withBoolean_withOrgMinimaUtilsJsonJSONArray_(zTrans, zWit, zDB, zBlockNumber, zMMRSet, zTouchMMR, zContractLog);
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "Z", 0x9, 0, 1, -1, -1, -1, -1 },
    { NULL, "Z", 0x9, 2, 3, -1, -1, -1, -1 },
    { NULL, "Z", 0x9, 2, 4, -1, -1, -1, -1 },
    { NULL, "Z", 0x9, 2, 5, -1, -1, -1, -1 },
    { NULL, "Z", 0x9, 2, 6, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  #pragma clang diagnostic ignored "-Wundeclared-selector"
  methods[0].selector = @selector(init);
  methods[1].selector = @selector(checkSigsWithOrgMinimaObjectsTxPOW:);
  methods[2].selector = @selector(checkTransactionMMRWithOrgMinimaObjectsTxPOW:withOrgMinimaDatabaseMinimaDB:);
  methods[3].selector = @selector(checkTransactionMMRWithOrgMinimaObjectsTxPOW:withOrgMinimaDatabaseMinimaDB:withOrgMinimaObjectsBaseMiniNumber:withOrgMinimaDatabaseMmrMMRSet:withBoolean:);
  methods[4].selector = @selector(checkTransactionMMRWithOrgMinimaObjectsTransaction:withOrgMinimaObjectsWitness:withOrgMinimaDatabaseMinimaDB:withOrgMinimaObjectsBaseMiniNumber:withOrgMinimaDatabaseMmrMMRSet:withBoolean:);
  methods[5].selector = @selector(checkTransactionMMRWithOrgMinimaObjectsTransaction:withOrgMinimaObjectsWitness:withOrgMinimaDatabaseMinimaDB:withOrgMinimaObjectsBaseMiniNumber:withOrgMinimaDatabaseMmrMMRSet:withBoolean:withOrgMinimaUtilsJsonJSONArray:);
  #pragma clang diagnostic pop
  static const void *ptrTable[] = { "checkSigs", "LOrgMinimaObjectsTxPOW;", "checkTransactionMMR", "LOrgMinimaObjectsTxPOW;LOrgMinimaDatabaseMinimaDB;", "LOrgMinimaObjectsTxPOW;LOrgMinimaDatabaseMinimaDB;LOrgMinimaObjectsBaseMiniNumber;LOrgMinimaDatabaseMmrMMRSet;Z", "LOrgMinimaObjectsTransaction;LOrgMinimaObjectsWitness;LOrgMinimaDatabaseMinimaDB;LOrgMinimaObjectsBaseMiniNumber;LOrgMinimaDatabaseMmrMMRSet;Z", "LOrgMinimaObjectsTransaction;LOrgMinimaObjectsWitness;LOrgMinimaDatabaseMinimaDB;LOrgMinimaObjectsBaseMiniNumber;LOrgMinimaDatabaseMmrMMRSet;ZLOrgMinimaUtilsJsonJSONArray;" };
  static const J2ObjcClassInfo _OrgMinimaSystemTxpowTxPoWChecker = { "TxPoWChecker", "org.minima.system.txpow", ptrTable, methods, NULL, 7, 0x1, 6, 0, -1, -1, -1, -1, -1 };
  return &_OrgMinimaSystemTxpowTxPoWChecker;
}

@end

void OrgMinimaSystemTxpowTxPoWChecker_init(OrgMinimaSystemTxpowTxPoWChecker *self) {
  NSObject_init(self);
}

OrgMinimaSystemTxpowTxPoWChecker *new_OrgMinimaSystemTxpowTxPoWChecker_init() {
  J2OBJC_NEW_IMPL(OrgMinimaSystemTxpowTxPoWChecker, init)
}

OrgMinimaSystemTxpowTxPoWChecker *create_OrgMinimaSystemTxpowTxPoWChecker_init() {
  J2OBJC_CREATE_IMPL(OrgMinimaSystemTxpowTxPoWChecker, init)
}

jboolean OrgMinimaSystemTxpowTxPoWChecker_checkSigsWithOrgMinimaObjectsTxPOW_(OrgMinimaObjectsTxPOW *zTxPOW) {
  OrgMinimaSystemTxpowTxPoWChecker_initialize();
  OrgMinimaObjectsTransaction *trans = [((OrgMinimaObjectsTxPOW *) nil_chk(zTxPOW)) getTransaction];
  OrgMinimaObjectsBaseMiniData *transhash = [zTxPOW getTransID];
  OrgMinimaObjectsWitness *wit = [zTxPOW getWitness];
  JavaUtilArrayList *sigs = [((OrgMinimaObjectsWitness *) nil_chk(wit)) getAllSignatures];
  for (OrgMinimaObjectsProofsSignatureProof * __strong sig in nil_chk(sigs)) {
    OrgMinimaObjectsBaseMiniData *leafkey = [((OrgMinimaObjectsProofsSignatureProof *) nil_chk(sig)) getData];
    OrgMinimaObjectsBaseMiniData *signature = [sig getSignature];
    jboolean ok = OrgMinimaObjectsPubPrivKey_verifyWithOrgMinimaObjectsBaseMiniData_withOrgMinimaObjectsBaseMiniData_withOrgMinimaObjectsBaseMiniData_(leafkey, transhash, signature);
    if (!ok) {
      return false;
    }
  }
  return true;
}

jboolean OrgMinimaSystemTxpowTxPoWChecker_checkTransactionMMRWithOrgMinimaObjectsTxPOW_withOrgMinimaDatabaseMinimaDB_(OrgMinimaObjectsTxPOW *zTxPOW, OrgMinimaDatabaseMinimaDB *zDB) {
  OrgMinimaSystemTxpowTxPoWChecker_initialize();
  OrgMinimaDatabaseTxpowtreeBlockTreeNode *tip = [((OrgMinimaDatabaseTxpowtreeBlockTree *) nil_chk([((OrgMinimaDatabaseMinimaDB *) nil_chk(zDB)) getMainTree])) getChainTip];
  return OrgMinimaSystemTxpowTxPoWChecker_checkTransactionMMRWithOrgMinimaObjectsTxPOW_withOrgMinimaDatabaseMinimaDB_withOrgMinimaObjectsBaseMiniNumber_withOrgMinimaDatabaseMmrMMRSet_withBoolean_(zTxPOW, zDB, [((OrgMinimaObjectsTxPOW *) nil_chk([((OrgMinimaDatabaseTxpowtreeBlockTreeNode *) nil_chk(tip)) getTxPow])) getBlockNumber], [tip getMMRSet], false);
}

jboolean OrgMinimaSystemTxpowTxPoWChecker_checkTransactionMMRWithOrgMinimaObjectsTxPOW_withOrgMinimaDatabaseMinimaDB_withOrgMinimaObjectsBaseMiniNumber_withOrgMinimaDatabaseMmrMMRSet_withBoolean_(OrgMinimaObjectsTxPOW *zTxPOW, OrgMinimaDatabaseMinimaDB *zDB, OrgMinimaObjectsBaseMiniNumber *zBlockNumber, OrgMinimaDatabaseMmrMMRSet *zMMRSet, jboolean zTouchMMR) {
  OrgMinimaSystemTxpowTxPoWChecker_initialize();
  if (![((OrgMinimaObjectsTransaction *) nil_chk([((OrgMinimaObjectsTxPOW *) nil_chk(zTxPOW)) getBurnTransaction])) isEmpty]) {
    OrgMinimaObjectsBaseMiniData *transid = [zTxPOW getTransID];
    if (![((OrgMinimaObjectsBaseMiniData *) nil_chk([((OrgMinimaObjectsTransaction *) nil_chk([zTxPOW getBurnTransaction])) getLinkHash])) isEqualWithOrgMinimaObjectsBaseMiniData:transid]) {
      return false;
    }
    jboolean burntrans = OrgMinimaSystemTxpowTxPoWChecker_checkTransactionMMRWithOrgMinimaObjectsTransaction_withOrgMinimaObjectsWitness_withOrgMinimaDatabaseMinimaDB_withOrgMinimaObjectsBaseMiniNumber_withOrgMinimaDatabaseMmrMMRSet_withBoolean_withOrgMinimaUtilsJsonJSONArray_([zTxPOW getBurnTransaction], [zTxPOW getBurnWitness], zDB, zBlockNumber, zMMRSet, zTouchMMR, new_OrgMinimaUtilsJsonJSONArray_init());
    if (!burntrans) {
      return false;
    }
  }
  if (![((OrgMinimaObjectsBaseMiniData *) nil_chk([((OrgMinimaObjectsTransaction *) nil_chk([zTxPOW getTransaction])) getLinkHash])) isEqualWithOrgMinimaObjectsBaseMiniData:new_OrgMinimaObjectsBaseMiniData_initWithNSString_(@"0x00")]) {
    return false;
  }
  return OrgMinimaSystemTxpowTxPoWChecker_checkTransactionMMRWithOrgMinimaObjectsTransaction_withOrgMinimaObjectsWitness_withOrgMinimaDatabaseMinimaDB_withOrgMinimaObjectsBaseMiniNumber_withOrgMinimaDatabaseMmrMMRSet_withBoolean_withOrgMinimaUtilsJsonJSONArray_([zTxPOW getTransaction], [zTxPOW getWitness], zDB, zBlockNumber, zMMRSet, zTouchMMR, new_OrgMinimaUtilsJsonJSONArray_init());
}

jboolean OrgMinimaSystemTxpowTxPoWChecker_checkTransactionMMRWithOrgMinimaObjectsTransaction_withOrgMinimaObjectsWitness_withOrgMinimaDatabaseMinimaDB_withOrgMinimaObjectsBaseMiniNumber_withOrgMinimaDatabaseMmrMMRSet_withBoolean_(OrgMinimaObjectsTransaction *zTrans, OrgMinimaObjectsWitness *zWit, OrgMinimaDatabaseMinimaDB *zDB, OrgMinimaObjectsBaseMiniNumber *zBlockNumber, OrgMinimaDatabaseMmrMMRSet *zMMRSet, jboolean zTouchMMR) {
  OrgMinimaSystemTxpowTxPoWChecker_initialize();
  return OrgMinimaSystemTxpowTxPoWChecker_checkTransactionMMRWithOrgMinimaObjectsTransaction_withOrgMinimaObjectsWitness_withOrgMinimaDatabaseMinimaDB_withOrgMinimaObjectsBaseMiniNumber_withOrgMinimaDatabaseMmrMMRSet_withBoolean_withOrgMinimaUtilsJsonJSONArray_(zTrans, zWit, zDB, zBlockNumber, zMMRSet, zTouchMMR, new_OrgMinimaUtilsJsonJSONArray_init());
}

jboolean OrgMinimaSystemTxpowTxPoWChecker_checkTransactionMMRWithOrgMinimaObjectsTransaction_withOrgMinimaObjectsWitness_withOrgMinimaDatabaseMinimaDB_withOrgMinimaObjectsBaseMiniNumber_withOrgMinimaDatabaseMmrMMRSet_withBoolean_withOrgMinimaUtilsJsonJSONArray_(OrgMinimaObjectsTransaction *zTrans, OrgMinimaObjectsWitness *zWit, OrgMinimaDatabaseMinimaDB *zDB, OrgMinimaObjectsBaseMiniNumber *zBlockNumber, OrgMinimaDatabaseMmrMMRSet *zMMRSet, jboolean zTouchMMR, OrgMinimaUtilsJsonJSONArray *zContractLog) {
  OrgMinimaSystemTxpowTxPoWChecker_initialize();
  OrgMinimaObjectsTransaction *trans = [((OrgMinimaObjectsTransaction *) nil_chk(zTrans)) deepCopy];
  IOSObjectArray *DYNState = [IOSObjectArray newArrayWithLength:256 type:NSString_class_()];
  IOSBooleanArray *checkState = [IOSBooleanArray newArrayWithLength:256];
  for (jint i = 0; i < 256; i++) {
    (void) IOSObjectArray_Set(DYNState, i, nil);
    *IOSBooleanArray_GetRef(checkState, i) = false;
  }
  JavaUtilArrayList *inputs = [((OrgMinimaObjectsTransaction *) nil_chk(trans)) getAllInputs];
  NSString *sigs = [((OrgMinimaObjectsWitness *) nil_chk(zWit)) getAllPubKeysCSV];
  jboolean isfloating = false;
  jint ins = [((JavaUtilArrayList *) nil_chk(inputs)) size];
  for (jint i = 0; i < ins; i++) {
    OrgMinimaObjectsCoin *input = [inputs getWithInt:i];
    OrgMinimaUtilsJsonJSONObject *contractlog = new_OrgMinimaUtilsJsonJSONObject_init();
    [((OrgMinimaUtilsJsonJSONArray *) nil_chk(zContractLog)) addWithId:contractlog];
    OrgMinimaObjectsProofsScriptProof *sp = [zWit getScriptWithOrgMinimaObjectsBaseMiniData:[((OrgMinimaObjectsCoin *) nil_chk(input)) getAddress]];
    if (sp == nil) {
      (void) [contractlog putWithId:@"error" withId:JreStrcat("$@", @"Script not found for ", [input getAddress])];
      return false;
    }
    NSString *script = [((OrgMinimaObjectsBaseMiniScript *) nil_chk([sp getScript])) description];
    (void) [contractlog putWithId:@"input" withId:JavaLangInteger_valueOfWithInt_(i)];
    (void) [contractlog putWithId:@"script" withId:script];
    if ([((OrgMinimaObjectsBaseMiniData *) nil_chk([input getCoinID])) isEqualWithOrgMinimaObjectsBaseMiniData:JreLoadStatic(OrgMinimaSystemInputFunctionsgimme50, COINID_INPUT)] && [((OrgMinimaObjectsBaseMiniNumber *) nil_chk([input getAmount])) isLessEqualWithOrgMinimaObjectsBaseMiniNumber:new_OrgMinimaObjectsBaseMiniNumber_initWithNSString_(@"50")]) {
      (void) [contractlog putWithId:@"isgimme50" withId:JavaLangBoolean_valueOfWithBoolean_(true)];
    }
    else {
      (void) [contractlog putWithId:@"isgimme50" withId:JavaLangBoolean_valueOfWithBoolean_(false)];
      OrgMinimaObjectsAddress *scraddr = new_OrgMinimaObjectsAddress_initWithNSString_withInt_(script, [((OrgMinimaObjectsBaseMiniData *) nil_chk([input getAddress])) getLength] * 8);
      if (![((OrgMinimaObjectsBaseMiniData *) nil_chk([scraddr getAddressData])) isEqualWithOrgMinimaObjectsBaseMiniData:[input getAddress]]) {
        (void) [contractlog putWithId:@"error" withId:@"Serious - Invalid Address for script!"];
        return false;
      }
      OrgMinimaDatabaseMmrMMRProof *proof = [((JavaUtilArrayList *) nil_chk([zWit getAllMMRProofs])) getWithInt:i];
      if ([((OrgMinimaDatabaseMmrMMRData *) nil_chk([((OrgMinimaDatabaseMmrMMRProof *) nil_chk(proof)) getMMRData])) isHashOnly]) {
        (void) [contractlog putWithId:@"error" withId:@"Invalid MMR Proof (HASH Only)"];
        return false;
      }
      jboolean valid = [((OrgMinimaDatabaseMmrMMRSet *) nil_chk(zMMRSet)) checkProofWithOrgMinimaDatabaseMmrMMRProof:proof];
      if (!valid) {
        if ([input isFloating]) {
          OrgMinimaDatabaseMmrMMREntry *fladdr = [zMMRSet searchAddressWithOrgMinimaObjectsBaseMiniData:[input getAddress] withOrgMinimaObjectsBaseMiniNumber:[input getAmount] withOrgMinimaObjectsBaseMiniData:[input getTokenID]];
          if (fladdr != nil) {
            proof = [zMMRSet getProofWithOrgMinimaObjectsBaseMiniInteger:[fladdr getEntry]];
            OrgMinimaObjectsCoin *flinput = [((OrgMinimaDatabaseMmrMMRData *) nil_chk([((OrgMinimaDatabaseMmrMMRProof *) nil_chk(proof)) getMMRData])) getCoin];
            [input resetCoinIDWithOrgMinimaObjectsBaseMiniData:[((OrgMinimaObjectsCoin *) nil_chk(flinput)) getCoinID]];
            [input resetAmountWithOrgMinimaObjectsBaseMiniNumber:[flinput getAmount]];
            isfloating = true;
          }
          else {
            (void) [contractlog putWithId:@"error" withId:@"Invalid MMR Proof and NO VALID FLOATING COIN Found.."];
            return false;
          }
        }
        else {
          (void) [contractlog putWithId:@"error" withId:@"Invalid MMR Proof"];
          return false;
        }
      }
      else {
        if (![proof checkCoinWithOrgMinimaObjectsCoin:input]) {
          (void) [contractlog putWithId:@"error" withId:@"Coin details proof miss-match"];
          return false;
        }
      }
      if (zTouchMMR) {
        OrgMinimaDatabaseMmrMMREntry *spent = [zMMRSet updateSpentCoinWithOrgMinimaDatabaseMmrMMRProof:proof];
        if ([((id<OrgMinimaDatabaseUserdbUserDB>) nil_chk([((OrgMinimaDatabaseMinimaDB *) nil_chk(zDB)) getUserDB])) isAddressRelevantWithOrgMinimaObjectsBaseMiniData:[input getAddress]]) {
          [zMMRSet addKeeperWithOrgMinimaObjectsBaseMiniInteger:[((OrgMinimaDatabaseMmrMMREntry *) nil_chk(spent)) getEntry]];
        }
      }
      NSString *tokscript = @"";
      if (![((OrgMinimaObjectsBaseMiniData *) nil_chk([input getTokenID])) isEqualWithOrgMinimaObjectsBaseMiniData:JreLoadStatic(OrgMinimaObjectsCoin, MINIMA_TOKENID)]) {
        OrgMinimaObjectsProofsTokenProof *tokdets = [zWit getTokenDetailWithOrgMinimaObjectsBaseMiniData:[input getTokenID]];
        if (tokdets == nil) {
          (void) [contractlog putWithId:@"error" withId:JreStrcat("$@", @"Token Details for coin missing! ", [input getTokenID])];
          return false;
        }
        tokscript = [((OrgMinimaObjectsBaseMiniScript *) nil_chk([tokdets getTokenScript])) description];
      }
      OrgMinimaKissvmContract *cc = new_OrgMinimaKissvmContract_initWithNSString_withNSString_withOrgMinimaObjectsWitness_withOrgMinimaObjectsTransaction_withJavaUtilArrayList_(script, sigs, zWit, trans, [((OrgMinimaDatabaseMmrMMRData *) nil_chk([proof getMMRData])) getPrevState]);
      [cc setGlobalVariableWithNSString:@"@BLKNUM" withOrgMinimaKissvmValuesValue:new_OrgMinimaKissvmValuesNumberValue_initWithOrgMinimaObjectsBaseMiniNumber_(zBlockNumber)];
      [cc setGlobalVariableWithNSString:@"@INBLKNUM" withOrgMinimaKissvmValuesValue:new_OrgMinimaKissvmValuesNumberValue_initWithOrgMinimaObjectsBaseMiniNumber_([((OrgMinimaDatabaseMmrMMRData *) nil_chk([proof getMMRData])) getInBlock])];
      [cc setGlobalVariableWithNSString:@"@BLKDIFF" withOrgMinimaKissvmValuesValue:new_OrgMinimaKissvmValuesNumberValue_initWithOrgMinimaObjectsBaseMiniNumber_([((OrgMinimaObjectsBaseMiniNumber *) nil_chk(zBlockNumber)) subWithOrgMinimaObjectsBaseMiniNumber:[((OrgMinimaDatabaseMmrMMRData *) nil_chk([proof getMMRData])) getInBlock]])];
      [cc setGlobalVariableWithNSString:@"@INPUT" withOrgMinimaKissvmValuesValue:new_OrgMinimaKissvmValuesNumberValue_initWithInt_(i)];
      [cc setGlobalVariableWithNSString:@"@AMOUNT" withOrgMinimaKissvmValuesValue:new_OrgMinimaKissvmValuesNumberValue_initWithOrgMinimaObjectsBaseMiniNumber_([input getAmount])];
      [cc setGlobalVariableWithNSString:@"@ADDRESS" withOrgMinimaKissvmValuesValue:new_OrgMinimaKissvmValuesHEXValue_initWithOrgMinimaObjectsBaseMiniData_([input getAddress])];
      [cc setGlobalVariableWithNSString:@"@TOKENID" withOrgMinimaKissvmValuesValue:new_OrgMinimaKissvmValuesHEXValue_initWithOrgMinimaObjectsBaseMiniData_([input getTokenID])];
      [cc setGlobalVariableWithNSString:@"@COINID" withOrgMinimaKissvmValuesValue:new_OrgMinimaKissvmValuesHEXValue_initWithOrgMinimaObjectsBaseMiniData_([input getCoinID])];
      [cc setGlobalVariableWithNSString:@"@SCRIPT" withOrgMinimaKissvmValuesValue:new_OrgMinimaKissvmValuesScriptValue_initWithNSString_(script)];
      [cc setGlobalVariableWithNSString:@"@TOKENSCRIPT" withOrgMinimaKissvmValuesValue:new_OrgMinimaKissvmValuesScriptValue_initWithNSString_(tokscript)];
      [cc setGlobalVariableWithNSString:@"@FLOATING" withOrgMinimaKissvmValuesValue:new_OrgMinimaKissvmValuesBooleanValue_initWithBoolean_([input isFloating])];
      [cc setGlobalVariableWithNSString:@"@TOTIN" withOrgMinimaKissvmValuesValue:new_OrgMinimaKissvmValuesNumberValue_initWithInt_([((JavaUtilArrayList *) nil_chk([trans getAllInputs])) size])];
      [cc setGlobalVariableWithNSString:@"@TOTOUT" withOrgMinimaKissvmValuesValue:new_OrgMinimaKissvmValuesNumberValue_initWithInt_([((JavaUtilArrayList *) nil_chk([trans getAllOutputs])) size])];
      [cc setFloatingWithBoolean:[input isFloating]];
      [cc setCompleteDYNStateWithNSStringArray:DYNState withBooleanArray:checkState];
      [cc run];
      (void) [contractlog putWithId:@"script" withId:[cc getMiniScript]];
      (void) [contractlog putWithId:@"size" withId:JavaLangInteger_valueOfWithInt_([((NSString *) nil_chk([cc getMiniScript])) java_length])];
      (void) [contractlog putWithId:@"instructions" withId:JavaLangInteger_valueOfWithInt_([cc getNumberOfInstructions])];
      (void) [contractlog putWithId:@"address" withId:[((OrgMinimaObjectsBaseMiniData *) nil_chk([input getAddress])) to0xString]];
      (void) [contractlog putWithId:@"parseok" withId:JavaLangBoolean_valueOfWithBoolean_([cc isParseOK])];
      (void) [contractlog putWithId:@"parse" withId:[cc getCompleteTraceLog]];
      (void) [contractlog putWithId:@"exception" withId:JavaLangBoolean_valueOfWithBoolean_([cc isException])];
      (void) [contractlog putWithId:@"excvalue" withId:[cc getException]];
      (void) [contractlog putWithId:@"result" withId:JavaLangBoolean_valueOfWithBoolean_([cc isSuccess])];
      DYNState = [cc getCompleteDYNState];
      checkState = [cc getCompleteCheckState];
      if (![cc isSuccess]) {
        return false;
      }
      if (![((OrgMinimaObjectsBaseMiniData *) nil_chk([input getTokenID])) isEqualWithOrgMinimaObjectsBaseMiniData:JreLoadStatic(OrgMinimaObjectsCoin, MINIMA_TOKENID)]) {
        if (![((NSString *) nil_chk(tokscript)) isEqual:@"RETURN TRUE"]) {
          cc = new_OrgMinimaKissvmContract_initWithNSString_withNSString_withOrgMinimaObjectsWitness_withOrgMinimaObjectsTransaction_withJavaUtilArrayList_(tokscript, sigs, zWit, trans, [((OrgMinimaDatabaseMmrMMRData *) nil_chk([proof getMMRData])) getPrevState]);
          [cc setGlobalVariableWithNSString:@"@BLKNUM" withOrgMinimaKissvmValuesValue:new_OrgMinimaKissvmValuesNumberValue_initWithOrgMinimaObjectsBaseMiniNumber_(zBlockNumber)];
          [cc setGlobalVariableWithNSString:@"@INBLKNUM" withOrgMinimaKissvmValuesValue:new_OrgMinimaKissvmValuesNumberValue_initWithOrgMinimaObjectsBaseMiniNumber_([((OrgMinimaDatabaseMmrMMRData *) nil_chk([proof getMMRData])) getInBlock])];
          [cc setGlobalVariableWithNSString:@"@BLKDIFF" withOrgMinimaKissvmValuesValue:new_OrgMinimaKissvmValuesNumberValue_initWithOrgMinimaObjectsBaseMiniNumber_([zBlockNumber subWithOrgMinimaObjectsBaseMiniNumber:[((OrgMinimaDatabaseMmrMMRData *) nil_chk([proof getMMRData])) getInBlock]])];
          [cc setGlobalVariableWithNSString:@"@INPUT" withOrgMinimaKissvmValuesValue:new_OrgMinimaKissvmValuesNumberValue_initWithInt_(i)];
          [cc setGlobalVariableWithNSString:@"@AMOUNT" withOrgMinimaKissvmValuesValue:new_OrgMinimaKissvmValuesNumberValue_initWithOrgMinimaObjectsBaseMiniNumber_([input getAmount])];
          [cc setGlobalVariableWithNSString:@"@ADDRESS" withOrgMinimaKissvmValuesValue:new_OrgMinimaKissvmValuesHEXValue_initWithOrgMinimaObjectsBaseMiniData_([input getAddress])];
          [cc setGlobalVariableWithNSString:@"@TOKENID" withOrgMinimaKissvmValuesValue:new_OrgMinimaKissvmValuesHEXValue_initWithOrgMinimaObjectsBaseMiniData_([input getTokenID])];
          [cc setGlobalVariableWithNSString:@"@COINID" withOrgMinimaKissvmValuesValue:new_OrgMinimaKissvmValuesHEXValue_initWithOrgMinimaObjectsBaseMiniData_([input getCoinID])];
          [cc setGlobalVariableWithNSString:@"@SCRIPT" withOrgMinimaKissvmValuesValue:new_OrgMinimaKissvmValuesScriptValue_initWithNSString_(script)];
          [cc setGlobalVariableWithNSString:@"@TOKENSCRIPT" withOrgMinimaKissvmValuesValue:new_OrgMinimaKissvmValuesScriptValue_initWithNSString_(tokscript)];
          [cc setGlobalVariableWithNSString:@"@FLOATING" withOrgMinimaKissvmValuesValue:new_OrgMinimaKissvmValuesBooleanValue_initWithBoolean_([input isFloating])];
          [cc setGlobalVariableWithNSString:@"@TOTIN" withOrgMinimaKissvmValuesValue:new_OrgMinimaKissvmValuesNumberValue_initWithInt_([((JavaUtilArrayList *) nil_chk([trans getAllInputs])) size])];
          [cc setGlobalVariableWithNSString:@"@TOTOUT" withOrgMinimaKissvmValuesValue:new_OrgMinimaKissvmValuesNumberValue_initWithInt_([((JavaUtilArrayList *) nil_chk([trans getAllOutputs])) size])];
          [cc setFloatingWithBoolean:[input isFloating]];
          [cc setCompleteDYNStateWithNSStringArray:DYNState withBooleanArray:checkState];
          [cc run];
          DYNState = [cc getCompleteDYNState];
          checkState = [cc getCompleteCheckState];
          OrgMinimaUtilsJsonJSONObject *toklog = new_OrgMinimaUtilsJsonJSONObject_init();
          (void) [contractlog putWithId:@"tokencontract" withId:toklog];
          (void) [toklog putWithId:@"script" withId:[cc getMiniScript]];
          (void) [toklog putWithId:@"size" withId:JavaLangInteger_valueOfWithInt_([((NSString *) nil_chk([cc getMiniScript])) java_length])];
          (void) [toklog putWithId:@"instructions" withId:JavaLangInteger_valueOfWithInt_([cc getNumberOfInstructions])];
          (void) [toklog putWithId:@"address" withId:[((OrgMinimaObjectsBaseMiniData *) nil_chk([input getAddress])) to0xString]];
          (void) [toklog putWithId:@"parseok" withId:JavaLangBoolean_valueOfWithBoolean_([cc isParseOK])];
          (void) [toklog putWithId:@"parse" withId:[cc getCompleteTraceLog]];
          (void) [toklog putWithId:@"exception" withId:JavaLangBoolean_valueOfWithBoolean_([cc isException])];
          (void) [toklog putWithId:@"result" withId:JavaLangBoolean_valueOfWithBoolean_([cc isSuccess])];
          if (![cc isSuccess]) {
            return false;
          }
        }
      }
    }
  }
  if (isfloating) {
    JavaUtilArrayList *tokens = new_JavaUtilArrayList_init();
    for (OrgMinimaObjectsCoin * __strong cc in nil_chk([trans getAllInputs])) {
      NSString *tok = [((OrgMinimaObjectsBaseMiniData *) nil_chk([((OrgMinimaObjectsCoin *) nil_chk(cc)) getTokenID])) to0xString];
      if (![tokens containsWithId:tok]) {
        [tokens addWithId:tok];
      }
    }
    JavaUtilHashtable *inamounts = new_JavaUtilHashtable_init();
    for (NSString * __strong token in tokens) {
      (void) [inamounts putWithId:token withId:[trans sumInputsWithOrgMinimaObjectsBaseMiniData:new_OrgMinimaObjectsBaseMiniData_initWithNSString_(token)]];
    }
    for (NSString * __strong token in tokens) {
      OrgMinimaObjectsBaseMiniData *tok = new_OrgMinimaObjectsBaseMiniData_initWithNSString_(token);
      OrgMinimaObjectsBaseMiniNumber *outamt = [trans sumOutputsWithOrgMinimaObjectsBaseMiniData:tok];
      OrgMinimaObjectsBaseMiniNumber *inamt = [inamounts getWithId:token];
      OrgMinimaObjectsBaseMiniNumber *remainder = [((OrgMinimaObjectsBaseMiniNumber *) nil_chk(inamt)) subWithOrgMinimaObjectsBaseMiniNumber:outamt];
      if (![((OrgMinimaObjectsBaseMiniNumber *) nil_chk(remainder)) isEqualWithOrgMinimaObjectsBaseMiniNumber:JreLoadStatic(OrgMinimaObjectsBaseMiniNumber, ZERO)]) {
        OrgMinimaObjectsCoin *remainderoutput = [trans getRemainderCoinWithOrgMinimaObjectsBaseMiniData:tok];
        if (remainderoutput != nil) {
          [remainderoutput resetAmountWithOrgMinimaObjectsBaseMiniNumber:[((OrgMinimaObjectsBaseMiniNumber *) nil_chk([remainderoutput getAmount])) addWithOrgMinimaObjectsBaseMiniNumber:remainder]];
        }
      }
    }
    for (jint i = 0; i < 256; i++) {
      if (IOSObjectArray_Get(nil_chk(DYNState), i) != nil) {
        [trans addStateVariableWithOrgMinimaObjectsStateVariable:new_OrgMinimaObjectsStateVariable_initWithInt_withNSString_(i, IOSObjectArray_Get(DYNState, i))];
      }
    }
  }
  jboolean relstate = [((id<OrgMinimaDatabaseUserdbUserDB>) nil_chk([((OrgMinimaDatabaseMinimaDB *) nil_chk(zDB)) getUserDB])) isStateListRelevantWithJavaUtilArrayList:[trans getCompleteState]];
  OrgMinimaObjectsBaseMiniData *transhash = [((OrgMinimaUtilsCrypto *) nil_chk(OrgMinimaUtilsCrypto_getInstance())) hashObjectWithOrgMinimaUtilsStreamable:trans];
  OrgMinimaObjectsProofsTokenProof *newtokdets = nil;
  JavaUtilArrayList *outputs = [trans getAllOutputs];
  jint outs = [((JavaUtilArrayList *) nil_chk(outputs)) size];
  for (jint i = 0; i < outs; i++) {
    OrgMinimaObjectsCoin *output = [outputs getWithInt:i];
    OrgMinimaObjectsBaseMiniData *coinid = [((OrgMinimaUtilsCrypto *) nil_chk(OrgMinimaUtilsCrypto_getInstance())) hashObjectsWithOrgMinimaUtilsStreamable:transhash withOrgMinimaUtilsStreamable:new_OrgMinimaObjectsBaseMiniByte_initWithInt_(i)];
    OrgMinimaObjectsBaseMiniData *tokid = [((OrgMinimaObjectsCoin *) nil_chk(output)) getTokenID];
    if ([((OrgMinimaObjectsBaseMiniData *) nil_chk(tokid)) isEqualWithOrgMinimaObjectsBaseMiniData:JreLoadStatic(OrgMinimaObjectsCoin, TOKENID_CREATE)]) {
      OrgMinimaObjectsProofsTokenProof *gentoken = [trans getTokenGenerationDetails];
      newtokdets = new_OrgMinimaObjectsProofsTokenProof_initWithOrgMinimaObjectsBaseMiniData_withOrgMinimaObjectsBaseMiniNumber_withOrgMinimaObjectsBaseMiniNumber_withOrgMinimaObjectsBaseMiniScript_withOrgMinimaObjectsBaseMiniScript_(coinid, [((OrgMinimaObjectsProofsTokenProof *) nil_chk(gentoken)) getScale], [gentoken getAmount], [gentoken getName], [gentoken getTokenScript]);
      tokid = [newtokdets getTokenID];
    }
    else if (![tokid isEqualWithOrgMinimaObjectsBaseMiniData:JreLoadStatic(OrgMinimaObjectsCoin, MINIMA_TOKENID)]) {
      newtokdets = [zWit getTokenDetailWithOrgMinimaObjectsBaseMiniData:tokid];
      if (newtokdets == nil) {
        OrgMinimaUtilsJsonJSONObject *errorlog = new_OrgMinimaUtilsJsonJSONObject_init();
        [((OrgMinimaUtilsJsonJSONArray *) nil_chk(zContractLog)) addWithId:errorlog];
        (void) [errorlog putWithId:@"error" withId:JreStrcat("$@", @"Total Details Missing for ", tokid)];
        return false;
      }
    }
    if (zTouchMMR) {
      OrgMinimaObjectsCoin *mmrcoin = new_OrgMinimaObjectsCoin_initWithOrgMinimaObjectsBaseMiniData_withOrgMinimaObjectsBaseMiniData_withOrgMinimaObjectsBaseMiniNumber_withOrgMinimaObjectsBaseMiniData_(coinid, [output getAddress], [output getAmount], tokid);
      OrgMinimaDatabaseMmrMMRData *mmrdata = new_OrgMinimaDatabaseMmrMMRData_initWithOrgMinimaObjectsBaseMiniByte_withOrgMinimaObjectsCoin_withOrgMinimaObjectsBaseMiniNumber_withJavaUtilArrayList_(JreLoadStatic(OrgMinimaObjectsBaseMiniByte, FALSE), mmrcoin, zBlockNumber, [trans getCompleteState]);
      OrgMinimaDatabaseMmrMMREntry *unspent = [((OrgMinimaDatabaseMmrMMRSet *) nil_chk(zMMRSet)) addUnspentCoinWithOrgMinimaDatabaseMmrMMRData:mmrdata];
      jboolean reladdress = [((id<OrgMinimaDatabaseUserdbUserDB>) nil_chk([zDB getUserDB])) isAddressRelevantWithOrgMinimaObjectsBaseMiniData:[output getAddress]];
      if (reladdress || relstate) {
        [zMMRSet addKeeperWithOrgMinimaObjectsBaseMiniInteger:[((OrgMinimaDatabaseMmrMMREntry *) nil_chk(unspent)) getEntry]];
      }
    }
  }
  if (![trans checkValidInOutPerToken]) {
    OrgMinimaUtilsJsonJSONObject *errorlog = new_OrgMinimaUtilsJsonJSONObject_init();
    [((OrgMinimaUtilsJsonJSONArray *) nil_chk(zContractLog)) addWithId:errorlog];
    (void) [errorlog putWithId:@"error" withId:@"Total Inputs are LESS than Total Outputs for certain Tokens"];
    return false;
  }
  if (zTouchMMR) {
    if (newtokdets != nil) {
      [((id<OrgMinimaDatabaseUserdbUserDB>) nil_chk([zDB getUserDB])) addTokenDetailsWithOrgMinimaObjectsProofsTokenProof:newtokdets];
    }
    JavaUtilArrayList *tokens = [zWit getAllTokenDetails];
    for (OrgMinimaObjectsProofsTokenProof * __strong tp in nil_chk(tokens)) {
      [((id<OrgMinimaDatabaseUserdbUserDB>) nil_chk([zDB getUserDB])) addTokenDetailsWithOrgMinimaObjectsProofsTokenProof:tp];
    }
  }
  return true;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgMinimaSystemTxpowTxPoWChecker)
