//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ./org/minima/utils/tests/cascader/POWCascader.java
//

#include "IOSObjectArray.h"
#include "J2ObjC_source.h"
#include "java/lang/Math.h"
#include "java/util/ArrayList.h"
#include "java/util/Hashtable.h"
#include "java/util/Random.h"
#include "org/minima/utils/MinimaLogger.h"
#include "org/minima/utils/tests/cascader/Block.h"
#include "org/minima/utils/tests/cascader/BlockLevel.h"
#include "org/minima/utils/tests/cascader/POWCascader.h"

jint OrgMinimaUtilsTestsCascaderPOWCascader_NUMBER_BLOCKS = 100;
jint OrgMinimaUtilsTestsCascaderPOWCascader_NUMBER_SIMULATIONS = 1;
jint OrgMinimaUtilsTestsCascaderPOWCascader_MAX_BLOCK_LEVEL = 2;
jdouble OrgMinimaUtilsTestsCascaderPOWCascader_POWRatio = 0;
jdouble OrgMinimaUtilsTestsCascaderPOWCascader_BLKNUMRatio = 0;

@implementation OrgMinimaUtilsTestsCascaderPOWCascader

J2OBJC_IGNORE_DESIGNATED_BEGIN
- (instancetype)init {
  OrgMinimaUtilsTestsCascaderPOWCascader_init(self);
  return self;
}
J2OBJC_IGNORE_DESIGNATED_END

+ (void)mainWithNSStringArray:(IOSObjectArray *)zArgs {
  OrgMinimaUtilsTestsCascaderPOWCascader_mainWithNSStringArray_(zArgs);
}

+ (void)runSimulation {
  OrgMinimaUtilsTestsCascaderPOWCascader_runSimulation();
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x9, 0, 1, -1, -1, -1, -1 },
    { NULL, "V", 0x9, -1, -1, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  #pragma clang diagnostic ignored "-Wundeclared-selector"
  methods[0].selector = @selector(init);
  methods[1].selector = @selector(mainWithNSStringArray:);
  methods[2].selector = @selector(runSimulation);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "NUMBER_BLOCKS", "I", .constantValue.asLong = 0, 0x9, -1, 2, -1, -1 },
    { "NUMBER_SIMULATIONS", "I", .constantValue.asLong = 0, 0x9, -1, 3, -1, -1 },
    { "MAX_BLOCK_LEVEL", "I", .constantValue.asLong = 0, 0x9, -1, 4, -1, -1 },
    { "POWRatio", "D", .constantValue.asLong = 0, 0x9, -1, 5, -1, -1 },
    { "BLKNUMRatio", "D", .constantValue.asLong = 0, 0x9, -1, 6, -1, -1 },
  };
  static const void *ptrTable[] = { "main", "[LNSString;", &OrgMinimaUtilsTestsCascaderPOWCascader_NUMBER_BLOCKS, &OrgMinimaUtilsTestsCascaderPOWCascader_NUMBER_SIMULATIONS, &OrgMinimaUtilsTestsCascaderPOWCascader_MAX_BLOCK_LEVEL, &OrgMinimaUtilsTestsCascaderPOWCascader_POWRatio, &OrgMinimaUtilsTestsCascaderPOWCascader_BLKNUMRatio };
  static const J2ObjcClassInfo _OrgMinimaUtilsTestsCascaderPOWCascader = { "POWCascader", "org.minima.utils.tests.cascader", ptrTable, methods, fields, 7, 0x1, 3, 5, -1, -1, -1, -1, -1 };
  return &_OrgMinimaUtilsTestsCascaderPOWCascader;
}

@end

void OrgMinimaUtilsTestsCascaderPOWCascader_init(OrgMinimaUtilsTestsCascaderPOWCascader *self) {
  NSObject_init(self);
}

OrgMinimaUtilsTestsCascaderPOWCascader *new_OrgMinimaUtilsTestsCascaderPOWCascader_init() {
  J2OBJC_NEW_IMPL(OrgMinimaUtilsTestsCascaderPOWCascader, init)
}

OrgMinimaUtilsTestsCascaderPOWCascader *create_OrgMinimaUtilsTestsCascaderPOWCascader_init() {
  J2OBJC_CREATE_IMPL(OrgMinimaUtilsTestsCascaderPOWCascader, init)
}

void OrgMinimaUtilsTestsCascaderPOWCascader_mainWithNSStringArray_(IOSObjectArray *zArgs) {
  OrgMinimaUtilsTestsCascaderPOWCascader_initialize();
  jdouble totalPow = 0;
  jdouble totalNum = 0;
  for (jint i = 0; i < OrgMinimaUtilsTestsCascaderPOWCascader_NUMBER_SIMULATIONS; i++) {
    OrgMinimaUtilsMinimaLogger_logWithNSString_(JreStrcat("$I", @"\nRunning Simulation ", i));
    OrgMinimaUtilsTestsCascaderPOWCascader_runSimulation();
    JrePlusAssignDoubleD(&totalPow, OrgMinimaUtilsTestsCascaderPOWCascader_POWRatio);
    JrePlusAssignDoubleD(&totalNum, OrgMinimaUtilsTestsCascaderPOWCascader_BLKNUMRatio);
  }
  OrgMinimaUtilsMinimaLogger_logWithNSString_(@"\nFinal Scores");
  OrgMinimaUtilsMinimaLogger_logWithNSString_(JreStrcat("$I", @"Number of Simulations : ", OrgMinimaUtilsTestsCascaderPOWCascader_NUMBER_SIMULATIONS));
  OrgMinimaUtilsMinimaLogger_logWithNSString_(JreStrcat("$I", @"Number of Blocks : ", OrgMinimaUtilsTestsCascaderPOWCascader_NUMBER_BLOCKS));
  OrgMinimaUtilsMinimaLogger_logWithNSString_(JreStrcat("$DC", @"POW Stored : ", (totalPow / (jdouble) OrgMinimaUtilsTestsCascaderPOWCascader_NUMBER_SIMULATIONS) * 100, '%'));
  OrgMinimaUtilsMinimaLogger_logWithNSString_(JreStrcat("$DC", @"SIZE of Cascading Chain : ", (totalNum / (jdouble) OrgMinimaUtilsTestsCascaderPOWCascader_NUMBER_SIMULATIONS) * 100, '%'));
}

void OrgMinimaUtilsTestsCascaderPOWCascader_runSimulation() {
  OrgMinimaUtilsTestsCascaderPOWCascader_initialize();
  JavaUtilRandom *rand = create_JavaUtilRandom_init();
  JavaUtilHashtable *mAllBLocks = create_JavaUtilHashtable_init();
  JavaUtilArrayList *Blocks = create_JavaUtilArrayList_init();
  JavaUtilArrayList *BlocksCascading = create_JavaUtilArrayList_init();
  OrgMinimaUtilsTestsCascaderBlockLevel *bdata = create_OrgMinimaUtilsTestsCascaderBlockLevel_init();
  bdata->mBlockLevel_ = 0;
  bdata->mBlockNumber_ = 0;
  bdata->mBlockDifficulty_ = 1;
  bdata->mPreviousBlock_ = 0;
  OrgMinimaUtilsTestsCascaderBlock *mGenesisBlock = create_OrgMinimaUtilsTestsCascaderBlock_init();
  mGenesisBlock->mMaxBlockLevel_ = 0;
  IOSObjectArray_Set(nil_chk(mGenesisBlock->mBlockLevels_), 0, bdata);
  mGenesisBlock->mBlockHash_ = [rand nextDouble];
  [Blocks addWithId:mGenesisBlock];
  OrgMinimaUtilsTestsCascaderBlock *currentblock = mGenesisBlock;
  OrgMinimaUtilsTestsCascaderBlock *lastBlock;
  for (jint i = 0; i < OrgMinimaUtilsTestsCascaderPOWCascader_NUMBER_BLOCKS; i++) {
    lastBlock = currentblock;
    jint currentmax = lastBlock->mMaxBlockLevel_;
    jint level = [lastBlock getBlockLevel];
    if (level >= currentmax) {
      level = currentmax + 1;
    }
    else {
      level = currentmax;
    }
    if (level > OrgMinimaUtilsTestsCascaderPOWCascader_MAX_BLOCK_LEVEL) {
      level = OrgMinimaUtilsTestsCascaderPOWCascader_MAX_BLOCK_LEVEL;
    }
    currentblock = create_OrgMinimaUtilsTestsCascaderBlock_init();
    currentblock->mMaxBlockLevel_ = level;
    currentblock->mBlockHash_ = [rand nextDouble];
    for (jint lev = 0; lev <= level; lev++) {
      OrgMinimaUtilsTestsCascaderBlockLevel *bl = create_OrgMinimaUtilsTestsCascaderBlockLevel_init();
      bl->mBlockLevel_ = lev;
      bl->mPreviousBlock_ = 0;
      if (lev == 0) {
        bl->mBlockDifficulty_ = 1.0;
      }
      else {
        bl->mBlockDifficulty_ = JavaLangMath_powWithDouble_withDouble_(10, lev);
      }
      if (lev <= currentmax) {
        bl->mBlockNumber_ = ((OrgMinimaUtilsTestsCascaderBlockLevel *) nil_chk(IOSObjectArray_Get(nil_chk(lastBlock->mBlockLevels_), lev)))->mBlockNumber_ + 1;
      }
      else {
        bl->mBlockNumber_ = 0;
      }
      IOSObjectArray_Set(nil_chk(currentblock->mBlockLevels_), lev, bl);
    }
    [Blocks addWithId:currentblock];
  }
  jint counter = 0;
  jint level = 0;
  jint levelcounter = 0;
  OrgMinimaUtilsMinimaLogger_logWithNSString_(@"Original Blocks");
  jdouble totalpow = 0;
  jboolean limitreached = false;
  for (OrgMinimaUtilsTestsCascaderBlock * __strong blk in Blocks) {
    OrgMinimaUtilsMinimaLogger_logWithNSString_(JreStrcat("I$@", counter, @") ", blk));
    JrePlusAssignDoubleD(&totalpow, ((OrgMinimaUtilsTestsCascaderBlockLevel *) nil_chk(IOSObjectArray_Get(nil_chk(((OrgMinimaUtilsTestsCascaderBlock *) nil_chk(blk))->mBlockLevels_), 0)))->mBlockDifficulty_);
    counter++;
    jint blevel = [blk getBlockLevel];
    if (blevel >= level) {
      [BlocksCascading addWithId:blk];
      if (limitreached) {
        if (blevel > level) {
          level++;
          levelcounter = 0;
          limitreached = false;
        }
      }
      else {
        levelcounter++;
      }
      blk->mFinalWeight_ = ((OrgMinimaUtilsTestsCascaderBlockLevel *) nil_chk(IOSObjectArray_Get(nil_chk(blk->mBlockLevels_), level)))->mBlockDifficulty_;
      if (levelcounter > 10) {
        limitreached = true;
      }
    }
  }
  OrgMinimaUtilsMinimaLogger_logWithNSString_(JreStrcat("$D", @"Total POW ", totalpow));
  jdouble tot = totalpow;
  OrgMinimaUtilsMinimaLogger_logWithNSString_(@"Cascading Chain Blocks");
  counter = 0;
  totalpow = 0;
  for (OrgMinimaUtilsTestsCascaderBlock * __strong cblk in BlocksCascading) {
    OrgMinimaUtilsMinimaLogger_logWithNSString_(JreStrcat("I$@", counter, @") ", cblk));
    JrePlusAssignDoubleD(&totalpow, ((OrgMinimaUtilsTestsCascaderBlock *) nil_chk(cblk))->mFinalWeight_);
    counter++;
  }
  OrgMinimaUtilsMinimaLogger_logWithNSString_(JreStrcat("$D", @"Total POW ", totalpow));
  OrgMinimaUtilsTestsCascaderPOWCascader_POWRatio = totalpow / tot;
  OrgMinimaUtilsTestsCascaderPOWCascader_BLKNUMRatio = (jdouble) [BlocksCascading size] / (jdouble) [Blocks size];
  OrgMinimaUtilsMinimaLogger_logWithNSString_(@"Ratio Cascading Chain VS Full block chain");
  OrgMinimaUtilsMinimaLogger_logWithNSString_(JreStrcat("$FC", @"Number of blocks : ", (jfloat) (OrgMinimaUtilsTestsCascaderPOWCascader_BLKNUMRatio * 100), '%'));
  OrgMinimaUtilsMinimaLogger_logWithNSString_(JreStrcat("$FC", @"Stored POW       : ", (jfloat) (OrgMinimaUtilsTestsCascaderPOWCascader_POWRatio * 100), '%'));
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgMinimaUtilsTestsCascaderPOWCascader)
